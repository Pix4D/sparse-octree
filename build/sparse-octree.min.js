/**
 * sparse-octree v4.0.2 build Oct 10 2017
 * https://github.com/vanruesc/sparse-octree
 * Copyright 2017 Raoul van RÃ¼schen, Zlib
 */

!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.SPARSEOCTREE={})}(this,function(t){"use strict";function i(t,i,n){return Math.max(Math.min(t,n),i)}function n(t,i,n,s,r,e){var o=0;return t>i&&t>n?(r<t&&(o|=2),e<t&&(o|=1)):i>n?(s<i&&(o|=4),e<i&&(o|=1)):(s<n&&(o|=4),r<n&&(o|=2)),o}function s(t,i,n,s){var r,e=0;return i<n?(r=i,e=0):(r=n,e=1),s<r&&(e=2),st[t][e]}function r(t,i,e,o,h,a,u,p,y){var c,l,m,x,f=t.children;if(h>=0&&a>=0&&u>=0)if(null===f)y.push(t);else{c=n(i,e,o,l=.5*(i+h),m=.5*(e+a),x=.5*(o+u));do{switch(c){case 0:r(f[nt[8]],i,e,o,l,m,x,p,y),c=s(c,l,m,x);break;case 1:r(f[nt[8]^nt[1]],i,e,x,l,m,u,p,y),c=s(c,l,m,u);break;case 2:r(f[nt[8]^nt[2]],i,m,o,l,a,x,p,y),c=s(c,l,a,x);break;case 3:r(f[nt[8]^nt[3]],i,m,x,l,a,u,p,y),c=s(c,l,a,u);break;case 4:r(f[nt[8]^nt[4]],l,e,o,h,m,x,p,y),c=s(c,h,m,x);break;case 5:r(f[nt[8]^nt[5]],l,e,x,h,m,u,p,y),c=s(c,h,m,u);break;case 6:r(f[nt[8]^nt[6]],l,m,o,h,a,x,p,y),c=s(c,h,a,x);break;case 7:r(f[nt[8]^nt[7]],l,m,x,h,a,u,p,y),c=8}}while(c<8)}}function e(t){var i,n,s,r=t.children,o=0;if(null!==r)for(i=0,n=r.length;i<n;++i)(s=1+e(r[i]))>o&&(o=s);return o}function o(t,i,n){var s,r,e=t.children;if(ct.min=t.min,ct.max=t.max,i.intersectsBox(ct))if(null!==e)for(s=0,r=e.length;s<r;++s)o(e[s],i,n);else n.push(t)}function h(t,i,n,s){var r,e,o=t.children;if(n===i)s.push(t);else if(null!==o)for(++n,r=0,e=o.length;r<e;++r)h(o[r],i,n,s)}function a(t){var i,n,s=t.children,r=0;if(null!==s)for(i=0,n=s.length;i<n;++i)r+=a(s[i]);else null!==t.points&&(r=t.points.length);return r}function u(t,i,n,s,r){var e,o,h=s.children,a=!1,p=!1;if(s.contains(t,n.bias)){if(null===h){if(null===s.points)s.points=[],s.data=[];else for(e=0,o=s.points.length;!a&&e<o;++e)a=s.points[e].equals(t);a?(s.data[e-1]=i,p=!0):s.points.length<n.maxPoints||r===n.maxDepth?(s.points.push(t.clone()),s.data.push(i),++n.pointCount,p=!0):(s.split(),s.redistribute(n.bias),h=s.children)}if(null!==h)for(++r,e=0,o=h.length;!p&&e<o;++e)p=u(t,i,n,h[e],r)}return p}function p(t,i,n,s){var r,e,o,h,u,y=n.children,c=null;if(n.contains(t,i.bias))if(null!==y)for(r=0,e=y.length;null===c&&r<e;++r)c=p(t,i,y[r],n);else if(null!==n.points)for(o=n.points,h=n.data,r=0,e=o.length;r<e;++r)if(o[r].equals(t)){u=e-1,c=h[r],r<u&&(o[r]=o[u],h[r]=h[u]),o.pop(),h.pop(),--i.pointCount,null!==s&&a(s)<=i.maxPoints&&s.merge();break}return c}function y(t,i,n){var s,r,e,o=n.children,h=null;if(n.contains(t,i.bias))if(null!==o)for(s=0,r=o.length;null===h&&s<r;++s)h=y(t,i,o[s]);else for(s=0,r=(e=n.points).length;null===h&&s<r;++s)t.distanceToSquared(e[s])<=zt&&(h=n.data[s]);return h}function c(t,i,n,s,r,e){var o,h,a,y=s.children,l=null;if(s.contains(t,n.bias))if(s.contains(i,n.bias)){if(null!==y)for(++e,o=0,h=y.length;null===l&&o<h;++o)l=c(t,i,n,y[o],s,e);else for(o=0,h=(a=s.points).length;o<h;++o)if(t.distanceToSquared(a[o])<=zt){a[o].copy(i),l=s.data[o];break}}else u(i,l=p(t,n,s,r),n,r,e-1);return l}function l(t,i,n,s){var r,e,o,h,a,u,p,y=s.points,c=s.children,m=null,x=i;if(null!==c)for(r=0,e=(a=c.map(function(i){return{octant:i,distance:i.distanceToCenterSquared(t)}}).sort(function(t,i){return t.distance-i.distance})).length;r<e;++r)(u=a[r].octant).contains(t,x)&&null!==(p=l(t,x,n,u))&&(h=p.point.distanceToSquared(t),(!n||h>0)&&h<x&&(x=h,m=p));else if(null!==y)for(r=0,e=y.length;r<e;++r)o=y[r],h=t.distanceToSquared(o),(!n||h>0)&&h<x&&(x=h,m={point:o.clone(),data:s.data[r]});return m}function m(t,i,n,s,r){var e,o,h,a,u,p=s.points,y=s.children,c=i*i;if(null!==y)for(e=0,o=y.length;e<o;++e)(u=y[e]).contains(t,i)&&m(t,i,n,u,r);else if(null!==p)for(e=0,o=p.length;e<o;++e)h=p[e],a=t.distanceToSquared(h),(!n||a>0)&&a<=c&&r.push({point:h.clone(),data:s.data[e]})}var x=function(t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=i,this.z=n};x.prototype.set=function(t,i,n){return this.x=t,this.y=i,this.z=n,this},x.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},x.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z)},x.prototype.fromArray=function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this},x.prototype.toArray=function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},x.prototype.setFromSpherical=function(t){var i=Math.sin(t.phi)*t.radius;return this.x=i*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=i*Math.cos(t.theta),this},x.prototype.setFromCylindrical=function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},x.prototype.setFromMatrixColumn=function(t,i){return this.fromArray(t.elements,4*i)},x.prototype.setFromMatrixPosition=function(t){var i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this},x.prototype.setFromMatrixScale=function(t){var i=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=n,this.z=s,this},x.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},x.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this},x.prototype.addVectors=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},x.prototype.addScaledVector=function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},x.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},x.prototype.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this},x.prototype.subVectors=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},x.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},x.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},x.prototype.multiplyVectors=function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},x.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},x.prototype.divideScalar=function(t){return this.x/=t,this.y/=t,this.z/=t,this},x.prototype.cross=function(t){var i=this.x,n=this.y,s=this.z;return this.x=n*t.z-s*t.y,this.y=s*t.x-i*t.z,this.z=i*t.y-n*t.x,this},x.prototype.crossVectors=function(t,i){var n=t.x,s=t.y,r=t.z,e=i.x,o=i.y,h=i.z;return this.x=s*h-r*o,this.y=r*e-n*h,this.z=n*o-s*e,this},x.prototype.applyMatrix3=function(t){var i=this.x,n=this.y,s=this.z,r=t.elements;return this.x=r[0]*i+r[3]*n+r[6]*s,this.y=r[1]*i+r[4]*n+r[7]*s,this.z=r[2]*i+r[5]*n+r[8]*s,this},x.prototype.applyMatrix4=function(t){var i=this.x,n=this.y,s=this.z,r=t.elements;return this.x=r[0]*i+r[4]*n+r[8]*s+r[12],this.y=r[1]*i+r[5]*n+r[9]*s+r[13],this.z=r[2]*i+r[6]*n+r[10]*s+r[14],this},x.prototype.applyQuaternion=function(t){var i=this.x,n=this.y,s=this.z,r=t.x,e=t.y,o=t.z,h=t.w,a=h*i+e*s-o*n,u=h*n+o*i-r*s,p=h*s+r*n-e*i,y=-r*i-e*n-o*s;return this.x=a*h+y*-r+u*-o-p*-e,this.y=u*h+y*-e+p*-r-a*-o,this.z=p*h+y*-o+a*-e-u*-r,this},x.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},x.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},x.prototype.reflect=function(t,i){void 0===i&&(i=new x);var n=t.x,s=t.y,r=t.z;return this.sub(t.multiplyScalar(2*this.dot(t))),t.set(n,s,r),this},x.prototype.angleTo=function(t){var i=this.dot(t)/Math.sqrt(this.lengthSquared()*t.lengthSquared());return Math.acos(Math.min(Math.max(i,-1),1))},x.prototype.lengthManhattan=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},x.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},x.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},x.prototype.distanceToManhattan=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},x.prototype.distanceToSquared=function(t){var i=this.x-t.x,n=this.y-t.y,s=this.z-t.z;return i*i+n*n+s*s},x.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},x.prototype.normalize=function(){return this.divideScalar(this.length())},x.prototype.setLength=function(t){return this.normalize().multiplyScalar(t)},x.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},x.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},x.prototype.clamp=function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this},x.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},x.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},x.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},x.prototype.lerp=function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},x.prototype.lerpVectors=function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},x.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z};var f=new x,d=function(t,i){void 0===t&&(t=new x(1/0,1/0,1/0)),void 0===i&&(i=new x(-1/0,-1/0,-1/0)),this.min=t,this.max=i};d.prototype.set=function(t,i){return this.min.copy(t),this.max.copy(i),this},d.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},d.prototype.clone=function(){return(new this.constructor).copy(this)},d.prototype.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},d.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},d.prototype.getCenter=function(t){return void 0===t&&(t=new x),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},d.prototype.getSize=function(t){return void 0===t&&(t=new x),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},d.prototype.getBoundingSphere=function(t){return void 0===t&&(t=new v),this.getCenter(t.center),t.radius=.5*this.getSize(f).length(),t},d.prototype.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},d.prototype.expandByVector=function(t){return this.min.sub(t),this.max.add(t),this},d.prototype.expandByScalar=function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},d.prototype.setFromPoints=function(t){var i,n,s=this;for(this.min.set(0,0,0),this.max.set(0,0,0),i=0,n=t.length;i<n;++i)s.expandByPoint(t[i]);return this},d.prototype.setFromCenterAndSize=function(t,i){var n=f.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},d.prototype.clampPoint=function(t,i){return void 0===i&&(i=new x),i.copy(t).clamp(this.min,this.max)},d.prototype.distanceToPoint=function(t){return f.copy(t).clamp(this.min,this.max).sub(t).length()},d.prototype.translate=function(t){return this.min.add(t),this.max.add(t),this},d.prototype.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},d.prototype.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},d.prototype.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},d.prototype.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},d.prototype.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},d.prototype.intersectsSphere=function(t){return this.clampPoint(t.center,f).distanceToSquared(t.center)<=t.radius*t.radius},d.prototype.intersectsPlane=function(t){var i,n;return t.normal.x>0?(i=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),i<=t.constant&&n>=t.constant},d.prototype.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)};var z=new d,v=function(t,i){void 0===t&&(t=new x),void 0===i&&(i=0),this.center=t,this.radius=i};v.prototype.set=function(t,i){return this.center.copy(t),this.radius=i,this},v.prototype.copy=function(t){return this.center.copy(t.center),this.radius=t.radius,this},v.prototype.clone=function(){return(new this.constructor).copy(this)},v.prototype.setFromPoints=function(t,i){void 0===i&&(i=z.setFromPoints(t).getCenter(this.center));var n,s,r=this.center,e=0;for(n=0,s=t.length;n<s;++n)e=Math.max(e,r.distanceToSquared(t[n]));return this.radius=Math.sqrt(e),this},v.prototype.getBoundingBox=function(t){return void 0===t&&(t=new d),t.set(this.center,this.center),t.expandByScalar(this.radius),t},v.prototype.isEmpty=function(){return this.radius<=0},v.prototype.translate=function(t){return this.center.add(t),this},v.prototype.clampPoint=function(t,i){void 0===i&&(i=new x);var n=this.center.distanceToSquared(t);return i.copy(t),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},v.prototype.distanceToPoint=function(t){return t.distanceTo(this.center)-this.radius},v.prototype.containsPoint=function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},v.prototype.intersectsSphere=function(t){var i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i},v.prototype.intersectsBox=function(t){return t.intersectsSphere(this)},v.prototype.intersectsPlane=function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},v.prototype.equals=function(t){return t.center.equals(this.center)&&t.radius===this.radius};var M=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i},w={width:{configurable:!0},height:{configurable:!0}};w.width.get=function(){return this.x},w.width.set=function(t){return this.x=t},w.height.get=function(){return this.y},w.height.set=function(t){return this.y=t},M.prototype.set=function(t,i){return this.x=t,this.y=i,this},M.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},M.prototype.clone=function(){return new this.constructor(this.x,this.y)},M.prototype.fromArray=function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this},M.prototype.toArray=function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t},M.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},M.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},M.prototype.addVectors=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},M.prototype.addScaledVector=function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this},M.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},M.prototype.subScalar=function(t){return this.x-=t,this.y-=t,this},M.prototype.subVectors=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},M.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},M.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},M.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},M.prototype.divideScalar=function(t){return this.x/=t,this.y/=t,this},M.prototype.applyMatrix3=function(t){var i=this.x,n=this.y,s=t.elements;return this.x=s[0]*i+s[3]*n+s[6],this.y=s[1]*i+s[4]*n+s[7],this},M.prototype.dot=function(t){return this.x*t.x+this.y*t.y},M.prototype.lengthManhattan=function(){return Math.abs(this.x)+Math.abs(this.y)},M.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},M.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},M.prototype.distanceToManhattan=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},M.prototype.distanceToSquared=function(t){var i=this.x-t.x,n=this.y-t.y;return i*i+n*n},M.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},M.prototype.normalize=function(){return this.divideScalar(this.length())},M.prototype.setLength=function(t){return this.normalize().multiplyScalar(t)},M.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},M.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},M.prototype.clamp=function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this},M.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},M.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},M.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},M.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},M.prototype.angle=function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},M.prototype.lerp=function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},M.prototype.lerpVectors=function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},M.prototype.rotateAround=function(t,i){var n=Math.cos(i),s=Math.sin(i),r=this.x-t.x,e=this.y-t.y;return this.x=r*n-e*s+t.x,this.y=r*s+e*n+t.y,this},M.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},Object.defineProperties(M.prototype,w);var g=new M,b=function(t,i){void 0===t&&(t=new M(1/0,1/0)),void 0===i&&(i=new M(-1/0,-1/0)),this.min=t,this.max=i};b.prototype.set=function(t,i){return this.min.copy(t),this.max.copy(i),this},b.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},b.prototype.clone=function(){return(new this.constructor).copy(this)},b.prototype.makeEmpty=function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},b.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y},b.prototype.getCenter=function(t){return void 0===t&&(t=new M),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},b.prototype.getSize=function(t){return void 0===t&&(t=new M),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},b.prototype.getBoundingSphere=function(t){return void 0===t&&(t=new v),this.getCenter(t.center),t.radius=.5*this.getSize(g).length(),t},b.prototype.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},b.prototype.expandByVector=function(t){return this.min.sub(t),this.max.add(t),this},b.prototype.expandByScalar=function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},b.prototype.setFromPoints=function(t){var i,n,s=this;for(this.min.set(0,0),this.max.set(0,0),i=0,n=t.length;i<n;++i)s.expandByPoint(t[i]);return this},b.prototype.setFromCenterAndSize=function(t,i){var n=g.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},b.prototype.clampPoint=function(t,i){return void 0===i&&(i=new M),i.copy(t).clamp(this.min,this.max)},b.prototype.distanceToPoint=function(t){return g.copy(t).clamp(this.min,this.max).sub(t).length()},b.prototype.translate=function(t){return this.min.add(t),this.max.add(t),this},b.prototype.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},b.prototype.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},b.prototype.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},b.prototype.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},b.prototype.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},b.prototype.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)};var S=function(t,i,n){void 0===t&&(t=1),void 0===i&&(i=0),void 0===n&&(n=0),this.radius=t,this.theta=i,this.y=n};S.prototype.set=function(t,i,n){return this.radius=t,this.theta=i,this.y=n,this},S.prototype.copy=function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},S.prototype.clone=function(){return(new this.constructor).copy(this)},S.prototype.setFromVector3=function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this};var q=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])};q.prototype.set=function(t,i,n,s,r,e,o,h,a){var u=this.elements;return u[0]=t,u[3]=i,u[6]=n,u[1]=s,u[4]=r,u[7]=e,u[2]=o,u[5]=h,u[8]=a,this},q.prototype.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},q.prototype.copy=function(t){var i=t.elements,n=this.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],this},q.prototype.clone=function(){return(new this.constructor).fromArray(this.elements)},q.prototype.fromArray=function(t,i){void 0===i&&(i=0);var n,s=this.elements;for(n=0;n<9;++n)s[n]=t[n+i];return this},q.prototype.toArray=function(t,i){void 0===t&&(t=[]),void 0===i&&(i=0);var n,s=this.elements;for(n=0;n<9;++n)t[n+i]=s[n];return t},q.prototype.multiplyMatrices=function(t,i){var n=t.elements,s=i.elements,r=this.elements,e=n[0],o=n[3],h=n[6],a=n[1],u=n[4],p=n[7],y=n[2],c=n[5],l=n[8],m=s[0],x=s[3],f=s[6],d=s[1],z=s[4],v=s[7],M=s[2],w=s[5],g=s[8];return r[0]=e*m+o*d+h*M,r[3]=e*x+o*z+h*w,r[6]=e*f+o*v+h*g,r[1]=a*m+u*d+p*M,r[4]=a*x+u*z+p*w,r[7]=a*f+u*v+p*g,r[2]=y*m+c*d+l*M,r[5]=y*x+c*z+l*w,r[8]=y*f+c*v+l*g,this},q.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},q.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},q.prototype.multiplyScalar=function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},q.prototype.determinant=function(){var t=this.elements,i=t[0],n=t[1],s=t[2],r=t[3],e=t[4],o=t[5],h=t[6],a=t[7],u=t[8];return i*e*u-i*o*a-n*r*u+n*o*h+s*r*a-s*e*h},q.prototype.getInverse=function(t){var i,n=t.elements,s=this.elements,r=n[0],e=n[1],o=n[2],h=n[3],a=n[4],u=n[5],p=n[6],y=n[7],c=n[8],l=c*a-u*y,m=u*p-c*h,x=y*h-a*p,f=r*l+e*m+o*x;return 0!==f?(i=1/f,s[0]=l*i,s[1]=(o*y-c*e)*i,s[2]=(u*e-o*a)*i,s[3]=m*i,s[4]=(c*r-o*p)*i,s[5]=(o*h-u*r)*i,s[6]=x*i,s[7]=(e*p-y*r)*i,s[8]=(a*r-e*h)*i):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this},q.prototype.transpose=function(){var t,i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this},q.prototype.scale=function(t,i){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=i,n[4]*=i,n[7]*=i,this},q.prototype.rotate=function(t){var i=Math.cos(t),n=Math.sin(t),s=this.elements,r=s[0],e=s[3],o=s[6],h=s[1],a=s[4],u=s[7];return s[0]=i*r+n*h,s[3]=i*e+n*a,s[6]=i*o+n*u,s[1]=-n*r+i*h,s[4]=-n*e+i*a,s[7]=-n*o+i*u,this},q.prototype.translate=function(t,i){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=i*n[2],n[4]+=i*n[5],n[7]+=i*n[8],this},q.prototype.equals=function(t){var i,n=this.elements,s=t.elements,r=!0;for(i=0;r&&i<9;++i)n[i]!==s[i]&&(r=!1);return r};var P={XYZ:"XYZ",YZX:"YZX",ZXY:"ZXY",XZY:"XZY",YXZ:"YXZ",ZYX:"ZYX"},A=new x,T=function(t,i,n,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),this.x=t,this.y=t,this.z=t,this.w=t};T.prototype.set=function(t,i,n,s){return this.x=t,this.y=i,this.z=n,this.w=s,this},T.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},T.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z,this.w)},T.prototype.fromArray=function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},T.prototype.toArray=function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t},T.prototype.setFromEuler=function(t){var i=t.x,n=t.y,s=t.z,r=Math.cos,e=Math.sin,o=r(i/2),h=r(n/2),a=r(s/2),u=e(i/2),p=e(n/2),y=e(s/2);switch(t.order){case P.XYZ:this.x=u*h*a+o*p*y,this.y=o*p*a-u*h*y,this.z=o*h*y+u*p*a,this.w=o*h*a-u*p*y;break;case P.YXZ:this.x=u*h*a+o*p*y,this.y=o*p*a-u*h*y,this.z=o*h*y-u*p*a,this.w=o*h*a+u*p*y;break;case P.ZXY:this.x=u*h*a-o*p*y,this.y=o*p*a+u*h*y,this.z=o*h*y+u*p*a,this.w=o*h*a-u*p*y;break;case P.ZYX:this.x=u*h*a-o*p*y,this.y=o*p*a+u*h*y,this.z=o*h*y-u*p*a,this.w=o*h*a+u*p*y;break;case P.YZX:this.x=u*h*a+o*p*y,this.y=o*p*a+u*h*y,this.z=o*h*y-u*p*a,this.w=o*h*a-u*p*y;break;case P.XZY:this.x=u*h*a-o*p*y,this.y=o*p*a-u*h*y,this.z=o*h*y+u*p*a,this.w=o*h*a+u*p*y}return this},T.prototype.setFromAxisAngle=function(t,i){var n=i/2,s=Math.sin(n);return this.x=t.x*s,this.y=t.y*s,this.z=t.z*s,this.w=Math.cos(n),this},T.prototype.setFromRotationMatrix=function(t){var i,n=t.elements,s=n[0],r=n[4],e=n[8],o=n[1],h=n[5],a=n[9],u=n[2],p=n[6],y=n[10],c=s+h+y;return c>0?(i=.5/Math.sqrt(c+1),this.w=.25/i,this.x=(p-a)*i,this.y=(e-u)*i,this.z=(o-r)*i):s>h&&s>y?(i=2*Math.sqrt(1+s-h-y),this.w=(p-a)/i,this.x=.25*i,this.y=(r+o)/i,this.z=(e+u)/i):h>y?(i=2*Math.sqrt(1+h-s-y),this.w=(e-u)/i,this.x=(r+o)/i,this.y=.25*i,this.z=(a+p)/i):(i=2*Math.sqrt(1+y-s-h),this.w=(o-r)/i,this.x=(e+u)/i,this.y=(a+p)/i,this.z=.25*i),this},T.prototype.setFromUnitVectors=function(t,i){var n=t.dot(i)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?A.set(-t.y,t.x,0):A.set(0,-t.z,t.y)):A.crossVectors(t,i),this.x=A.x,this.y=A.y,this.z=A.z,this.w=n,this.normalize()},T.prototype.invert=function(){return this.conjugate().normalize()},T.prototype.conjugate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},T.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},T.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},T.prototype.normalize=function(){var t,i=this.length();return 0===i?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/i,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this},T.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},T.prototype.multiplyQuaternions=function(t,i){var n=t.x,s=t.y,r=t.z,e=t.w,o=i.x,h=i.y,a=i.z,u=i.w;return this.x=n*u+e*o+s*a-r*h,this.y=s*u+e*h+r*o-n*a,this.z=r*u+e*a+n*h-s*o,this.w=e*u-n*o-s*h-r*a,this},T.prototype.multiply=function(t){return this.multiplyQuaternions(this,t)},T.prototype.premultiply=function(t){return this.multiplyQuaternions(t,this)},T.prototype.slerp=function(t,i){var n,s,r,e,o,h=this.x,a=this.y,u=this.z,p=this.w;if(1===i)this.copy(t);else if(i>0){if((n=p*t.w+h*t.x+a*t.y+u*t.z)<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,n=-n):this.copy(t),n>=1)return this.w=p,this.x=h,this.y=a,this.z=u,this;if(s=Math.sqrt(1-n*n),Math.abs(s)<.001)return this.w=.5*(p+this.w),this.x=.5*(h+this.x),this.y=.5*(a+this.y),this.z=.5*(u+this.z),this;r=Math.atan2(s,n),e=Math.sin((1-i)*r)/s,o=Math.sin(i*r)/s,this.w=p*e+this.w*o,this.x=h*e+this.x*o,this.y=a*e+this.y*o,this.z=u*e+this.z*o}return this},T.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},T.slerp=function(t,i,n,s){return void 0===n&&(n=new T),n.copy(t).slerp(i,s)},T.slerpFlat=function(t,i,n,s,r,e,o){var h,a,u,p,y,c,l,m,x=r[e],f=r[e+1],d=r[e+2],z=r[e+3],v=n[s],M=n[s+1],w=n[s+2],g=n[s+3];g===z&&v===x&&M===f&&w===d||(h=1-o,c=(p=v*x+M*f+w*d+g*z)>=0?1:-1,(y=1-p*p)>Number.EPSILON&&(u=Math.sqrt(y),l=Math.atan2(u,p*c),h=Math.sin(h*l)/u,o=Math.sin(o*l)/u),v=v*h+x*(m=o*c),M=M*h+f*m,w=w*h+d*m,g=g*h+z*m,h===1-o&&(v*=a=1/Math.sqrt(v*v+M*M+w*w+g*g),M*=a,w*=a,g*=a)),t[i]=v,t[i+1]=M,t[i+2]=w,t[i+3]=g};var k=new q,F=new T,V=function t(i,n,s){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),this.x=i,this.y=n,this.z=s,this.order=t.defaultOrder},C={defaultOrder:{configurable:!0}};V.prototype.set=function(t,i,n,s){return this.x=t,this.y=i,this.z=n,this.order=n,this},V.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this},V.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z,this.order)},V.prototype.fromArray=function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.order=t[i+3],this},V.prototype.toArray=function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.order,t},V.prototype.toVector3=function(t){return void 0===t&&(t=new x),t.set(this.x,this.y,this.z)},V.prototype.setFromRotationMatrix=function(t,n){void 0===n&&(n=this.order);var s=t.elements,r=s[0],e=s[4],o=s[8],h=s[1],a=s[5],u=s[9],p=s[2],y=s[6],c=s[10];switch(n){case P.XYZ:this.y=Math.asin(i(o,-1,1)),Math.abs(o)<.99999?(this.x=Math.atan2(-u,c),this.z=Math.atan2(-e,r)):(this.x=Math.atan2(y,a),this.z=0);break;case P.YXZ:this.x=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(this.y=Math.atan2(o,c),this.z=Math.atan2(h,a)):(this.y=Math.atan2(-p,r),this.z=0);break;case P.ZXY:this.x=Math.asin(i(y,-1,1)),Math.abs(y)<.99999?(this.y=Math.atan2(-p,c),this.z=Math.atan2(-e,a)):(this.y=0,this.z=Math.atan2(h,r));break;case P.ZYX:this.y=Math.asin(-i(p,-1,1)),Math.abs(p)<.99999?(this.x=Math.atan2(y,c),this.z=Math.atan2(h,r)):(this.x=0,this.z=Math.atan2(-e,a));break;case P.YZX:this.z=Math.asin(i(h,-1,1)),Math.abs(h)<.99999?(this.x=Math.atan2(-u,a),this.y=Math.atan2(-p,r)):(this.x=0,this.y=Math.atan2(o,c));break;case P.XZY:this.z=Math.asin(-i(e,-1,1)),Math.abs(e)<.99999?(this.x=Math.atan2(y,a),this.y=Math.atan2(o,r)):(this.x=Math.atan2(-u,c),this.y=0)}return this.order=n,this},V.prototype.setFromQuaternion=function(t,i){return k.makeRotationFromQuaternion(t),this.setFromRotationMatrix(k,i)},V.prototype.setFromVector3=function(t,i){return void 0===i&&(i=this.order),this.set(t.x,t.y,t.z,i)},V.prototype.reorder=function(t){return F.setFromEuler(this),this.setFromQuaternion(F,t)},V.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order},C.defaultOrder.get=function(){return P.XYZ},Object.defineProperties(V,C);var X=new x,Y=new x,Z=function(t,i){void 0===t&&(t=new x),void 0===i&&(i=new x),this.start=t,this.end=i};Z.prototype.set=function(t,i){return this.start.copy(t),this.end.copy(i),this},Z.prototype.copy=function(t){return this.start.copy(t.start),this.end.copy(t.end),this},Z.prototype.clone=function(){return(new this.constructor).copy(this)},Z.prototype.getCenter=function(t){return void 0===t&&(t=new x),t.addVectors(this.start,this.end).multiplyScalar(.5)},Z.prototype.delta=function(t){return void 0===t&&(t=new x),t.subVectors(this.end,this.start)},Z.prototype.lengthSquared=function(){return this.start.distanceToSquared(this.end)},Z.prototype.length=function(){return this.start.distanceTo(this.end)},Z.prototype.at=function(t,i){return this.delta(i).multiplyScalar(t).add(this.start)},Z.prototype.closestPointToPointParameter=function(t,i){X.subVectors(t,this.start),Y.subVectors(this.end,this.start);var n=Y.dot(Y),s=Y.dot(X);return i?Math.min(Math.max(s/n,0),1):s/n},Z.prototype.closestPointToPoint=function(t,i,n){void 0===i&&(i=!1),void 0===n&&(n=new x);var s=this.closestPointToPointParameter(t,i);return this.delta(n).multiplyScalar(s).add(this.start)},Z.prototype.equals=function(t){return t.start.equals(this.start)&&t.end.equals(this.end)};var U=new x,O=new x,B=new x,E=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};E.prototype.set=function(t,i,n,s,r,e,o,h,a,u,p,y,c,l,m,x){var f=this.elements;return f[0]=t,f[4]=i,f[8]=n,f[12]=s,f[1]=r,f[5]=e,f[9]=o,f[13]=h,f[2]=a,f[6]=u,f[10]=p,f[14]=y,f[3]=c,f[7]=l,f[11]=m,f[15]=x,this},E.prototype.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},E.prototype.copy=function(t){var i=t.elements,n=this.elements;return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],this},E.prototype.clone=function(){return(new this.constructor).fromArray(this.elements)},E.prototype.fromArray=function(t,i){void 0===i&&(i=0);var n,s=this.elements;for(n=0;n<16;++n)s[n]=t[n+i];return this},E.prototype.toArray=function(t,i){void 0===t&&(t=[]),void 0===i&&(i=0);var n,s=this.elements;for(n=0;n<16;++n)t[n+i]=s[n];return t},E.prototype.getMaxScaleOnAxis=function(){var t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,n,s))},E.prototype.copyPosition=function(t){var i=this.elements,n=t.elements;return i[12]=n[12],i[13]=n[13],i[14]=n[14],this},E.prototype.setPosition=function(t){var i=this.elements;return i[12]=t.x,i[13]=t.y,i[14]=t.z,this},E.prototype.extractBasis=function(t,i,n){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},E.prototype.makeBasis=function(t,i,n){return this.set(t.x,i.x,n.x,0,t.y,i.y,n.y,0,t.z,i.z,n.z,0,0,0,0,1),this},E.prototype.extractRotation=function(t){var i=this.elements,n=t.elements,s=1/U.setFromMatrixColumn(t,0).length(),r=1/U.setFromMatrixColumn(t,1).length(),e=1/U.setFromMatrixColumn(t,2).length();return i[0]=n[0]*s,i[1]=n[1]*s,i[2]=n[2]*s,i[4]=n[4]*r,i[5]=n[5]*r,i[6]=n[6]*r,i[8]=n[8]*e,i[9]=n[9]*e,i[10]=n[10]*e,this},E.prototype.makeRotationFromEuler=function(t){var i,n,s,r,e,o,h,a,u,p,y,c,l=this.elements,m=t.x,x=t.y,f=t.z,d=Math.cos(m),z=Math.sin(m),v=Math.cos(x),M=Math.sin(x),w=Math.cos(f),g=Math.sin(f);switch(t.order){case P.XYZ:i=d*w,n=d*g,s=z*w,r=z*g,l[0]=v*w,l[4]=-v*g,l[8]=M,l[1]=n+s*M,l[5]=i-r*M,l[9]=-z*v,l[2]=r-i*M,l[6]=s+n*M,l[10]=d*v;break;case P.YXZ:e=v*w,o=v*g,h=M*w,a=M*g,l[0]=e+a*z,l[4]=h*z-o,l[8]=d*M,l[1]=d*g,l[5]=d*w,l[9]=-z,l[2]=o*z-h,l[6]=a+e*z,l[10]=d*v;break;case P.ZXY:e=v*w,o=v*g,h=M*w,a=M*g,l[0]=e-a*z,l[4]=-d*g,l[8]=h+o*z,l[1]=o+h*z,l[5]=d*w,l[9]=a-e*z,l[2]=-d*M,l[6]=z,l[10]=d*v;break;case P.ZYX:i=d*w,n=d*g,s=z*w,r=z*g,l[0]=v*w,l[4]=s*M-n,l[8]=i*M+r,l[1]=v*g,l[5]=r*M+i,l[9]=n*M-s,l[2]=-M,l[6]=z*v,l[10]=d*v;break;case P.YZX:u=d*v,p=d*M,y=z*v,c=z*M,l[0]=v*w,l[4]=c-u*g,l[8]=y*g+p,l[1]=g,l[5]=d*w,l[9]=-z*w,l[2]=-M*w,l[6]=p*g+y,l[10]=u-c*g;break;case P.XZY:u=d*v,p=d*M,y=z*v,c=z*M,l[0]=v*w,l[4]=-g,l[8]=M*w,l[1]=u*g+c,l[5]=d*w,l[9]=p*g-y,l[2]=y*g-p,l[6]=z*w,l[10]=c*g+u}return l[3]=0,l[7]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this},E.prototype.makeRotationFromQuaternion=function(t){var i=this.elements,n=t.x,s=t.y,r=t.z,e=t.w,o=n+n,h=s+s,a=r+r,u=n*o,p=n*h,y=n*a,c=s*h,l=s*a,m=r*a,x=e*o,f=e*h,d=e*a;return i[0]=1-(c+m),i[4]=p-d,i[8]=y+f,i[1]=p+d,i[5]=1-(u+m),i[9]=l-x,i[2]=y-f,i[6]=l+x,i[10]=1-(u+c),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},E.prototype.lookAt=function(t,i,n){var s=this.elements,r=U,e=O,o=B;return o.subVectors(t,i),0===o.lengthSquared()&&(o.z=1),o.normalize(),r.crossVectors(n,o),0===r.lengthSquared()&&(1===Math.abs(n.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),r.crossVectors(n,o)),r.normalize(),e.crossVectors(o,r),s[0]=r.x,s[4]=e.x,s[8]=o.x,s[1]=r.y,s[5]=e.y,s[9]=o.y,s[2]=r.z,s[6]=e.z,s[10]=o.z,this},E.prototype.multiplyMatrices=function(t,i){var n=this.elements,s=t.elements,r=i.elements,e=s[0],o=s[4],h=s[8],a=s[12],u=s[1],p=s[5],y=s[9],c=s[13],l=s[2],m=s[6],x=s[10],f=s[14],d=s[3],z=s[7],v=s[11],M=s[15],w=r[0],g=r[4],b=r[8],S=r[12],q=r[1],P=r[5],A=r[9],T=r[13],k=r[2],F=r[6],V=r[10],C=r[14],X=r[3],Y=r[7],Z=r[11],U=r[15];return n[0]=e*w+o*q+h*k+a*X,n[4]=e*g+o*P+h*F+a*Y,n[8]=e*b+o*A+h*V+a*Z,n[12]=e*S+o*T+h*C+a*U,n[1]=u*w+p*q+y*k+c*X,n[5]=u*g+p*P+y*F+c*Y,n[9]=u*b+p*A+y*V+c*Z,n[13]=u*S+p*T+y*C+c*U,n[2]=l*w+m*q+x*k+f*X,n[6]=l*g+m*P+x*F+f*Y,n[10]=l*b+m*A+x*V+f*Z,n[14]=l*S+m*T+x*C+f*U,n[3]=d*w+z*q+v*k+M*X,n[7]=d*g+z*P+v*F+M*Y,n[11]=d*b+z*A+v*V+M*Z,n[15]=d*S+z*T+v*C+M*U,this},E.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},E.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},E.prototype.multiplyScalar=function(t){var i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this},E.prototype.determinant=function(){var t=this.elements,i=t[0],n=t[4],s=t[8],r=t[12],e=t[1],o=t[5],h=t[9],a=t[13],u=t[2],p=t[6],y=t[10],c=t[14],l=i*o,m=i*h,x=i*a,f=n*e,d=n*h,z=n*a,v=s*e,M=s*o,w=s*a,g=r*e,b=r*o,S=r*h;return t[3]*(S*p-w*p-b*y+z*y+M*c-d*c)+t[7]*(m*c-x*y+g*y-v*c+w*u-S*u)+t[11]*(x*p-l*c-g*p+f*c+b*u-z*u)+t[15]*(-M*u-m*p+l*y+v*p-f*y+d*u)},E.prototype.getInverse=function(t){var i,n=this.elements,s=t.elements,r=s[0],e=s[1],o=s[2],h=s[3],a=s[4],u=s[5],p=s[6],y=s[7],c=s[8],l=s[9],m=s[10],x=s[11],f=s[12],d=s[13],z=s[14],v=s[15],M=l*z*y-d*m*y+d*p*x-u*z*x-l*p*v+u*m*v,w=f*m*y-c*z*y-f*p*x+a*z*x+c*p*v-a*m*v,g=c*d*y-f*l*y+f*u*x-a*d*x-c*u*v+a*l*v,b=f*l*p-c*d*p-f*u*m+a*d*m+c*u*z-a*l*z,S=r*M+e*w+o*g+h*b;return 0!==S?(i=1/S,n[0]=M*i,n[1]=(d*m*h-l*z*h-d*o*x+e*z*x+l*o*v-e*m*v)*i,n[2]=(u*z*h-d*p*h+d*o*y-e*z*y-u*o*v+e*p*v)*i,n[3]=(l*p*h-u*m*h-l*o*y+e*m*y+u*o*x-e*p*x)*i,n[4]=w*i,n[5]=(c*z*h-f*m*h+f*o*x-r*z*x-c*o*v+r*m*v)*i,n[6]=(f*p*h-a*z*h-f*o*y+r*z*y+a*o*v-r*p*v)*i,n[7]=(a*m*h-c*p*h+c*o*y-r*m*y-a*o*x+r*p*x)*i,n[8]=g*i,n[9]=(f*l*h-c*d*h-f*e*x+r*d*x+c*e*v-r*l*v)*i,n[10]=(a*d*h-f*u*h+f*e*y-r*d*y-a*e*v+r*u*v)*i,n[11]=(c*u*h-a*l*h-c*e*y+r*l*y+a*e*x-r*u*x)*i,n[12]=b*i,n[13]=(c*d*o-f*l*o+f*e*m-r*d*m-c*e*z+r*l*z)*i,n[14]=(f*u*o-a*d*o-f*e*p+r*d*p+a*e*z-r*u*z)*i,n[15]=(a*l*o-c*u*o+c*e*p-r*l*p-a*e*m+r*u*m)*i):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this},E.prototype.transpose=function(){var t,i=this.elements;return t=i[1],i[1]=i[4],i[4]=t,t=i[2],i[2]=i[8],i[8]=t,t=i[6],i[6]=i[9],i[9]=t,t=i[3],i[3]=i[12],i[12]=t,t=i[7],i[7]=i[13],i[13]=t,t=i[11],i[11]=i[14],i[14]=t,this},E.prototype.scale=function(t,i,n){var s=this.elements;return s[0]*=t,s[4]*=i,s[8]*=n,s[1]*=t,s[5]*=i,s[9]*=n,s[2]*=t,s[6]*=i,s[10]*=n,s[3]*=t,s[7]*=i,s[11]*=n,this},E.prototype.makeScale=function(t,i,n){return this.set(t,0,0,0,0,i,0,0,0,0,n,0,0,0,0,1),this},E.prototype.makeTranslation=function(t,i,n){return this.set(1,0,0,t,0,1,0,i,0,0,1,n,0,0,0,1),this},E.prototype.makeRotationX=function(t){var i=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,i,-n,0,0,n,i,0,0,0,0,1),this},E.prototype.makeRotationY=function(t){var i=Math.cos(t),n=Math.sin(t);return this.set(i,0,n,0,0,1,0,0,-n,0,i,0,0,0,0,1),this},E.prototype.makeRotationZ=function(t){var i=Math.cos(t),n=Math.sin(t);return this.set(i,-n,0,0,n,i,0,0,0,0,1,0,0,0,0,1),this},E.prototype.makeRotationAxis=function(t,i){var n=Math.cos(i),s=Math.sin(i),r=1-n,e=t.x,o=t.y,h=t.z,a=r*e,u=r*o;return this.set(a*e+n,a*o-s*h,a*h+s*o,0,a*o+s*h,u*o+n,u*h-s*e,0,a*h-s*o,u*h+s*e,r*h*h+n,0,0,0,0,1),this},E.prototype.makeShear=function(t,i,n){return this.set(1,i,n,0,t,1,n,0,t,i,1,0,0,0,0,1),this},E.prototype.compose=function(t,i,n){return this.makeRotationFromQuaternion(i),this.scale(n.x,n.y,n.z),this.setPosition(t),this},E.prototype.decompose=function(t,i,n){var s=this.elements,r=s[0],e=s[1],o=s[2],h=s[4],a=s[5],u=s[6],p=s[8],y=s[9],c=s[10],l=this.determinant(),m=U.set(r,e,o).length()*(l<0?-1:1),x=U.set(h,a,u).length(),f=U.set(p,y,c).length(),d=1/m,z=1/x,v=1/f;return t.x=s[12],t.y=s[13],t.z=s[14],s[0]*=d,s[1]*=d,s[2]*=d,s[4]*=z,s[5]*=z,s[6]*=z,s[8]*=v,s[9]*=v,s[10]*=v,i.setFromRotationMatrix(this),s[0]=r,s[1]=e,s[2]=o,s[4]=h,s[5]=a,s[6]=u,s[8]=p,s[9]=y,s[10]=c,n.x=m,n.y=x,n.z=f,this},E.prototype.makePerspective=function(t,i,n,s,r,e){var o=this.elements,h=2*r/(i-t),a=2*r/(n-s),u=(i+t)/(i-t),p=(n+s)/(n-s),y=-(e+r)/(e-r),c=-2*e*r/(e-r);return o[0]=h,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=a,o[9]=p,o[13]=0,o[2]=0,o[6]=0,o[10]=y,o[14]=c,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},E.prototype.makeOrthographic=function(t,i,n,s,r,e){var o=this.elements,h=1/(i-t),a=1/(n-s),u=1/(e-r),p=(i+t)*h,y=(n+s)*a,c=(e+r)*u;return o[0]=2*h,o[4]=0,o[8]=0,o[12]=-p,o[1]=0,o[5]=2*a,o[9]=0,o[13]=-y,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-c,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},E.prototype.equals=function(t){var i,n=this.elements,s=t.elements,r=!0;for(i=0;r&&i<16;++i)n[i]!==s[i]&&(r=!1);return r};var R=new x,j=new x,Q=function(t,i){void 0===t&&(t=new x(1,0,0)),void 0===i&&(i=0),this.normal=t,this.constant=i};Q.prototype.set=function(t,i){return this.normal.copy(t),this.constant=i,this},Q.prototype.setComponents=function(t,i,n,s){return this.normal.set(t,i,n),this.constant=s,this},Q.prototype.copy=function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},Q.prototype.clone=function(){return(new this.constructor).copy(this)},Q.prototype.setFromNormalAndCoplanarPoint=function(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this},Q.prototype.setFromCoplanarPoints=function(t,i,n){var s=R.subVectors(n,i).cross(j.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(s,R),this},Q.prototype.normalize=function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},Q.prototype.negate=function(){return this.normal.negate(),this.constant=-this.constant,this},Q.prototype.distanceToPoint=function(t){return this.normal.dot(t)+this.constant},Q.prototype.distanceToSphere=function(t){return this.distanceToPoint(t.center)-t.radius},Q.prototype.projectPoint=function(t,i){return i.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},Q.prototype.coplanarPoint=function(t){return t.copy(this.normal).multiplyScalar(-this.constant)},Q.prototype.translate=function(t){return this.constant-=t.dot(this.normal),this},Q.prototype.intersectLine=function(t,i){var n=t.delta(R),s=this.normal.dot(n);if(0===s)0===this.distanceToPoint(t.start)&&i.copy(t.start);else{var r=-(t.start.dot(this.normal)+this.constant)/s;r>=0&&r<=1&&i.copy(n).multiplyScalar(r).add(t.start)}return i},Q.prototype.intersectsLine=function(t){var i=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return i<0&&n>0||n<0&&i>0},Q.prototype.intersectsBox=function(t){return t.intersectsPlane(this)},Q.prototype.intersectsSphere=function(t){return t.intersectsPlane(this)},Q.prototype.equals=function(t){return t.normal.equals(this.normal)&&t.constant===this.constant};var _=function(t,i,n){void 0===t&&(t=1),void 0===i&&(i=0),void 0===n&&(n=0),this.radius=t,this.phi=i,this.theta=n};_.prototype.set=function(t,i,n){return this.radius=t,this.phi=i,this.theta=n,this},_.prototype.copy=function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},_.prototype.clone=function(){return(new this.constructor).copy(this)},_.prototype.setFromVector3=function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Math.min(Math.max(t.y/this.radius,-1),1))),this.makeSafe()},_.prototype.makeSafe=function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this};var D=function(){this.elements=new Float32Array([1,0,0,1,0,1])};D.prototype.set=function(t,i,n,s,r,e){var o=this.elements;return o[0]=t,o[1]=i,o[3]=s,o[2]=n,o[4]=r,o[5]=e,this},D.prototype.identity=function(){return this.set(1,0,0,1,0,1),this},D.prototype.copy=function(t){var i=t.elements;return this.set(i[0],i[1],i[2],i[3],i[4],i[5]),this},D.prototype.clone=function(){return(new this.constructor).copy(this)},D.prototype.toMatrix3=function(t){var i=t.elements;t.set(i[0],i[1],i[2],i[1],i[3],i[4],i[2],i[4],i[5])},D.prototype.add=function(t){var i=this.elements,n=t.elements;return i[0]+=n[0],i[1]+=n[1],i[3]+=n[3],i[2]+=n[2],i[4]+=n[4],i[5]+=n[5],this},D.prototype.norm=function(){var t=this.elements,i=t[1]*t[1],n=t[2]*t[2],s=t[4]*t[4];return Math.sqrt(t[0]*t[0]+i+n+i+t[3]*t[3]+s+n+s+t[5]*t[5])},D.prototype.off=function(){var t=this.elements;return Math.sqrt(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))},D.prototype.applyToVector3=function(t){var i=t.x,n=t.y,s=t.z,r=this.elements;return t.x=r[0]*i+r[1]*n+r[2]*s,t.y=r[1]*i+r[3]*n+r[4]*s,t.z=r[2]*i+r[4]*n+r[5]*s,t},D.prototype.equals=function(t){var i,n=this.elements,s=t.elements,r=!0;for(i=0;r&&i<6;++i)n[i]!==s[i]&&(r=!1);return r},D.calculateIndex=function(t,i){return 3-(3-t)*(2-t)/2+i};var I=function(t,i,n,s){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),this.x=t,this.y=i,this.z=n,this.w=s};I.prototype.set=function(t,i,n,s){return this.x=t,this.y=i,this.z=n,this.w=s,this},I.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},I.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z,this.w)},I.prototype.fromArray=function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},I.prototype.toArray=function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t},I.prototype.setAxisAngleFromQuaternion=function(t){this.w=2*Math.acos(t.w);var i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this},I.prototype.setAxisAngleFromRotationMatrix=function(t){var i,n,s,r,e,o,h,a,u,p,y,c=.01,l=t.elements,m=l[0],x=l[4],f=l[8],d=l[1],z=l[5],v=l[9],M=l[2],w=l[6],g=l[10];return Math.abs(x-d)<c&&Math.abs(f-M)<c&&Math.abs(v-w)<c?Math.abs(x+d)<.1&&Math.abs(f+M)<.1&&Math.abs(v+w)<.1&&Math.abs(m+z+g-3)<.1?this.set(1,0,0,0):(i=Math.PI,h=(g+1)/2,a=(x+d)/4,u=(f+M)/4,p=(v+w)/4,(e=(m+1)/2)>(o=(z+1)/2)&&e>h?e<c?(n=0,s=.707106781,r=.707106781):(s=a/(n=Math.sqrt(e)),r=u/n):o>h?o<c?(n=.707106781,s=0,r=.707106781):(n=a/(s=Math.sqrt(o)),r=p/s):h<c?(n=.707106781,s=.707106781,r=0):(n=u/(r=Math.sqrt(h)),s=p/r),this.set(n,s,r,i)):(y=Math.sqrt((w-v)*(w-v)+(f-M)*(f-M)+(d-x)*(d-x)),Math.abs(y)<.001&&(y=1),this.x=(w-v)/y,this.y=(f-M)/y,this.z=(d-x)/y,this.w=Math.acos((m+z+g-1)/2)),this},I.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},I.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},I.prototype.addVectors=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},I.prototype.addScaledVector=function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this},I.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},I.prototype.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},I.prototype.subVectors=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},I.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},I.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},I.prototype.multiplyVectors=function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this.w=t.w*i.w,this},I.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this},I.prototype.divideScalar=function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},I.prototype.applyMatrix4=function(t){var i=this.x,n=this.y,s=this.z,r=this.w,e=t.elements;return this.x=e[0]*i+e[4]*n+e[8]*s+e[12]*r,this.y=e[1]*i+e[5]*n+e[9]*s+e[13]*r,this.z=e[2]*i+e[6]*n+e[10]*s+e[14]*r,this.w=e[3]*i+e[7]*n+e[11]*s+e[15]*r,this},I.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},I.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},I.prototype.lengthManhattan=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},I.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},I.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},I.prototype.distanceToManhattan=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)},I.prototype.distanceToSquared=function(t){var i=this.x-t.x,n=this.y-t.y,s=this.z-t.z,r=this.w-t.w;return i*i+n*n+s*s+r*r},I.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},I.prototype.normalize=function(){return this.divideScalar(this.length())},I.prototype.setLength=function(t){return this.normalize().multiplyScalar(t)},I.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},I.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},I.prototype.clamp=function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this},I.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},I.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},I.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},I.prototype.lerp=function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this},I.prototype.lerpVectors=function(t,i,n){return this.subVectors(i,t).multiplyScalar(n).add(t)},I.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w};var L=new x,N=function(t,i){void 0===t&&(t=new x),void 0===i&&(i=new x),this.min=t,this.max=i,this.children=null};N.prototype.getCenter=function(t){return void 0===t&&(t=new x),t.addVectors(this.min,this.max).multiplyScalar(.5)},N.prototype.getDimensions=function(t){return void 0===t&&(t=new x),t.subVectors(this.max,this.min)},N.prototype.split=function(){var t,i,n=this,s=this.min,r=this.max,e=this.getCenter(L),o=this.children=[null,null,null,null,null,null,null,null];for(t=0;t<8;++t)i=G[t],o[t]=new n.constructor(new x(0===i[0]?s.x:e.x,0===i[1]?s.y:e.y,0===i[2]?s.z:e.z),new x(0===i[0]?e.x:r.x,0===i[1]?e.y:r.y,0===i[2]?e.z:r.z))};var G=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],H=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],J=new x,K=function(t,i){void 0===t&&(t=new x),void 0===i&&(i=0),this.min=t,this.size=i,this.children=null},W={max:{configurable:!0}};W.max.get=function(){return this.min.clone().addScalar(this.size)},K.prototype.getCenter=function(t){return void 0===t&&(t=new x),t.copy(this.min).addScalar(.5*this.size)},K.prototype.getDimensions=function(t){return void 0===t&&(t=new x),t.set(this.size,this.size,this.size)},K.prototype.split=function(){var t,i,n=this,s=this.min,r=this.getCenter(J),e=.5*this.size,o=this.children=[null,null,null,null,null,null,null,null];for(t=0;t<8;++t)i=G[t],o[t]=new n.constructor(new x(0===i[0]?s.x:r.x,0===i[1]?s.y:r.y,0===i[2]?s.z:r.z),e)},Object.defineProperties(K.prototype,W);var $=function(t,i){void 0===t&&(t=null),void 0===i&&(i=!1),this.value=t,this.done=i};$.prototype.reset=function(){this.value=null,this.done=!1};var tt=new d,it=function(t,i){void 0===i&&(i=null),this.octree=t,this.region=i,this.cull=null!==i,this.result=new $,this.trace=null,this.indices=null,this.reset()};it.prototype.reset=function(){var t=this.octree.root;return this.trace=[],this.indices=[],null!==t&&(tt.min=t.min,tt.max=t.max,this.cull&&!this.region.intersectsBox(tt)||(this.trace.push(t),this.indices.push(0))),this.result.reset(),this},it.prototype.next=function(){for(var t,i,n,s=this.cull,r=this.region,e=this.indices,o=this.trace,h=null,a=o.length-1;null===h&&a>=0;)if(t=e[a],i=o[a].children,++e[a],t<8)if(null!==i){if(n=i[t],s&&(tt.min=n.min,tt.max=n.max,!r.intersectsBox(tt)))continue;o.push(n),e.push(0),++a}else h=o.pop(),e.pop();else o.pop(),e.pop(),--a;return this.result.value=h,this.result.done=null===h,this.result},it.prototype.return=function(t){return this.result.value=t,this.result.done=!0,this.result},it.prototype[Symbol.iterator]=function(){return this};var nt=new Uint8Array([0,1,2,3,4,5,6,7,0]),st=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],rt=new x,et=new x,ot=new x,ht=new x,at=new x,ut=new x,pt=new x,yt=function(){};yt.intersectOctree=function(t,i,n){var s,e,o,h,a,u,p,y,c;t.getDimensions(rt),et.copy(rt).multiplyScalar(.5),ht.copy(t.min).sub(t.min),at.copy(t.max).sub(t.min),ut.copy(i.ray.direction),pt.copy(i.ray.origin),pt.sub(t.getCenter(ot)).add(et),nt[8]=nt[0],ut.x<0&&(pt.x=rt.x-pt.x,ut.x=-ut.x,nt[8]|=nt[4]),ut.y<0&&(pt.y=rt.y-pt.y,ut.y=-ut.y,nt[8]|=nt[2]),ut.z<0&&(pt.z=rt.z-pt.z,ut.z=-ut.z,nt[8]|=nt[1]),s=1/ut.x,e=1/ut.y,o=1/ut.z,h=(ht.x-pt.x)*s,a=(at.x-pt.x)*s,u=(ht.y-pt.y)*e,p=(at.y-pt.y)*e,y=(ht.z-pt.z)*o,c=(at.z-pt.z)*o,Math.max(Math.max(h,u),y)<Math.min(Math.min(a,p),c)&&r(t.root,h,u,y,a,p,c,i,n)};var ct=new d,lt=function(t,i){this.root=void 0!==t&&void 0!==i?new N(t,i):null},mt={min:{configurable:!0},max:{configurable:!0},children:{configurable:!0}};mt.min.get=function(){return this.root.min},mt.max.get=function(){return this.root.max},mt.children.get=function(){return this.root.children},lt.prototype.getCenter=function(t){return this.root.getCenter(t)},lt.prototype.getDimensions=function(t){return this.root.getDimensions(t)},lt.prototype.getDepth=function(){return e(this.root)},lt.prototype.cull=function(t){var i=[];return o(this.root,t,i),i},lt.prototype.findOctantsByLevel=function(t){var i=[];return h(this.root,t,0,i),i},lt.prototype.raycast=function(t,i){return void 0===i&&(i=[]),yt.intersectOctree(this,t,i),i},lt.prototype.leaves=function(t){return new it(this,t)},lt.prototype[Symbol.iterator]=function(){return new it(this)},Object.defineProperties(lt.prototype,mt);var xt=new x,ft=function(t){function i(i,n){t.call(this,i,n),this.points=null,this.data=null}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.distanceToSquared=function(t){return xt.copy(t).clamp(this.min,this.max).sub(t).lengthSquared()},i.prototype.distanceToCenterSquared=function(t){var i=this.getCenter(xt),n=t.x-i.x,s=t.y-i.x,r=t.z-i.z;return n*n+s*s+r*r},i.prototype.contains=function(t,i){var n=this.min,s=this.max;return t.x>=n.x-i&&t.y>=n.y-i&&t.z>=n.z-i&&t.x<=s.x+i&&t.y<=s.y+i&&t.z<=s.z+i},i.prototype.redistribute=function(t){var i,n,s,r,e,o,h,a=this.children,u=this.points,p=this.data;if(null!==a)for(i=0,s=u.length;i<s;++i)for(o=u[i],h=p[i],n=0,r=a.length;n<r;++n)if((e=a[n]).contains(o,t)){null===e.points&&(e.points=[],e.data=[]),e.points.push(o),e.data.push(h);break}this.points=null,this.data=null},i.prototype.merge=function(){var t,i,n,s=this,r=this.children;if(null!==r){for(this.points=[],this.data=[],t=0,i=r.length;t<i;++t)null!==(n=r[t]).points&&((e=s.points).push.apply(e,n.points),(o=s.data).push.apply(o,n.data));this.children=null}var e,o},i}(N),dt=function(t,i,n,s){void 0===s&&(s=null),this.distance=t,this.distanceToRay=i,this.point=n,this.object=s},zt=1e-6,vt=function(t){function i(i,n,s,r,e){void 0===s&&(s=0),void 0===r&&(r=8),void 0===e&&(e=8),t.call(this),this.root=new ft(i,n),this.bias=Math.max(0,s),this.maxPoints=Math.max(1,Math.round(r)),this.maxDepth=Math.max(0,Math.round(e)),this.pointCount=0}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.countPoints=function(t){return a(t)},i.prototype.put=function(t,i){return u(t,i,this,this.root,0)},i.prototype.remove=function(t){return p(t,this,this.root,null)},i.prototype.fetch=function(t){return y(t,this,this.root)},i.prototype.move=function(t,i){return c(t,i,this,this.root,null,0)},i.prototype.findNearestPoint=function(t,i,n){return void 0===i&&(i=1/0),void 0===n&&(n=!1),l(t,i,n,this.root)},i.prototype.findPoints=function(t,i,n){void 0===n&&(n=!1);var s=[];return m(t,i,n,this.root,s),s},i.prototype.raycast=function(i,n){void 0===n&&(n=[]);var s=t.prototype.raycast.call(this,i);return s.length>0&&this.testPoints(s,i,n),n},i.prototype.testPoints=function(t,i,n){var s,r,e,o,h,a,u,p,y,c,l,m=i.params.Points.threshold,x=m*m;for(h=0,u=t.length;h<u;++h)if(y=t[h],null!==(c=y.points))for(a=0,p=c.length;a<p;++a)l=c[a],(o=i.ray.distanceSqToPoint(l))<x&&(s=i.ray.closestPointToPoint(l),(r=i.ray.origin.distanceTo(s))>=i.near&&r<=i.far&&(e=Math.sqrt(o),n.push(new dt(r,e,s,y.data[a]))))},i}(lt),Mt=function(){};Mt.recycleOctants=function(t,i){var n,s,r,e,o=new x,h=new x,a=new x,u=t.min,p=t.getCenter(),y=t.getDimensions().multiplyScalar(.5),c=t.children,l=i.length;for(n=0;n<8;++n)for(r=G[n],h.addVectors(u,o.fromArray(r).multiply(y)),a.addVectors(p,o.fromArray(r).multiply(y)),s=0;s<l;++s)if(null!==(e=i[s])&&h.equals(e.min)&&a.equals(e.max)){c[n]=e,i[s]=null;break}},t.CubicOctant=K,t.edges=H,t.Octant=N,t.Octree=lt,t.OctantIterator=it,t.OctreeRaycaster=yt,t.pattern=G,t.PointOctant=ft,t.PointOctree=vt,t.RayPointIntersection=dt,t.OctreeUtils=Mt,Object.defineProperty(t,"__esModule",{value:!0})});