/**
 * sparse-octree v3.0.0 build May 28 2017
 * https://github.com/vanruesc/sparse-octree
 * Copyright 2017 Raoul van RÃ¼schen, Zlib
 */

!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.SPARSEOCTREE=a.SPARSEOCTREE||{})}(this,function(a){"use strict";function b(a,b,c,d,e,f){var g=0;return a>b&&a>c?(e<a&&(g|=2),f<a&&(g|=1)):b>c?(d<b&&(g|=4),f<b&&(g|=1)):(d<c&&(g|=4),e<c&&(g|=2)),g}function c(a,b,c,d){var e=void 0,f=0;return b<c?(e=b,f=0):(e=c,f=1),d<e&&(f=2),D[a][f]}function d(a,e,f,g,h,i,j,k,l){var m=a.children,n=void 0,o=void 0,p=void 0,q=void 0;if(h>=0&&i>=0&&j>=0)if(null===m)l.push(a);else{o=.5*(e+h),p=.5*(f+i),q=.5*(g+j),n=b(e,f,g,o,p,q);do{switch(n){case 0:d(m[C[8]],e,f,g,o,p,q,k,l),n=c(n,o,p,q);break;case 1:d(m[C[8]^C[1]],e,f,q,o,p,j,k,l),n=c(n,o,p,j);break;case 2:d(m[C[8]^C[2]],e,p,g,o,i,q,k,l),n=c(n,o,i,q);break;case 3:d(m[C[8]^C[3]],e,p,q,o,i,j,k,l),n=c(n,o,i,j);break;case 4:d(m[C[8]^C[4]],o,f,g,h,p,q,k,l),n=c(n,h,p,q);break;case 5:d(m[C[8]^C[5]],o,f,q,h,p,j,k,l),n=c(n,h,p,j);break;case 6:d(m[C[8]^C[6]],o,p,g,h,i,q,k,l),n=c(n,h,i,q);break;case 7:d(m[C[8]^C[7]],o,p,q,h,i,j,k,l),n=8}}while(n<8)}}function e(a){var b=a.children,c=0,d=void 0,f=void 0,g=void 0;if(null!==b)for(d=0,f=b.length;d<f;++d)(g=1+e(b[d]))>c&&(c=g);return c}function f(a,b,c){var d=a.children,e=void 0,g=void 0;if(F.min=a.min,F.max=a.max,b.intersectsBox(F))if(null!==d)for(e=0,g=d.length;e<g;++e)f(d[e],b,c);else c.push(a)}function g(a,b,c,d){var e=a.children,f=void 0,h=void 0;if(c===b)d.push(a);else if(null!==e)for(++c,f=0,h=e.length;f<h;++f)g(e[f],b,c,d)}function h(a){var b=a.children,c=0,d=void 0,e=void 0;if(null!==b)for(d=0,e=b.length;d<e;++d)c+=h(b[d]);else null!==a.points&&(c=a.points.length);return c}function i(a,b,c,d,e,f,g){var h=a.children,j=!1,k=!1,l=void 0,m=void 0;if(a.contains(b,e)){if(null===h){if(null===a.points)a.points=[],a.data=[];else for(l=0,m=a.points.length;!j&&l<m;++l)j=a.points[l].equals(b);j?(a.data[l-1]=c,k=!0):a.points.length<f||d===g?(a.points.push(b.clone()),a.data.push(c),k=!0):(a.split(),a.redistribute(e),h=a.children)}if(null!==h)for(++d,l=0,m=h.length;!k&&l<m;++l)k=i(h[l],b,c,d,e,f,g)}return k}function j(a,b,c,d,e){var f=a.children,g=!1,i=void 0,k=void 0,l=void 0,m=void 0,n=void 0;if(a.contains(c,d))if(null!==f)for(i=0,k=f.length;!g&&i<k;++i)g=j(f[i],a,c,d,e);else if(null!==a.points)for(l=a.points,m=a.data,i=0,k=l.length;!g&&i<k;++i)l[i].equals(c)&&(n=k-1,i<n&&(l[i]=l[n],m[i]=m[n]),l.pop(),m.pop(),null!==b&&h(b)<=e&&b.merge(),g=!0);return g}function k(a,b,c,d){var e=a.children,f=null,g=void 0,h=void 0,i=void 0;if(a.contains(b,c))if(null!==e)for(g=0,h=e.length;null===f&&g<h;++g)f=k(e[g],b,c,d);else for(i=a.points,g=0,h=i.length;null===f&&g<h;++g)b.distanceToSquared(i[g])<=d&&(f=a.data[g]);return f}function l(a,b,c,d){var e=a.points,f=a.children,g=null,h=c,i=void 0,j=void 0,k=void 0,m=void 0,n=void 0,o=void 0,p=void 0;if(null!==f)for(n=f.map(function(a){return{octant:a,distance:a.distanceToCenterSquared(b)}}).sort(function(a,b){return a.distance-b.distance}),i=0,j=n.length;i<j;++i)o=n[i].octant,o.contains(b,h)&&null!==(p=l(o,b,h,d))&&(m=p.point.distanceToSquared(b),(!d||m>0)&&m<h&&(h=m,g=p));else if(null!==e)for(i=0,j=e.length;i<j;++i)k=e[i],m=b.distanceToSquared(k),(!d||m>0)&&m<h&&(h=m,g={point:k.clone(),data:a.data[i]});return g}function m(a,b,c,d,e){var f=a.points,g=a.children,h=c*c,i=void 0,j=void 0,k=void 0,l=void 0,n=void 0;if(null!==g)for(i=0,j=g.length;i<j;++i)n=g[i],n.contains(b,c)&&m(n,b,c,d,e);else if(null!==f)for(i=0,j=f.length;i<j;++i)k=f[i],l=b.distanceToSquared(k),(!d||l>0)&&l<=h&&e.push({point:k.clone(),data:a.data[i]})}var n=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},o=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),p=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},q=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},r=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},s=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)},t=(function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,a),this.x=b,this.y=c}o(a,[{key:"set",value:function(a,b){return this.x=a,this.y=b,this}},{key:"copy",value:function(a){return this.x=a.x,this.y=a.y,this}},{key:"fromArray",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=a[b],this.y=a[b+1],this}},{key:"toArray",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a[b]=this.x,a[b+1]=this.y,a}},{key:"equals",value:function(a){return a.x===this.x&&a.y===this.y}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"add",value:function(a){return this.x+=a.x,this.y+=a.y,this}},{key:"addScaledVector",value:function(a,b){return this.x+=a.x*b,this.y+=a.y*b,this}},{key:"addScalar",value:function(a){return this.x+=a,this.y+=a,this}},{key:"addVectors",value:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this}},{key:"sub",value:function(a){return this.x-=a.x,this.y-=a.y,this}},{key:"subScalar",value:function(a){return this.x-=a,this.y-=a,this}},{key:"subVectors",value:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this}},{key:"multiply",value:function(a){return this.x*=a.x,this.y*=a.y,this}},{key:"multiplyScalar",value:function(a){return isFinite(a)?(this.x*=a,this.y*=a):(this.x=0,this.y=0),this}},{key:"multiplyVectors",value:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this}},{key:"divide",value:function(a){return this.x/=a.x,this.y/=a.y,this}},{key:"divideScalar",value:function(a){return this.multiplyScalar(1/a)}},{key:"divideVectors",value:function(a,b){return this.x=a.x/b.x,this.y=a.y/b.y,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(a){return this.x*a.x+this.y*a.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"distanceTo",value:function(a){return Math.sqrt(this.distanceToSquared(a))}},{key:"distanceToSquared",value:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"min",value:function(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this}},{key:"max",value:function(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this}},{key:"clamp",value:function(a,b){return this.x=Math.max(a.x,Math.min(b.x,this.x)),this.y=Math.max(a.y,Math.min(b.y,this.y)),this}}])}(),function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,a),this.x=b,this.y=c,this.z=d}return o(a,[{key:"set",value:function(a,b,c){return this.x=a,this.y=b,this.z=c,this}},{key:"copy",value:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}},{key:"fromArray",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=a[b],this.y=a[b+1],this.z=a[b+2],this}},{key:"toArray",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a}},{key:"equals",value:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"add",value:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}},{key:"addScaledVector",value:function(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this}},{key:"addScalar",value:function(a){return this.x+=a,this.y+=a,this.z+=a,this}},{key:"addVectors",value:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this}},{key:"sub",value:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}},{key:"subScalar",value:function(a){return this.x-=a,this.y-=a,this.z-=a,this}},{key:"subVectors",value:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this}},{key:"multiply",value:function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}},{key:"multiplyScalar",value:function(a){return isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):(this.x=0,this.y=0,this.z=0),this}},{key:"multiplyVectors",value:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this}},{key:"divide",value:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this}},{key:"divideScalar",value:function(a){return this.multiplyScalar(1/a)}},{key:"divideVectors",value:function(a,b){return this.x=a.x/b.x,this.y=a.y/b.y,this.z=a.z/b.z,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(a){return this.x*a.x+this.y*a.y+this.z*a.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distanceTo",value:function(a){return Math.sqrt(this.distanceToSquared(a))}},{key:"distanceToSquared",value:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"min",value:function(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this}},{key:"max",value:function(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this}},{key:"clamp",value:function(a,b){return this.x=Math.max(a.x,Math.min(b.x,this.x)),this.y=Math.max(a.y,Math.min(b.y,this.y)),this.z=Math.max(a.z,Math.min(b.z,this.z)),this}},{key:"applyMatrix3",value:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this}},{key:"applyMatrix4",value:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this}}]),a}()),u=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t(1/0,1/0,1/0),c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t(-1/0,-1/0,-1/0);n(this,a),this.min=b,this.max=c}return o(a,[{key:"set",value:function(a,b){return this.min.copy(a),this.max.copy(b),this}},{key:"copy",value:function(a){return this.min.copy(a.min),this.max.copy(a.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"expandByPoint",value:function(a){return this.min.min(a),this.max.max(a),this}},{key:"union",value:function(a){return this.min.min(a.min),this.max.max(a.max),this}},{key:"setFromPoints",value:function(a){var b=void 0,c=void 0;for(b=0,c=a.length;b<c;++b)this.expandByPoint(a[b]);return this}},{key:"setFromCenterAndSize",value:function(a,b){var c=b.clone().multiplyScalar(.5);return this.min.copy(a).sub(c),this.max.copy(a).add(c),this}},{key:"intersectsBox",value:function(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)}}]),a}(),v=(function(){function a(){n(this,a),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}o(a,[{key:"set",value:function(a,b,c,d,e,f,g,h,i){var j=this.elements;return j[0]=a,j[3]=b,j[6]=c,j[1]=d,j[4]=e,j[7]=f,j[2]=g,j[5]=h,j[8]=i,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(a){var b=a.elements;return this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8])}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])}(),function(){function a(){n(this,a),this.elements=new Float32Array([1,0,0,1,0,1])}o(a,[{key:"set",value:function(a,b,c,d,e,f){var g=this.elements;return g[0]=a,g[1]=b,g[3]=d,g[2]=c,g[4]=e,g[5]=f,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(a){var b=a.elements;return this.set(b[0],b[1],b[2],b[3],b[4],b[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(a){var b=a.elements;a.set(b[0],b[1],b[2],b[1],b[3],b[4],b[2],b[4],b[5])}},{key:"add",value:function(a){var b=this.elements,c=a.elements;return b[0]+=c[0],b[1]+=c[1],b[3]+=c[3],b[2]+=c[2],b[4]+=c[4],b[5]+=c[5],this}},{key:"norm",value:function(){var a=this.elements,b=a[1]*a[1],c=a[2]*a[2],d=a[4]*a[4];return Math.sqrt(a[0]*a[0]+b+c+b+a[3]*a[3]+d+c+d+a[5]*a[5])}},{key:"off",value:function(){var a=this.elements;return Math.sqrt(2*(a[1]*a[1]+a[2]*a[2]+a[4]*a[4]))}},{key:"applyToVector3",value:function(a){var b=a.x,c=a.y,d=a.z,e=this.elements;return a.x=e[0]*b+e[1]*c+e[2]*d,a.y=e[1]*b+e[3]*c+e[4]*d,a.z=e[2]*b+e[4]*c+e[5]*d,a}}],[{key:"calculateIndex",value:function(a,b){return 3-(3-a)*(2-a)/2+b}}])}(),function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t;n(this,a),this.min=b,this.max=c,this.children=null}return o(a,[{key:"getCenter",value:function(){return this.min.clone().add(this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return this.max.clone().sub(this.min)}},{key:"split",value:function(a){var b=this.min,c=this.max,d=this.getCenter(),e=void 0,f=void 0,g=0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0;for(Array.isArray(a)&&(i=this.getDimensions().multiplyScalar(.5),j=[new t,new t,new t],g=a.length),this.children=[],e=0;e<8;++e){if(h=w[e],l=null,g>0)for(j[1].addVectors(b,j[0].fromArray(h).multiply(i)),j[2].addVectors(d,j[0].fromArray(h).multiply(i)),f=0;f<g;++f)if(null!==(k=a[f])&&j[1].equals(k.min)&&j[2].equals(k.max)){l=k,a[f]=null;break}this.children.push(null!==l?l:new this.constructor(new t(0===h[0]?b.x:d.x,0===h[1]?b.y:d.y,0===h[2]?b.z:d.z),new t(0===h[0]?d.x:c.x,0===h[1]?d.y:c.y,0===h[2]?d.z:c.z)))}}}]),a}()),w=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],x=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],y=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new t,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,a),this.min=b,this.size=c,this.children=null}return o(a,[{key:"getCenter",value:function(){return this.min.clone().addScalar(.5*this.size)}},{key:"getDimensions",value:function(){return new t(this.size,this.size,this.size)}},{key:"split",value:function(a){var b=this.min,c=this.getCenter(),d=.5*this.size,e=void 0,f=void 0,g=0,h=void 0,i=void 0,j=void 0,k=void 0;for(Array.isArray(a)&&(i=new t,g=a.length),this.children=[],e=0;e<8;++e){if(h=w[e],k=null,g>0)for(i.fromArray(h).multiplyScalar(d).add(b),f=0;f<g;++f)if(null!==(j=a[f])&&j.size===d&&i.equals(j.min)){k=j,a[f]=null;break}this.children.push(null!==k?k:new this.constructor(new t(0===h[0]?b.x:c.x,0===h[1]?b.y:c.y,0===h[2]?b.z:c.z),d))}}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),a}(),z=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n(this,a),this.value=b,this.done=c}return o(a,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),a}(),A=new u,B=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n(this,a),this.octree=b,this.region=c,this.cull=null!==c,this.result=new z,this.trace=null,this.indices=null,this.reset()}return o(a,[{key:"reset",value:function(){var a=this.octree.root;return this.trace=[],this.indices=[],null!==a&&(A.min=a.min,A.max=a.max,this.cull&&!this.region.intersectsBox(A)||(this.trace.push(a),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var a=this.cull,b=this.region,c=this.indices,d=this.trace,e=null,f=d.length-1,g=void 0,h=void 0,i=void 0;null===e&&f>=0;)if(g=c[f],h=d[f].children,++c[f],g<8)if(null!==h){if(i=h[g],a&&(A.min=i.min,A.max=i.max,!b.intersectsBox(A)))continue;d.push(i),c.push(0),++f}else e=d.pop(),c.pop();else d.pop(),c.pop(),--f;return this.result.value=e,this.result.done=null===e,this.result}},{key:"return",value:function(a){return this.result.value=a,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),a}(),C=new Uint8Array([0,1,2,3,4,5,6,7,0]),D=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],E=function(){function a(){n(this,a)}return o(a,null,[{key:"intersectOctree",value:function(a,b,c){var e=a.getDimensions(),f=e.clone().multiplyScalar(.5),g=a.min.clone().sub(a.min),h=a.max.clone().sub(a.min),i=b.ray.direction.clone(),j=b.ray.origin.clone();j.sub(a.getCenter()).add(f);var k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,r=void 0,s=void 0;C[8]=C[0],i.x<0&&(j.x=e.x-j.x,i.x=-i.x,C[8]|=C[4]),i.y<0&&(j.y=e.y-j.y,i.y=-i.y,C[8]|=C[2]),i.z<0&&(j.z=e.z-j.z,i.z=-i.z,C[8]|=C[1]),k=1/i.x,l=1/i.y,m=1/i.z,n=(g.x-j.x)*k,o=(h.x-j.x)*k,p=(g.y-j.y)*l,q=(h.y-j.y)*l,r=(g.z-j.z)*m,s=(h.z-j.z)*m,Math.max(Math.max(n,p),r)<Math.min(Math.min(o,q),s)&&d(a.root,n,p,r,o,q,s,b,c)}}]),a}(),F=new u,G=function(){function a(b,c){n(this,a),this.root=void 0!==b&&void 0!==c?new v(b,c):null}return o(a,[{key:"getCenter",value:function(){return this.root.getCenter()}},{key:"getDimensions",value:function(){return this.root.getDimensions()}},{key:"getDepth",value:function(){return e(this.root)}},{key:"cull",value:function(a){var b=[];return f(this.root,a,b),b}},{key:"findOctantsByLevel",value:function(a){var b=[];return g(this.root,a,0,b),b}},{key:"raycast",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return E.intersectOctree(this,a,b),b}},{key:"leaves",value:function(a){return new B(this,a)}},{key:Symbol.iterator,value:function(){return new B(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),a}(),H=function(a){function b(a,c){n(this,b);var d=r(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.points=null,d.data=null,d}return q(b,a),o(b,[{key:"distanceToSquared",value:function(a){return a.clone().clamp(this.min,this.max).sub(a).lengthSq()}},{key:"distanceToCenterSquared",value:function(a){var b=this.getCenter(),c=a.x-b.x,d=a.y-b.x,e=a.z-b.z;return c*c+d*d+e*e}},{key:"contains",value:function(a,b){var c=this.min,d=this.max;return a.x>=c.x-b&&a.y>=c.y-b&&a.z>=c.z-b&&a.x<=d.x+b&&a.y<=d.y+b&&a.z<=d.z+b}},{key:"redistribute",value:function(a){var b=this.children,c=this.points,d=this.data,e=void 0,f=void 0,g=void 0,h=void 0,i=void 0;if(null!==b)for(;c.length>0;)for(h=c.pop(),i=d.pop(),e=0,f=b.length;e<f;++e)if(g=b[e],g.contains(h,a)){null===g.points&&(g.points=[],g.data=[]),g.points.push(h),g.data.push(i);break}this.points=null,this.data=null}},{key:"merge",value:function(){var a=this.children,b=void 0,c=void 0,d=void 0;if(null!==a){for(this.points=[],this.data=[],b=0,c=a.length;b<c;++b)if(d=a[b],null!==d.points){var e,f;(e=this.points).push.apply(e,s(d.points)),(f=this.data).push.apply(f,s(d.data))}this.children=null}}}]),b}(v),I=function(a){function b(a,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;n(this,b);var g=r(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return g.root=new H(a,c),g.bias=Math.max(0,d),g.biasSquared=g.bias*g.bias,g.maxPoints=Math.max(1,Math.round(e)),g.maxDepth=Math.max(0,Math.round(f)),g}return q(b,a),o(b,[{key:"countPoints",value:function(){return h(this.root)}},{key:"add",value:function(a,b){i(this.root,a,b,0,this.bias,this.maxPoints,this.maxDepth)}},{key:"remove",value:function(a){j(this.root,null,a,this.bias,this.maxPoints)}},{key:"fetch",value:function(a){return k(this.root,a,this.bias,this.biasSquared)}},{key:"findNearestPoint",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return l(this.root,a,b,c)}},{key:"findPoints",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=[];return m(this.root,a,b,c,d),d}},{key:"raycast",value:function(a){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],d=p(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"raycast",this).call(this,a);return d.length>0&&this.testPoints(d,a,c),c}},{key:"testPoints",value:function(a,b,c){var d=b.params.Points.threshold,e=d*d,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0;for(j=0,l=a.length;j<l;++j)if(n=a[j],null!==(o=n.points))for(k=0,m=o.length;k<m;++k)p=o[k],(i=b.ray.distanceSqToPoint(p))<e&&(f=b.ray.closestPointToPoint(p),(g=b.ray.origin.distanceTo(f))>=b.near&&g<=b.far&&(h=Math.sqrt(i),c.push({distance:g,distanceToRay:h,point:f.clone(),object:n.data[k]})))}}]),b}(G);a.CubicOctant=y,a.EDGES=x,a.Octant=v,a.Octree=G,a.OctreeIterator=B,a.OctreeRaycaster=E,a.PATTERN=w,a.PointOctant=H,a.PointOctree=I,Object.defineProperty(a,"__esModule",{value:!0})});