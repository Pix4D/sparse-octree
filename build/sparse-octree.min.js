/**
 * sparse-octree v4.0.1 build Aug 11 2017
 * https://github.com/vanruesc/sparse-octree
 * Copyright 2017 Raoul van RÃ¼schen, Zlib
 */

!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.SPARSEOCTREE={})}(this,function(t){"use strict";function i(t,i,n,e,r,s){var o=0;return t>i&&t>n?(r<t&&(o|=2),s<t&&(o|=1)):i>n?(e<i&&(o|=4),s<i&&(o|=1)):(e<n&&(o|=4),r<n&&(o|=2)),o}function n(t,i,n,e){var r=void 0,s=0;return i<n?(r=i,s=0):(r=n,s=1),e<r&&(s=2),C[t][s]}function e(t,r,s,o,u,a,h,l,c){var y=t.children,v=void 0,f=void 0,d=void 0,x=void 0;if(u>=0&&a>=0&&h>=0)if(null===y)c.push(t);else{v=i(r,s,o,f=.5*(r+u),d=.5*(s+a),x=.5*(o+h));do{switch(v){case 0:e(y[T[8]],r,s,o,f,d,x,l,c),v=n(v,f,d,x);break;case 1:e(y[T[8]^T[1]],r,s,x,f,d,h,l,c),v=n(v,f,d,h);break;case 2:e(y[T[8]^T[2]],r,d,o,f,a,x,l,c),v=n(v,f,a,x);break;case 3:e(y[T[8]^T[3]],r,d,x,f,a,h,l,c),v=n(v,f,a,h);break;case 4:e(y[T[8]^T[4]],f,s,o,u,d,x,l,c),v=n(v,u,d,x);break;case 5:e(y[T[8]^T[5]],f,s,x,u,d,h,l,c),v=n(v,u,d,h);break;case 6:e(y[T[8]^T[6]],f,d,o,u,a,x,l,c),v=n(v,u,a,x);break;case 7:e(y[T[8]^T[7]],f,d,x,u,a,h,l,c),v=8}}while(v<8)}}function r(t){var i=t.children,n=0,e=void 0,s=void 0,o=void 0;if(null!==i)for(e=0,s=i.length;e<s;++e)(o=1+r(i[e]))>n&&(n=o);return n}function s(t,i,n){var e=t.children,r=void 0,o=void 0;if(I.min=t.min,I.max=t.max,i.intersectsBox(I))if(null!==e)for(r=0,o=e.length;r<o;++r)s(e[r],i,n);else n.push(t)}function o(t,i,n,e){var r=t.children,s=void 0,u=void 0;if(n===i)e.push(t);else if(null!==r)for(++n,s=0,u=r.length;s<u;++s)o(r[s],i,n,e)}function u(t){var i=t.children,n=0,e=void 0,r=void 0;if(null!==i)for(e=0,r=i.length;e<r;++e)n+=u(i[e]);else null!==t.points&&(n=t.points.length);return n}function a(t,i,n,e,r){var s=e.children,o=!1,u=!1,h=void 0,l=void 0;if(e.contains(t,n.bias)){if(null===s){if(null===e.points)e.points=[],e.data=[];else for(h=0,l=e.points.length;!o&&h<l;++h)o=e.points[h].equals(t);o?(e.data[h-1]=i,u=!0):e.points.length<n.maxPoints||r===n.maxDepth?(e.points.push(t.clone()),e.data.push(i),++n.pointCount,u=!0):(e.split(),e.redistribute(n.bias),s=e.children)}if(null!==s)for(++r,h=0,l=s.length;!u&&h<l;++h)u=a(t,i,n,s[h],r)}return u}function h(t,i,n,e){var r=n.children,s=null,o=void 0,a=void 0,l=void 0,c=void 0,y=void 0;if(n.contains(t,i.bias))if(null!==r)for(o=0,a=r.length;null===s&&o<a;++o)s=h(t,i,r[o],n);else if(null!==n.points)for(l=n.points,c=n.data,o=0,a=l.length;o<a;++o)if(l[o].equals(t)){y=a-1,s=c[o],o<y&&(l[o]=l[y],c[o]=c[y]),l.pop(),c.pop(),--i.pointCount,null!==e&&u(e)<=i.maxPoints&&e.merge();break}return s}function l(t,i,n){var e=n.children,r=null,s=void 0,o=void 0,u=void 0;if(n.contains(t,i.bias))if(null!==e)for(s=0,o=e.length;null===r&&s<o;++s)r=l(t,i,e[s]);else for(s=0,o=(u=n.points).length;null===r&&s<o;++s)t.distanceToSquared(u[s])<=J&&(r=n.data[s]);return r}function c(t,i,n,e,r,s){var o=e.children,u=null,l=void 0,y=void 0,v=void 0;if(e.contains(t,n.bias))if(e.contains(i,n.bias)){if(null!==o)for(++s,l=0,y=o.length;null===u&&l<y;++l)u=c(t,i,n,o[l],e,s);else for(l=0,y=(v=e.points).length;l<y;++l)if(t.distanceToSquared(v[l])<=J){v[l].copy(i),u=e.data[l];break}}else a(i,u=h(t,n,e,r),n,r,s-1);return u}function y(t,i,n,e){var r=e.points,s=e.children,o=null,u=i,a=void 0,h=void 0,l=void 0,c=void 0,v=void 0,f=void 0,d=void 0;if(null!==s)for(a=0,h=(v=s.map(function(i){return{octant:i,distance:i.distanceToCenterSquared(t)}}).sort(function(t,i){return t.distance-i.distance})).length;a<h;++a)(f=v[a].octant).contains(t,u)&&null!==(d=y(t,u,n,f))&&(c=d.point.distanceToSquared(t),(!n||c>0)&&c<u&&(u=c,o=d));else if(null!==r)for(a=0,h=r.length;a<h;++a)l=r[a],c=t.distanceToSquared(l),(!n||c>0)&&c<u&&(u=c,o={point:l.clone(),data:e.data[a]});return o}function v(t,i,n,e,r){var s=e.points,o=e.children,u=i*i,a=void 0,h=void 0,l=void 0,c=void 0,y=void 0;if(null!==o)for(a=0,h=o.length;a<h;++a)(y=o[a]).contains(t,i)&&v(t,i,n,y,r);else if(null!==s)for(a=0,h=s.length;a<h;++a)l=s[a],c=t.distanceToSquared(l),(!n||c>0)&&c<=u&&r.push({point:l.clone(),data:e.data[a]})}var f=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},d=function(){function t(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,n,e){return n&&t(i.prototype,n),e&&t(i,e),i}}(),x=function t(i,n,e){null===i&&(i=Function.prototype);var r=Object.getOwnPropertyDescriptor(i,n);if(void 0===r){var s=Object.getPrototypeOf(i);return null===s?void 0:t(s,n,e)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(e)},m=function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)},p=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i},k=function(t){if(Array.isArray(t)){for(var i=0,n=Array(t.length);i<t.length;i++)n[i]=t[i];return n}return Array.from(t)},g=(function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,t),this.x=i,this.y=n}d(t,[{key:"set",value:function(t,i){return this.x=t,this.y=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScaledVector",value:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return isFinite(t)?(this.x*=t,this.y*=t):(this.x=0,this.y=0),this}},{key:"multiplyVectors",value:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"divideVectors",value:function(t,i){return this.x=t.x/i.x,this.y=t.y/i.y,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var i=this.x-t.x,n=this.y-t.y;return i*i+n*n}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this}}])}(),function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;f(this,t),this.x=i,this.y=n,this.z=e}return d(t,[{key:"set",value:function(t,i,n){return this.x=t,this.y=i,this.z=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"fromArray",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScaledVector",value:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this}},{key:"multiplyVectors",value:function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"divideVectors",value:function(t,i){return this.x=t.x/i.x,this.y=t.y/i.y,this.z=t.z/i.z,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var i=this.x-t.x,n=this.y-t.y,e=this.z-t.z;return i*i+n*n+e*e}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this}},{key:"applyMatrix3",value:function(t){var i=this.x,n=this.y,e=this.z,r=t.elements;return this.x=r[0]*i+r[3]*n+r[6]*e,this.y=r[1]*i+r[4]*n+r[7]*e,this.z=r[2]*i+r[5]*n+r[8]*e,this}},{key:"applyMatrix4",value:function(t){var i=this.x,n=this.y,e=this.z,r=t.elements;return this.x=r[0]*i+r[4]*n+r[8]*e+r[12],this.y=r[1]*i+r[5]*n+r[9]*e+r[13],this.z=r[2]*i+r[6]*n+r[10]*e+r[14],this}}]),t}()),z=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new g(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new g(-1/0,-1/0,-1/0);f(this,t),this.min=i,this.max=n}return d(t,[{key:"set",value:function(t,i){return this.min.copy(t),this.max.copy(i),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"setFromPoints",value:function(t){var i=void 0,n=void 0;for(i=0,n=t.length;i<n;++i)this.expandByPoint(t[i]);return this}},{key:"setFromCenterAndSize",value:function(t,i){var n=i.clone().multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}},{key:"intersectsBox",value:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}}]),t}(),w=(function(){function t(){f(this,t),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}d(t,[{key:"set",value:function(t,i,n,e,r,s,o,u,a){var h=this.elements;return h[0]=t,h[3]=i,h[6]=n,h[1]=e,h[4]=r,h[7]=s,h[2]=o,h[5]=u,h[8]=a,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(t){var i=t.elements;return this.set(i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8])}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])}(),function(){function t(){f(this,t),this.elements=new Float32Array([1,0,0,1,0,1])}d(t,[{key:"set",value:function(t,i,n,e,r,s){var o=this.elements;return o[0]=t,o[1]=i,o[3]=e,o[2]=n,o[4]=r,o[5]=s,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(t){var i=t.elements;return this.set(i[0],i[1],i[2],i[3],i[4],i[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(t){var i=t.elements;t.set(i[0],i[1],i[2],i[1],i[3],i[4],i[2],i[4],i[5])}},{key:"add",value:function(t){var i=this.elements,n=t.elements;return i[0]+=n[0],i[1]+=n[1],i[3]+=n[3],i[2]+=n[2],i[4]+=n[4],i[5]+=n[5],this}},{key:"norm",value:function(){var t=this.elements,i=t[1]*t[1],n=t[2]*t[2],e=t[4]*t[4];return Math.sqrt(t[0]*t[0]+i+n+i+t[3]*t[3]+e+n+e+t[5]*t[5])}},{key:"off",value:function(){var t=this.elements;return Math.sqrt(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:"applyToVector3",value:function(t){var i=t.x,n=t.y,e=t.z,r=this.elements;return t.x=r[0]*i+r[1]*n+r[2]*e,t.y=r[1]*i+r[3]*n+r[4]*e,t.z=r[2]*i+r[4]*n+r[5]*e,t}}],[{key:"calculateIndex",value:function(t,i){return 3-(3-t)*(2-t)/2+i}}])}(),new g),b=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new g,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new g;f(this,t),this.min=i,this.max=n,this.children=null}return d(t,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new g).copy(this.min).add(this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new g).copy(this.max).sub(this.min)}},{key:"split",value:function(){var t=this.min,i=this.max,n=this.getCenter(w),e=this.children=[null,null,null,null,null,null,null,null],r=void 0,s=void 0;for(r=0;r<8;++r)s=A[r],e[r]=new this.constructor(new g(0===s[0]?t.x:n.x,0===s[1]?t.y:n.y,0===s[2]?t.z:n.z),new g(0===s[0]?n.x:i.x,0===s[1]?n.y:i.y,0===s[2]?n.z:i.z))}}]),t}(),A=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],S=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],M=new g,O=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new g,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,t),this.min=i,this.size=n,this.children=null}return d(t,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new g).copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new g).set(this.size,this.size,this.size)}},{key:"split",value:function(){var t=this.min,i=this.getCenter(M),n=.5*this.size,e=this.children=[null,null,null,null,null,null,null,null],r=void 0,s=void 0;for(r=0;r<8;++r)s=A[r],e[r]=new this.constructor(new g(0===s[0]?t.x:i.x,0===s[1]?t.y:i.y,0===s[2]?t.z:i.z),n)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),t}(),U=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f(this,t),this.value=i,this.done=n}return d(t,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),t}(),q=new z,P=function(){function t(i){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;f(this,t),this.octree=i,this.region=n,this.cull=null!==n,this.result=new U,this.trace=null,this.indices=null,this.reset()}return d(t,[{key:"reset",value:function(){var t=this.octree.root;return this.trace=[],this.indices=[],null!==t&&(q.min=t.min,q.max=t.max,this.cull&&!this.region.intersectsBox(q)||(this.trace.push(t),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var t=this.cull,i=this.region,n=this.indices,e=this.trace,r=null,s=e.length-1,o=void 0,u=void 0,a=void 0;null===r&&s>=0;)if(o=n[s],u=e[s].children,++n[s],o<8)if(null!==u){if(a=u[o],t&&(q.min=a.min,q.max=a.max,!i.intersectsBox(q)))continue;e.push(a),n.push(0),++s}else r=e.pop(),n.pop();else e.pop(),n.pop(),--s;return this.result.value=r,this.result.done=null===r,this.result}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),T=new Uint8Array([0,1,2,3,4,5,6,7,0]),C=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],_=new g,j=new g,V=new g,D=new g,B=new g,F=new g,E=new g,R=function(){function t(){f(this,t)}return d(t,null,[{key:"intersectOctree",value:function(t,i,n){var r=void 0,s=void 0,o=void 0,u=void 0,a=void 0,h=void 0,l=void 0,c=void 0,y=void 0;t.getDimensions(_),j.copy(_).multiplyScalar(.5),D.copy(t.min).sub(t.min),B.copy(t.max).sub(t.min),F.copy(i.ray.direction),E.copy(i.ray.origin),E.sub(t.getCenter(V)).add(j),T[8]=T[0],F.x<0&&(E.x=_.x-E.x,F.x=-F.x,T[8]|=T[4]),F.y<0&&(E.y=_.y-E.y,F.y=-F.y,T[8]|=T[2]),F.z<0&&(E.z=_.z-E.z,F.z=-F.z,T[8]|=T[1]),r=1/F.x,s=1/F.y,o=1/F.z,u=(D.x-E.x)*r,a=(B.x-E.x)*r,h=(D.y-E.y)*s,l=(B.y-E.y)*s,c=(D.z-E.z)*o,y=(B.z-E.z)*o,Math.max(Math.max(u,h),c)<Math.min(Math.min(a,l),y)&&e(t.root,u,h,c,a,l,y,i,n)}}]),t}(),I=new z,L=function(){function t(i,n){f(this,t),this.root=void 0!==i&&void 0!==n?new b(i,n):null}return d(t,[{key:"getCenter",value:function(t){return this.root.getCenter(t)}},{key:"getDimensions",value:function(t){return this.root.getDimensions(t)}},{key:"getDepth",value:function(){return r(this.root)}},{key:"cull",value:function(t){var i=[];return s(this.root,t,i),i}},{key:"findOctantsByLevel",value:function(t){var i=[];return o(this.root,t,0,i),i}},{key:"raycast",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return R.intersectOctree(this,t,i),i}},{key:"leaves",value:function(t){return new P(this,t)}},{key:Symbol.iterator,value:function(){return new P(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),t}(),N=new g,G=function(t){function i(t,n){f(this,i);var e=p(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,n));return e.points=null,e.data=null,e}return m(i,b),d(i,[{key:"distanceToSquared",value:function(t){return N.copy(t).clamp(this.min,this.max).sub(t).lengthSq()}},{key:"distanceToCenterSquared",value:function(t){var i=this.getCenter(N),n=t.x-i.x,e=t.y-i.x,r=t.z-i.z;return n*n+e*e+r*r}},{key:"contains",value:function(t,i){var n=this.min,e=this.max;return t.x>=n.x-i&&t.y>=n.y-i&&t.z>=n.z-i&&t.x<=e.x+i&&t.y<=e.y+i&&t.z<=e.z+i}},{key:"redistribute",value:function(t){var i=this.children,n=this.points,e=this.data,r=void 0,s=void 0,o=void 0,u=void 0,a=void 0,h=void 0,l=void 0;if(null!==i)for(r=0,o=n.length;r<o;++r)for(h=n[r],l=e[r],s=0,u=i.length;s<u;++s)if((a=i[s]).contains(h,t)){null===a.points&&(a.points=[],a.data=[]),a.points.push(h),a.data.push(l);break}this.points=null,this.data=null}},{key:"merge",value:function(){var t=this.children,i=void 0,n=void 0,e=void 0;if(null!==t){for(this.points=[],this.data=[],i=0,n=t.length;i<n;++i)if(null!==(e=t[i]).points){var r,s;(r=this.points).push.apply(r,k(e.points)),(s=this.data).push.apply(s,k(e.data))}this.children=null}}}]),i}(),H=function t(i,n,e){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;f(this,t),this.distance=i,this.distanceToRay=n,this.point=e,this.object=r},J=1e-6,K=function(t){function i(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;f(this,i);var o=p(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return o.root=new G(t,n),o.bias=Math.max(0,e),o.maxPoints=Math.max(1,Math.round(r)),o.maxDepth=Math.max(0,Math.round(s)),o.pointCount=0,o}return m(i,L),d(i,[{key:"countPoints",value:function(t){return u(t)}},{key:"put",value:function(t,i){return a(t,i,this,this.root,0)}},{key:"remove",value:function(t){return h(t,this,this.root,null)}},{key:"fetch",value:function(t){return l(t,this,this.root)}},{key:"move",value:function(t,i){return c(t,i,this,this.root,null,0)}},{key:"findNearestPoint",value:function(t){return y(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root)}},{key:"findPoints",value:function(t,i){var n=[];return v(t,i,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root,n),n}},{key:"raycast",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e=x(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"raycast",this).call(this,t);return e.length>0&&this.testPoints(e,t,n),n}},{key:"testPoints",value:function(t,i,n){var e=i.params.Points.threshold,r=e*e,s=void 0,o=void 0,u=void 0,a=void 0,h=void 0,l=void 0,c=void 0,y=void 0,v=void 0,f=void 0,d=void 0;for(h=0,c=t.length;h<c;++h)if(v=t[h],null!==(f=v.points))for(l=0,y=f.length;l<y;++l)d=f[l],(a=i.ray.distanceSqToPoint(d))<r&&(s=i.ray.closestPointToPoint(d),(o=i.ray.origin.distanceTo(s))>=i.near&&o<=i.far&&(u=Math.sqrt(a),n.push(new H(o,u,s,v.data[l]))))}}]),i}(),Q=function(){function t(){f(this,t)}return d(t,null,[{key:"recycleOctants",value:function(t,i){var n=new g,e=new g,r=new g,s=t.min,o=t.getCenter(),u=t.getDimensions().multiplyScalar(.5),a=t.children,h=i.length,l=void 0,c=void 0,y=void 0,v=void 0;for(l=0;l<8;++l)for(y=A[l],e.addVectors(s,n.fromArray(y).multiply(u)),r.addVectors(o,n.fromArray(y).multiply(u)),c=0;c<h;++c)if(null!==(v=i[c])&&e.equals(v.min)&&r.equals(v.max)){a[l]=v,i[c]=null;break}}}]),t}();t.CubicOctant=O,t.edges=S,t.Octant=b,t.Octree=L,t.OctreeIterator=P,t.OctreeRaycaster=R,t.pattern=A,t.PointOctant=G,t.PointOctree=K,t.RayPointIntersection=H,t.OctreeUtils=Q,Object.defineProperty(t,"__esModule",{value:!0})});