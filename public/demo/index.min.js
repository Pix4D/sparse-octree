!function(w,a,o){"use strict";a=a&&a.hasOwnProperty("default")?a.default:a,o=o&&o.hasOwnProperty("default")?o.default:o;var h=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},u=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}(),n=function t(e,i,n){null===e&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,i);if(void 0===s){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in s)return s.value;var a=s.get;return void 0!==a?a.call(n):void 0},l=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},c=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},y=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)},i=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"demo";h(this,e),this.id=t,this.renderer=null,this.loadingManager=new w.LoadingManager,this.assets=new Map,this.scene=new w.Scene,this.camera=null,this.controls=null,this.ready=!1}return u(e,[{key:"setRenderer",value:function(t){return this.renderer=t,this}},{key:"load",value:function(){return Promise.resolve()}},{key:"initialize",value:function(){}},{key:"render",value:function(t){this.renderer.render(this.scene,this.camera)}},{key:"registerOptions",value:function(t){}},{key:"reset",value:function(){var t=this.scene.fog;return this.scene=new w.Scene,this.scene.fog=t,(this.camera=null)!==this.controls&&(this.controls.dispose(),this.controls=null),this.ready=!1,this}}]),e}(),e=function t(e){h(this,t),this.type=e,this.target=null},s=function(){function t(){h(this,t),this.listenerFunctions=new Map,this.listenerObjects=new Map}return u(t,[{key:"addEventListener",value:function(t,e){var i="function"==typeof e?this.listenerFunctions:this.listenerObjects;i.has(t)?i.get(t).add(e):i.set(t,new Set([e]))}},{key:"removeEventListener",value:function(t,e){var i="function"==typeof e?this.listenerFunctions:this.listenerObjects,n=void 0;i.has(t)&&((n=i.get(t)).delete(e),0===n.size&&i.delete(t))}},{key:"dispatchEvent",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this,i=e.listenerFunctions,n=e.listenerObjects,s=void 0;if(t.target=e,i.has(t.type)){s=i.get(t.type);var r=!0,a=!1,o=void 0;try{for(var h,u=s[Symbol.iterator]();!(r=(h=u.next()).done);r=!0)h.value.call(e,t)}catch(t){a=!0,o=t}finally{try{!r&&u.return&&u.return()}finally{if(a)throw o}}}if(n.has(t.type)){s=n.get(t.type);var l=!0,c=!1,y=void 0;try{for(var v,d=s[Symbol.iterator]();!(l=(v=d.next()).done);l=!0)v.value.handleEvent(t)}catch(t){c=!0,y=t}finally{try{!l&&d.return&&d.return()}finally{if(c)throw y}}}}}]),t}(),t=function(t){function i(t){h(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.previousDemo=null,e.demo=null,e}return l(i,e),i}(),v=new t("change"),d=new t("load"),m=window.location.hash.slice(1),r=function(t){function r(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};h(this,r);var i,n=void 0!==e.aside?e.aside:t,s=c(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return s.renderer=void 0!==e.renderer?e.renderer:((i=new w.WebGLRenderer).setSize(t.clientWidth,t.clientHeight),i.setPixelRatio(window.devicePixelRatio),i),t.appendChild(s.renderer.domElement),s.clock=new w.Clock,s.menu=new a.GUI({autoPlace:!1}),n.appendChild(s.menu.domElement),s.statistics=new o,s.statistics.dom.id="statistics",n.appendChild(s.statistics.domElement),s.demos=new Map,s.demo=null,s.currentDemo=null,s}return l(r,s),u(r,[{key:"resetMenu",value:function(){var t=this,e=this.menu.domElement.parentNode,i=new a.GUI({autoPlace:!1});1<this.demos.size&&i.add(this,"demo",Array.from(this.demos.keys())).onChange(function(){return t.loadDemo()});return e.removeChild(this.menu.domElement),e.appendChild(i.domElement),this.menu.destroy(),this.menu=i}},{key:"startDemo",value:function(t){t.id===this.demo&&(t.initialize(),t.registerOptions(this.resetMenu()),t.ready=!0,d.demo=t,this.dispatchEvent(d))}},{key:"loadDemo",value:function(){var t=this,e=this.demo,i=this.demos.get(e),n=this.currentDemo,s=this.renderer;window.location.hash=e,null!==n&&n.reset(),this.menu.domElement.style.display="none",s.clear(),v.previousDemo=n,v.demo=i,this.currentDemo=i,this.dispatchEvent(v),i.load().then(function(){return t.startDemo(i)}).catch(function(t){return console.error(t)})}},{key:"addDemo",value:function(t){var e=this.currentDemo;return this.demos.set(t.id,t.setRenderer(this.renderer)),null!==this.demo&&t.id!==m||(this.demo=t.id,this.loadDemo()),this.resetMenu(),null!==e&&e.ready&&e.registerOptions(this.menu),this}},{key:"removeDemo",value:function(t){var e=this.demos,i=void 0;return e.has(t)&&(e.delete(t),this.demo===t&&0<e.size?(i=e.entries().next().value,this.demo=i[0],this.currentDemo=i[1],this.loadDemo()):(this.demo=null,this.currentDemo=null,this.renderer.clear())),this}},{key:"setSize",value:function(t,e){var i=this.currentDemo;this.renderer.setSize(t,e),null!==i&&null!==i.camera&&(i.camera.aspect=t/e,i.camera.updateProjectionMatrix())}},{key:"render",value:function(t){var e=this.currentDemo,i=this.clock.getDelta();null!==e&&e.ready&&(this.statistics.begin(),e.render(i),this.statistics.end())}}]),r}(),f=0,x=1,p=2,k=3,g=4,z=5,M=6,b=7,A=function(){function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;h(this,s),this.x=t,this.y=e,this.z=i}return u(s,[{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}},{key:"setFromSpherical",value:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this}},{key:"setFromCylindrical",value:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this}},{key:"setFromMatrixColumn",value:function(t,e){return this.fromArray(t.elements,4*e)}},{key:"setFromMatrixPosition",value:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"setFromMatrixScale",value:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this}},{key:"crossVectors",value:function(t,e){var i=t.x,n=t.y,s=t.z,r=e.x,a=e.y,o=e.z;return this.x=n*o-s*a,this.y=s*r-i*o,this.z=i*a-n*r,this}},{key:"cross",value:function(t){return this.crossVectors(this,t)}},{key:"transformDirection",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n,this.y=s[1]*e+s[5]*i+s[9]*n,this.z=s[2]*e+s[6]*i+s[10]*n,this.normalize()}},{key:"applyMatrix3",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}},{key:"applyMatrix4",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12],this.y=s[1]*e+s[5]*i+s[9]*n+s[13],this.z=s[2]*e+s[6]*i+s[10]*n+s[14],this}},{key:"applyQuaternion",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,a=t.z,o=t.w,h=o*e+r*n-a*i,u=o*i+a*e-s*n,l=o*n+s*i-r*e,c=-s*e-r*i-a*n;return this.x=h*o+c*-s+u*-a-l*-r,this.y=u*o+c*-r+l*-s-h*-a,this.z=l*o+c*-a+h*-r-u*-s,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"reflect",value:function(t){1<arguments.length&&void 0!==arguments[1]?arguments[1]:new s;var e=t.x,i=t.y,n=t.z;return this.sub(t.multiplyScalar(2*this.dot(t))),t.set(e,i,n),this}},{key:"angleTo",value:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSquared()*t.lengthSquared());return Math.acos(Math.min(Math.max(e,-1),1))}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}},{key:"lerpVectors",value:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}}]),s}(),P=new A,S=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A(1/0,1/0,1/0),e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new A(-1/0,-1/0,-1/0);h(this,i),this.min=t,this.max=e}return u(i,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new T;return this.getCenter(t.center),t.radius=.5*this.getSize(P).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var e,i=void 0;for(this.min.set(0,0,0),this.max.set(0,0,0),i=0,e=t.length;i<e;++i)this.expandByPoint(t[i]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var i=P.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}},{key:"clampPoint",value:function(t){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:new A).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return P.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"applyMatrix4",value:function(t){var e=this.min,i=this.max;if(!this.isEmpty()){var n=t.elements,s=n[0]*e.x,r=n[1]*e.x,a=n[2]*e.x,o=n[0]*i.x,h=n[1]*i.x,u=n[2]*i.x,l=n[4]*e.y,c=n[5]*e.y,y=n[6]*e.y,v=n[4]*i.y,d=n[5]*i.y,m=n[6]*i.y,f=n[8]*e.z,x=n[9]*e.z,p=n[10]*e.z,k=n[8]*i.z,g=n[9]*i.z,w=n[10]*i.z;e.x=Math.min(s,o)+Math.min(l,v)+Math.min(f,k)+n[12],e.y=Math.min(r,h)+Math.min(c,d)+Math.min(x,g)+n[13],e.z=Math.min(a,u)+Math.min(y,m)+Math.min(p,w)+n[14],i.x=Math.max(s,o)+Math.max(l,v)+Math.max(f,k)+n[12],i.y=Math.max(r,h)+Math.max(c,d)+Math.max(x,g)+n[13],i.z=Math.max(a,u)+Math.max(y,m)+Math.max(p,w)+n[14]}return this}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){var e=this.min,i=this.max;return t.x>=e.x&&t.y>=e.y&&t.z>=e.z&&t.x<=i.x&&t.y<=i.y&&t.z<=i.z}},{key:"containsBox",value:function(t){var e=this.min,i=this.max,n=t.min,s=t.max;return e.x<=n.x&&s.x<=i.x&&e.y<=n.y&&s.y<=i.y&&e.z<=n.z&&s.z<=i.z}},{key:"intersectsBox",value:function(t){var e=this.min,i=this.max,n=t.min,s=t.max;return s.x>=e.x&&s.y>=e.y&&s.z>=e.z&&n.x<=i.x&&n.y<=i.y&&n.z<=i.z}},{key:"intersectsSphere",value:function(t){return this.clampPoint(t.center,P).distanceToSquared(t.center)<=t.radius*t.radius}},{key:"intersectsPlane",value:function(t){var e=void 0,i=void 0;return 0<t.normal.x?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),0<t.normal.y?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),0<t.normal.z?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=t.constant&&i>=t.constant}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}]),i}(),E=new S,T=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;h(this,i),this.center=t,this.radius=e}return u(i,[{key:"set",value:function(t,e){return this.center.copy(t),this.radius=e,this}},{key:"copy",value:function(t){return this.center.copy(t.center),this.radius=t.radius,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromPoints",value:function(t){var e,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:E.setFromPoints(t).getCenter(this.center),n=0,s=void 0;for(s=0,e=t.length;s<e;++s)n=Math.max(n,i.distanceToSquared(t[s]));return this.radius=Math.sqrt(n),this}},{key:"getBoundingBox",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new S;return t.set(this.center,this.center),t.expandByScalar(this.radius),t}},{key:"isEmpty",value:function(){return this.radius<=0}},{key:"translate",value:function(t){return this.center.add(t),this}},{key:"clampPoint",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new A,i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}},{key:"distanceToPoint",value:function(t){return t.distanceTo(this.center)-this.radius}},{key:"containsPoint",value:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"intersectsSphere",value:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}},{key:"intersectsBox",value:function(t){return t.intersectsSphere(this)}},{key:"intersectsPlane",value:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}},{key:"equals",value:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}]),i}(),O=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;h(this,i),this.x=t,this.y=e}return u(i,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this}},{key:"applyMatrix3",value:function(t){var e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}},{key:"lerpVectors",value:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)}},{key:"rotateAround",value:function(t,e){var i=Math.cos(e),n=Math.sin(e),s=this.x-t.x,r=this.y-t.y;return this.x=s*i-r*n+t.x,this.y=s*n+r*i+t.y,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"width",get:function(){return this.x},set:function(t){return this.x=t}},{key:"height",get:function(){return this.y},set:function(t){return this.y=t}}]),i}(),q=new O,C=(function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new O(1/0,1/0),e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new O(-1/0,-1/0);h(this,i),this.min=t,this.max=e}u(i,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new O;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new O;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new T;return this.getCenter(t.center),t.radius=.5*this.getSize(q).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var e,i=void 0;for(this.min.set(0,0),this.max.set(0,0),i=0,e=t.length;i<e;++i)this.expandByPoint(t[i]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var i=q.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}},{key:"clampPoint",value:function(t){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:new O).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return q.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){var e=this.min,i=this.max;return t.x>=e.x&&t.y>=e.y&&t.x<=i.x&&t.y<=i.y}},{key:"containsBox",value:function(t){var e=this.min,i=this.max,n=t.min,s=t.max;return e.x<=n.x&&s.x<=i.x&&e.y<=n.y&&s.y<=i.y}},{key:"intersectsBox",value:function(t){var e=this.min,i=this.max,n=t.min,s=t.max;return s.x>=e.x&&s.y>=e.y&&n.x<=i.x&&n.y<=i.y}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}])}(),function(){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;h(this,n),this.radius=t,this.theta=e,this.y=i}u(n,[{key:"set",value:function(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}])}(),function(){function t(){h(this,t),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return u(t,[{key:"set",value:function(t,e,i,n,s,r,a,o,h){var u=this.elements;return u[0]=t,u[3]=e,u[6]=i,u[1]=n,u[4]=s,u[7]=r,u[2]=a,u[5]=o,u[8]=h,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(t){var e=t.elements,i=this.elements;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=this.elements,n=void 0;for(n=0;n<9;++n)i[n]=t[n+e];return this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=this.elements,n=void 0;for(n=0;n<9;++n)t[n+e]=i[n];return t}},{key:"multiplyMatrices",value:function(t,e){var i=t.elements,n=e.elements,s=this.elements,r=i[0],a=i[3],o=i[6],h=i[1],u=i[4],l=i[7],c=i[2],y=i[5],v=i[8],d=n[0],m=n[3],f=n[6],x=n[1],p=n[4],k=n[7],g=n[2],w=n[5],z=n[8];return s[0]=r*d+a*x+o*g,s[3]=r*m+a*p+o*w,s[6]=r*f+a*k+o*z,s[1]=h*d+u*x+l*g,s[4]=h*m+u*p+l*w,s[7]=h*f+u*k+l*z,s[2]=c*d+y*x+v*g,s[5]=c*m+y*p+v*w,s[8]=c*f+y*k+v*z,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],a=t[5],o=t[6],h=t[7],u=t[8];return e*r*u-e*a*h-i*s*u+i*a*o+n*s*h-n*r*o}},{key:"getInverse",value:function(t){var e=t.elements,i=this.elements,n=e[0],s=e[1],r=e[2],a=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],y=c*o-h*l,v=h*u-c*a,d=l*a-o*u,m=n*y+s*v+r*d,f=void 0;return 0!==m?(f=1/m,i[0]=y*f,i[1]=(r*l-c*s)*f,i[2]=(h*s-r*o)*f,i[3]=v*f,i[4]=(c*n-r*u)*f,i[5]=(r*a-h*n)*f,i[6]=d*f,i[7]=(s*u-l*n)*f,i[8]=(o*n-s*a)*f):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,e=void 0;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"scale",value:function(t,e){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}},{key:"rotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.elements,s=n[0],r=n[3],a=n[6],o=n[1],h=n[4],u=n[7];return n[0]=e*s+i*o,n[3]=e*r+i*h,n[6]=e*a+i*u,n[1]=-i*s+e*o,n[4]=-i*r+e*h,n[7]=-i*a+e*u,this}},{key:"translate",value:function(t,e){var i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}},{key:"equals",value:function(t){var e=this.elements,i=t.elements,n=!0,s=void 0;for(s=0;n&&s<9;++s)e[s]!==i[s]&&(n=!1);return n}}]),t}()),F="XYZ",D="YZX",L="ZXY",_="XZY",B="YXZ",U="ZYX",V=new A,R=function(){function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;h(this,s),this.x=t,this.y=e,this.z=i,this.w=n}return u(s,[{key:"set",value:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}},{key:"setFromEuler",value:function(t){var e=t.x,i=t.y,n=t.z,s=Math.cos,r=Math.sin,a=s(e/2),o=s(i/2),h=s(n/2),u=r(e/2),l=r(i/2),c=r(n/2);switch(t.order){case F:this.x=u*o*h+a*l*c,this.y=a*l*h-u*o*c,this.z=a*o*c+u*l*h,this.w=a*o*h-u*l*c;break;case B:this.x=u*o*h+a*l*c,this.y=a*l*h-u*o*c,this.z=a*o*c-u*l*h,this.w=a*o*h+u*l*c;break;case L:this.x=u*o*h-a*l*c,this.y=a*l*h+u*o*c,this.z=a*o*c+u*l*h,this.w=a*o*h-u*l*c;break;case U:this.x=u*o*h-a*l*c,this.y=a*l*h+u*o*c,this.z=a*o*c-u*l*h,this.w=a*o*h+u*l*c;break;case D:this.x=u*o*h+a*l*c,this.y=a*l*h+u*o*c,this.z=a*o*c-u*l*h,this.w=a*o*h-u*l*c;break;case _:this.x=u*o*h-a*l*c,this.y=a*l*h-u*o*c,this.z=a*o*c+u*l*h,this.w=a*o*h+u*l*c}return this}},{key:"setFromAxisAngle",value:function(t,e){var i=e/2,n=Math.sin(i);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(i),this}},{key:"setFromRotationMatrix",value:function(t){var e=t.elements,i=e[0],n=e[4],s=e[8],r=e[1],a=e[5],o=e[9],h=e[2],u=e[6],l=e[10],c=i+a+l,y=void 0;return 0<c?(y=.5/Math.sqrt(c+1),this.w=.25/y,this.x=(u-o)*y,this.y=(s-h)*y,this.z=(r-n)*y):a<i&&l<i?(y=2*Math.sqrt(1+i-a-l),this.w=(u-o)/y,this.x=.25*y,this.y=(n+r)/y,this.z=(s+h)/y):l<a?(y=2*Math.sqrt(1+a-i-l),this.w=(s-h)/y,this.x=(n+r)/y,this.y=.25*y,this.z=(o+u)/y):(y=2*Math.sqrt(1+l-i-a),this.w=(r-n)/y,this.x=(s+h)/y,this.y=(o+u)/y,this.z=.25*y),this}},{key:"setFromUnitVectors",value:function(t,e){var i=t.dot(e)+1;return i<1e-6?(i=0,Math.abs(t.x)>Math.abs(t.z)?V.set(-t.y,t.x,0):V.set(0,-t.z,t.y)):V.crossVectors(t,e),this.x=V.x,this.y=V.y,this.z=V.z,this.w=i,this.normalize()}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalize",value:function(){var t=this.length(),e=void 0;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/t,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"multiplyQuaternions",value:function(t,e){var i=t.x,n=t.y,s=t.z,r=t.w,a=e.x,o=e.y,h=e.z,u=e.w;return this.x=i*u+r*a+n*h-s*o,this.y=n*u+r*o+s*a-i*h,this.z=s*u+r*h+i*o-n*a,this.w=r*u-i*a-n*o-s*h,this}},{key:"multiply",value:function(t){return this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"slerp",value:function(t,e){var i=this.x,n=this.y,s=this.z,r=this.w,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0;if(1===e)this.copy(t);else if(0<e){if((a=r*t.w+i*t.x+n*t.y+s*t.z)<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,a=-a):this.copy(t),1<=a)return this.w=r,this.x=i,this.y=n,this.z=s,this;if(o=Math.sqrt(1-a*a),Math.abs(o)<.001)return this.w=.5*(r+this.w),this.x=.5*(i+this.x),this.y=.5*(n+this.y),this.z=.5*(s+this.z),this;h=Math.atan2(o,a),u=Math.sin((1-e)*h)/o,l=Math.sin(e*h)/o,this.w=r*u+this.w*l,this.x=i*u+this.x*l,this.y=n*u+this.y*l,this.z=s*u+this.z*l}return this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}],[{key:"slerp",value:function(t,e,i,n){return i.copy(t).slerp(e,n)}},{key:"slerpFlat",value:function(t,e,i,n,s,r,a){var o=s[r],h=s[r+1],u=s[r+2],l=s[r+3],c=i[n],y=i[n+1],v=i[n+2],d=i[n+3],m=void 0,f=void 0,x=void 0,p=void 0,k=void 0,g=void 0,w=void 0,z=void 0;d===l&&c===o&&y===h&&v===u||(m=1-a,g=0<=(p=c*o+y*h+v*u+d*l)?1:-1,(k=1-p*p)>Number.EPSILON&&(x=Math.sqrt(k),w=Math.atan2(x,p*g),m=Math.sin(m*w)/x,a=Math.sin(a*w)/x),c=c*m+o*(z=a*g),y=y*m+h*z,v=v*m+u*z,d=d*m+l*z,m===1-a&&(c*=f=1/Math.sqrt(c*c+y*y+v*v+d*d),y*=f,v*=f,d*=f)),t[e]=c,t[e+1]=y,t[e+2]=v,t[e+3]=d}}]),s}();function j(t,e,i){return Math.max(Math.min(t,i),e)}var I=new C,N=new R,H=(function(){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;h(this,n),this.x=t,this.y=e,this.z=i,this.order=n.defaultOrder}u(n,[{key:"set",value:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.order=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:"fromArray",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.order=t[e+3],this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.order,t}},{key:"toVector3",value:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A).set(this.x,this.y,this.z)}},{key:"setFromRotationMatrix",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order,i=t.elements,n=i[0],s=i[4],r=i[8],a=i[1],o=i[5],h=i[9],u=i[2],l=i[6],c=i[10],y=.99999;switch(e){case F:this.y=Math.asin(j(r,-1,1)),Math.abs(r)<y?(this.x=Math.atan2(-h,c),this.z=Math.atan2(-s,n)):(this.x=Math.atan2(l,o),this.z=0);break;case B:this.x=Math.asin(-j(h,-1,1)),Math.abs(h)<y?(this.y=Math.atan2(r,c),this.z=Math.atan2(a,o)):(this.y=Math.atan2(-u,n),this.z=0);break;case L:this.x=Math.asin(j(l,-1,1)),Math.abs(l)<y?(this.y=Math.atan2(-u,c),this.z=Math.atan2(-s,o)):(this.y=0,this.z=Math.atan2(a,n));break;case U:this.y=Math.asin(-j(u,-1,1)),Math.abs(u)<y?(this.x=Math.atan2(l,c),this.z=Math.atan2(a,n)):(this.x=0,this.z=Math.atan2(-s,o));break;case D:this.z=Math.asin(j(a,-1,1)),Math.abs(a)<y?(this.x=Math.atan2(-h,o),this.y=Math.atan2(-u,n)):(this.x=0,this.y=Math.atan2(r,c));break;case _:this.z=Math.asin(-j(s,-1,1)),Math.abs(s)<y?(this.x=Math.atan2(l,o),this.y=Math.atan2(r,n)):(this.x=Math.atan2(-h,c),this.y=0)}return this.order=e,this}},{key:"setFromQuaternion",value:function(t,e){return I.makeRotationFromQuaternion(t),this.setFromRotationMatrix(I,e)}},{key:"setFromVector3",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(t.x,t.y,t.z,e)}},{key:"reorder",value:function(t){return N.setFromEuler(this),this.setFromQuaternion(N,t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:"defaultOrder",get:function(){return F}}])}(),new A),Q=new A,W=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A(1,0,0),e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;h(this,i),this.normal=t,this.constant=e}return u(i,[{key:"set",value:function(t,e){return this.normal.copy(t),this.constant=e,this}},{key:"setComponents",value:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}},{key:"copy",value:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromNormalAndCoplanarPoint",value:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(t,e,i){var n=H.subVectors(i,e).cross(Q.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,H),this}},{key:"normalize",value:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}},{key:"negate",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:"distanceToPoint",value:function(t){return this.normal.dot(t)+this.constant}},{key:"distanceToSphere",value:function(t){return this.distanceToPoint(t.center)-t.radius}},{key:"projectPoint",value:function(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}},{key:"coplanarPoint",value:function(t){return t.copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(t){return this.constant-=t.dot(this.normal),this}},{key:"intersectLine",value:function(t,e){var i=t.delta(H),n=this.normal.dot(i);if(0===n)0===this.distanceToPoint(t.start)&&e.copy(t.start);else{var s=-(t.start.dot(this.normal)+this.constant)/n;0<=s&&s<=1&&e.copy(i).multiplyScalar(s).add(t.start)}return e}},{key:"intersectsLine",value:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&0<i||i<0&&0<e}},{key:"intersectsBox",value:function(t){return t.intersectsPlane(this)}},{key:"intersectsSphere",value:function(t){return t.intersectsPlane(this)}},{key:"equals",value:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}]),i}(),G=new A,Y=new A,X=(function(){function a(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new W,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new W,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new W,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new W,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new W,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new W;h(this,a),this.planes=[t,e,i,n,s,r]}u(a,[{key:"set",value:function(t,e,i,n,s,r){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(s),a[5].copy(r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(t){var e=this.planes,i=void 0;for(i=0;i<6;++i)e[i].copy(t.planes[i]);return this}},{key:"setFromMatrix",value:function(t){var e=this.planes,i=t.elements,n=i[0],s=i[1],r=i[2],a=i[3],o=i[4],h=i[5],u=i[6],l=i[7],c=i[8],y=i[9],v=i[10],d=i[11],m=i[12],f=i[13],x=i[14],p=i[15];return e[0].setComponents(a-n,l-o,d-c,p-m).normalize(),e[1].setComponents(a+n,l+o,d+c,p+m).normalize(),e[2].setComponents(a+s,l+h,d+y,p+f).normalize(),e[3].setComponents(a-s,l-h,d-y,p-f).normalize(),e[4].setComponents(a-r,l-u,d-v,p-x).normalize(),e[5].setComponents(a+r,l+u,d+v,p+x).normalize(),this}},{key:"intersectsSphere",value:function(t){var e=this.planes,i=t.center,n=-t.radius,s=!0,r=void 0;for(r=0;r<6;++r)if(e[r].distanceToPoint(i)<n){s=!1;break}return s}},{key:"intersectsBox",value:function(t){var e=this.planes,i=t.min,n=t.max,s=!0,r=void 0,a=void 0,o=void 0,h=void 0;for(r=0;r<6;++r)if(h=e[r],G.x=0<h.normal.x?i.x:n.x,Y.x=0<h.normal.x?n.x:i.x,G.y=0<h.normal.y?i.y:n.y,Y.y=0<h.normal.y?n.y:i.y,G.z=0<h.normal.z?i.z:n.z,Y.z=0<h.normal.z?n.z:i.z,a=h.distanceToPoint(G),o=h.distanceToPoint(Y),a<0&&o<0){s=!1;break}return s}},{key:"containsPoint",value:function(t){var e=this.planes,i=!0,n=void 0;for(n=0;n<6;++n)if(e[n].distanceToPoint(t)<0){i=!1;break}return i}}])}(),new A),K=new A,Z=(function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new A;h(this,i),this.start=t,this.end=e}u(i,[{key:"set",value:function(t,e){return this.start.copy(t),this.end.copy(e),this}},{key:"copy",value:function(t){return this.start.copy(t.start),this.end.copy(t.end),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"getCenter",value:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A).subVectors(this.end,this.start)}},{key:"lengthSquared",value:function(){return this.start.distanceToSquared(this.end)}},{key:"length",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}},{key:"closestPointToPointParameter",value:function(t,e){X.subVectors(t,this.start),K.subVectors(this.end,this.start);var i=K.dot(K),n=K.dot(X);return e?Math.min(Math.max(n/i,0),1):n/i}},{key:"closestPointToPoint",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new A,n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}},{key:"equals",value:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}])}(),new A),J=new A,$=new A,tt=function(){function t(){h(this,t),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return u(t,[{key:"set",value:function(t,e,i,n,s,r,a,o,h,u,l,c,y,v,d,m){var f=this.elements;return f[0]=t,f[4]=e,f[8]=i,f[12]=n,f[1]=s,f[5]=r,f[9]=a,f[13]=o,f[2]=h,f[6]=u,f[10]=l,f[14]=c,f[3]=y,f[7]=v,f[11]=d,f[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(t){var e=t.elements,i=this.elements;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=this.elements,n=void 0;for(n=0;n<16;++n)i[n]=t[n+e];return this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=this.elements,n=void 0;for(n=0;n<16;++n)t[n+e]=i[n];return t}},{key:"getMaxScaleOnAxis",value:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}},{key:"copyPosition",value:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}},{key:"setPosition",value:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this}},{key:"extractBasis",value:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var e=this.elements,i=t.elements,n=1/Z.setFromMatrixColumn(t,0).length(),s=1/Z.setFromMatrixColumn(t,1).length(),r=1/Z.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[7]=0,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromEuler",value:function(t){var e=this.elements,i=t.x,n=t.y,s=t.z,r=Math.cos(i),a=Math.sin(i),o=Math.cos(n),h=Math.sin(n),u=Math.cos(s),l=Math.sin(s),c=void 0,y=void 0,v=void 0,d=void 0,m=void 0,f=void 0,x=void 0,p=void 0,k=void 0,g=void 0,w=void 0,z=void 0;switch(t.order){case F:c=r*u,y=r*l,v=a*u,d=a*l,e[0]=o*u,e[4]=-o*l,e[8]=h,e[1]=y+v*h,e[5]=c-d*h,e[9]=-a*o,e[2]=d-c*h,e[6]=v+y*h,e[10]=r*o;break;case B:m=o*u,f=o*l,x=h*u,p=h*l,e[0]=m+p*a,e[4]=x*a-f,e[8]=r*h,e[1]=r*l,e[5]=r*u,e[9]=-a,e[2]=f*a-x,e[6]=p+m*a,e[10]=r*o;break;case L:m=o*u,f=o*l,x=h*u,p=h*l,e[0]=m-p*a,e[4]=-r*l,e[8]=x+f*a,e[1]=f+x*a,e[5]=r*u,e[9]=p-m*a,e[2]=-r*h,e[6]=a,e[10]=r*o;break;case U:c=r*u,y=r*l,v=a*u,d=a*l,e[0]=o*u,e[4]=v*h-y,e[8]=c*h+d,e[1]=o*l,e[5]=d*h+c,e[9]=y*h-v,e[2]=-h,e[6]=a*o,e[10]=r*o;break;case D:k=r*o,g=r*h,w=a*o,z=a*h,e[0]=o*u,e[4]=z-k*l,e[8]=w*l+g,e[1]=l,e[5]=r*u,e[9]=-a*u,e[2]=-h*u,e[6]=g*l+w,e[10]=k-z*l;break;case _:k=r*o,g=r*h,w=a*o,z=a*h,e[0]=o*u,e[4]=-l,e[8]=h*u,e[1]=k*l+z,e[5]=r*u,e[9]=g*l-w,e[2]=w*l-g,e[6]=a*u,e[10]=z*l+k}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){return this.compose(Z.set(0,0,0),t,J.set(1,1,1))}},{key:"lookAt",value:function(t,e,i){var n=this.elements,s=Z,r=J,a=$;return a.subVectors(t,e),0===a.lengthSquared()&&(a.z=1),a.normalize(),s.crossVectors(i,a),0===s.lengthSquared()&&(1===Math.abs(i.z)?a.x+=1e-4:a.z+=1e-4,a.normalize(),s.crossVectors(i,a)),s.normalize(),r.crossVectors(a,s),n[0]=s.x,n[4]=r.x,n[8]=a.x,n[1]=s.y,n[5]=r.y,n[9]=a.y,n[2]=s.z,n[6]=r.z,n[10]=a.z,this}},{key:"multiplyMatrices",value:function(t,e){var i=this.elements,n=t.elements,s=e.elements,r=n[0],a=n[4],o=n[8],h=n[12],u=n[1],l=n[5],c=n[9],y=n[13],v=n[2],d=n[6],m=n[10],f=n[14],x=n[3],p=n[7],k=n[11],g=n[15],w=s[0],z=s[4],M=s[8],b=s[12],A=s[1],P=s[5],S=s[9],E=s[13],T=s[2],O=s[6],q=s[10],C=s[14],F=s[3],D=s[7],L=s[11],_=s[15];return i[0]=r*w+a*A+o*T+h*F,i[4]=r*z+a*P+o*O+h*D,i[8]=r*M+a*S+o*q+h*L,i[12]=r*b+a*E+o*C+h*_,i[1]=u*w+l*A+c*T+y*F,i[5]=u*z+l*P+c*O+y*D,i[9]=u*M+l*S+c*q+y*L,i[13]=u*b+l*E+c*C+y*_,i[2]=v*w+d*A+m*T+f*F,i[6]=v*z+d*P+m*O+f*D,i[10]=v*M+d*S+m*q+f*L,i[14]=v*b+d*E+m*C+f*_,i[3]=x*w+p*A+k*T+g*F,i[7]=x*z+p*P+k*O+g*D,i[11]=x*M+p*S+k*q+g*L,i[15]=x*b+p*E+k*C+g*_,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],s=t[12],r=t[1],a=t[5],o=t[9],h=t[13],u=t[2],l=t[6],c=t[10],y=t[14],v=e*a,d=e*o,m=e*h,f=i*r,x=i*o,p=i*h,k=n*r,g=n*a,w=n*h,z=s*r,M=s*a,b=s*o;return t[3]*(b*l-w*l-M*c+p*c+g*y-x*y)+t[7]*(d*y-m*c+z*c-k*y+w*u-b*u)+t[11]*(m*l-v*y-z*l+f*y+M*u-p*u)+t[15]*(-g*u-d*l+v*c+k*l-f*c+x*u)}},{key:"getInverse",value:function(t){var e=this.elements,i=t.elements,n=i[0],s=i[1],r=i[2],a=i[3],o=i[4],h=i[5],u=i[6],l=i[7],c=i[8],y=i[9],v=i[10],d=i[11],m=i[12],f=i[13],x=i[14],p=i[15],k=y*x*l-f*v*l+f*u*d-h*x*d-y*u*p+h*v*p,g=m*v*l-c*x*l-m*u*d+o*x*d+c*u*p-o*v*p,w=c*f*l-m*y*l+m*h*d-o*f*d-c*h*p+o*y*p,z=m*y*u-c*f*u-m*h*v+o*f*v+c*h*x-o*y*x,M=n*k+s*g+r*w+a*z,b=void 0;return 0!==M?(b=1/M,e[0]=k*b,e[1]=(f*v*a-y*x*a-f*r*d+s*x*d+y*r*p-s*v*p)*b,e[2]=(h*x*a-f*u*a+f*r*l-s*x*l-h*r*p+s*u*p)*b,e[3]=(y*u*a-h*v*a-y*r*l+s*v*l+h*r*d-s*u*d)*b,e[4]=g*b,e[5]=(c*x*a-m*v*a+m*r*d-n*x*d-c*r*p+n*v*p)*b,e[6]=(m*u*a-o*x*a-m*r*l+n*x*l+o*r*p-n*u*p)*b,e[7]=(o*v*a-c*u*a+c*r*l-n*v*l-o*r*d+n*u*d)*b,e[8]=w*b,e[9]=(m*y*a-c*f*a-m*s*d+n*f*d+c*s*p-n*y*p)*b,e[10]=(o*f*a-m*h*a+m*s*l-n*f*l-o*s*p+n*h*p)*b,e[11]=(c*h*a-o*y*a-c*s*l+n*y*l+o*s*d-n*h*d)*b,e[12]=z*b,e[13]=(c*f*r-m*y*r+m*s*v-n*f*v-c*s*x+n*y*x)*b,e[14]=(m*h*r-o*f*r-m*s*u+n*f*u+o*s*x-n*h*x)*b,e[15]=(o*y*r-c*h*r+c*s*u-n*y*u-o*s*v+n*h*v)*b):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,e=void 0;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"scale",value:function(t,e,i){var n=this.elements;return n[0]*=t,n[4]*=e,n[8]*=i,n[1]*=t,n[5]*=e,n[9]*=i,n[2]*=t,n[6]*=e,n[10]*=i,n[3]*=t,n[7]*=e,n[11]*=i,this}},{key:"makeScale",value:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}},{key:"makeTranslation",value:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,e){var i=Math.cos(e),n=Math.sin(e),s=1-i,r=t.x,a=t.y,o=t.z,h=s*r,u=s*a;return this.set(h*r+i,h*a-n*o,h*o+n*a,0,h*a+n*o,u*a+i,u*o-n*r,0,h*o-n*a,u*o+n*r,s*o*o+i,0,0,0,0,1),this}},{key:"makeShear",value:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this}},{key:"compose",value:function(t,e,i){var n=this.elements,s=e.x,r=e.y,a=e.z,o=e.w,h=s+s,u=r+r,l=a+a,c=s*h,y=s*u,v=s*l,d=r*u,m=r*l,f=a*l,x=o*h,p=o*u,k=o*l,g=i.x,w=i.y,z=i.z;return n[0]=(1-(d+f))*g,n[1]=(y+k)*g,n[2]=(v-p)*g,n[3]=0,n[4]=(y-k)*w,n[5]=(1-(c+f))*w,n[6]=(m+x)*w,n[7]=0,n[8]=(v+p)*z,n[9]=(m-x)*z,n[10]=(1-(c+d))*z,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}},{key:"decompose",value:function(t,e,i){var n=this.elements,s=n[0],r=n[1],a=n[2],o=n[4],h=n[5],u=n[6],l=n[8],c=n[9],y=n[10],v=this.determinant(),d=Z.set(s,r,a).length()*(v<0?-1:1),m=Z.set(o,h,u).length(),f=Z.set(l,c,y).length(),x=1/d,p=1/m,k=1/f;return t.x=n[12],t.y=n[13],t.z=n[14],n[0]*=x,n[1]*=x,n[2]*=x,n[4]*=p,n[5]*=p,n[6]*=p,n[8]*=k,n[9]*=k,n[10]*=k,e.setFromRotationMatrix(this),n[0]=s,n[1]=r,n[2]=a,n[4]=o,n[5]=h,n[6]=u,n[8]=l,n[9]=c,n[10]=y,i.x=d,i.y=m,i.z=f,this}},{key:"makePerspective",value:function(t,e,i,n,s,r){var a=this.elements,o=2*s/(e-t),h=2*s/(i-n),u=(e+t)/(e-t),l=(i+n)/(i-n),c=-(r+s)/(r-s),y=-2*r*s/(r-s);return a[0]=o,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=h,a[9]=l,a[13]=0,a[2]=0,a[6]=0,a[10]=c,a[14]=y,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}},{key:"makeOrthographic",value:function(t,e,i,n,s,r){var a=this.elements,o=1/(e-t),h=1/(i-n),u=1/(r-s),l=(e+t)*o,c=(i+n)*h,y=(r+s)*u;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*h,a[9]=0,a[13]=-c,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-y,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}},{key:"equals",value:function(t){var e=this.elements,i=t.elements,n=!0,s=void 0;for(s=0;n&&s<16;++s)e[s]!==i[s]&&(n=!1);return n}}]),t}(),et=[new A,new A,new A,new A],it=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new A;h(this,i),this.origin=t,this.direction=e}return u(i,[{key:"set",value:function(t,e){return this.origin.copy(t),this.direction.copy(e),this}},{key:"copy",value:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"at",value:function(t){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:new A).copy(this.direction).multiplyScalar(t).add(this.origin)}},{key:"lookAt",value:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this}},{key:"recast",value:function(t){return this.origin.copy(this.at(t,et[0])),this}},{key:"closestPointToPoint",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new A,i=e.subVectors(t,this.origin).dot(this.direction);return 0<=i?e.copy(this.direction).multiplyScalar(i).add(this.origin):e.copy(this.origin)}},{key:"distanceSquaredToPoint",value:function(t){var e=et[0].subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):et[0].copy(this.direction).multiplyScalar(e).add(this.origin).distanceToSquared(t)}},{key:"distanceToPoint",value:function(t){return Math.sqrt(this.distanceSquaredToPoint(t))}},{key:"distanceToPlane",value:function(t){var e=t.normal.dot(this.direction),i=0!==e?-(this.origin.dot(t.normal)+t.constant)/e:0===t.distanceToPoint(this.origin)?0:-1;return 0<=i?i:null}},{key:"distanceSquaredToSegment",value:function(t,e,i,n){var s=et[0].copy(t).add(e).multiplyScalar(.5),r=et[1].copy(e).sub(t).normalize(),a=et[2].copy(this.origin).sub(s),o=.5*t.distanceTo(e),h=-this.direction.dot(r),u=a.dot(this.direction),l=-a.dot(r),c=a.lengthSq(),y=Math.abs(1-h*h),v=void 0,d=void 0,m=void 0,f=void 0,x=void 0;return 0<y?(d=h*u-l,m=o*y,0<=(v=h*l-u)?-m<=d?d<=m?x=(v*=f=1/y)*(v+h*(d*=f)+2*u)+d*(h*v+d+2*l)+c:(d=o,x=-(v=Math.max(0,-(h*d+u)))*v+d*(d+2*l)+c):(d=-o,x=-(v=Math.max(0,-(h*d+u)))*v+d*(d+2*l)+c):d<=-m?x=-(v=Math.max(0,-(-h*o+u)))*v+(d=0<v?-o:Math.min(Math.max(-o,-l),o))*(d+2*l)+c:d<=m?(v=0,x=(d=Math.min(Math.max(-o,-l),o))*(d+2*l)+c):x=-(v=Math.max(0,-(h*o+u)))*v+(d=0<v?o:Math.min(Math.max(-o,-l),o))*(d+2*l)+c):(d=0<h?-o:o,x=-(v=Math.max(0,-(h*d+u)))*v+d*(d+2*l)+c),void 0!==i&&i.copy(this.direction).multiplyScalar(v).add(this.origin),void 0!==n&&n.copy(r).multiplyScalar(d).add(s),x}},{key:"intersectSphere",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new A,i=et[0].subVectors(t.center,this.origin),n=i.dot(this.direction),s=i.dot(i)-n*n,r=t.radius*t.radius,a=null,o=void 0,h=void 0,u=void 0;return s<=r&&(u=n+(o=Math.sqrt(r-s)),(0<=(h=n-o)||0<=u)&&(a=h<0?this.at(u,e):this.at(h,e))),a}},{key:"intersectsSphere",value:function(t){return this.distanceToPoint(t.center)<=t.radius}},{key:"intersectPlane",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new A,i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}},{key:"intersectsPlane",value:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}},{key:"intersectBox",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new A,i=this.origin,n=this.direction,s=t.min,r=t.max,a=1/n.x,o=1/n.y,h=1/n.z,u=null,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,m=void 0;return 0<=a?(l=(s.x-i.x)*a,c=(r.x-i.x)*a):(l=(r.x-i.x)*a,c=(s.x-i.x)*a),0<=o?(y=(s.y-i.y)*o,v=(r.y-i.y)*o):(y=(r.y-i.y)*o,v=(s.y-i.y)*o),l<=v&&y<=c&&((l<y||l!=l)&&(l=y),(v<c||c!=c)&&(c=v),0<=h?(d=(s.z-i.z)*h,m=(r.z-i.z)*h):(d=(r.z-i.z)*h,m=(s.z-i.z)*h),l<=m&&d<=c&&((l<d||l!=l)&&(l=d),(m<c||c!=c)&&(c=m),0<=c&&(u=this.at(0<=l?l:c,e)))),u}},{key:"intersectsBox",value:function(t){return null!==this.intersectBox(t,et[0])}},{key:"intersectTriangle",value:function(t,e,i,n,s){var r=this.direction,a=et[0],o=et[1],h=et[2],u=et[3],l=null,c=void 0,y=void 0,v=void 0,d=void 0,m=void 0;return o.subVectors(e,t),h.subVectors(i,t),u.crossVectors(o,h),0===(c=r.dot(u))||n&&0<c||(0<c?y=1:(y=-1,c=-c),a.subVectors(this.origin,t),0<=(v=y*r.dot(h.crossVectors(a,h)))&&0<=(d=y*r.dot(o.cross(a)))&&v+d<=c&&0<=(m=-y*a.dot(u))&&(l=this.at(m/c,s))),l}},{key:"applyMatrix4",value:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}},{key:"equals",value:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}]),i}(),nt=function(){function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;h(this,n),this.radius=t,this.phi=e,this.theta=i}return u(n,[{key:"set",value:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Math.min(Math.max(t.y/this.radius,-1),1))),this.makeSafe()}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}}]),n}(),st=(function(){function t(){h(this,t),this.elements=new Float32Array([1,0,0,1,0,1])}u(t,[{key:"set",value:function(t,e,i,n,s,r){var a=this.elements;return a[0]=t,a[1]=e,a[3]=n,a[2]=i,a[4]=s,a[5]=r,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(t){var e=t.elements;return this.set(e[0],e[1],e[2],e[3],e[4],e[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(t){var e=t.elements;t.set(e[0],e[1],e[2],e[1],e[3],e[4],e[2],e[4],e[5])}},{key:"add",value:function(t){var e=this.elements,i=t.elements;return e[0]+=i[0],e[1]+=i[1],e[3]+=i[3],e[2]+=i[2],e[4]+=i[4],e[5]+=i[5],this}},{key:"norm",value:function(){var t=this.elements,e=t[1]*t[1],i=t[2]*t[2],n=t[4]*t[4];return Math.sqrt(t[0]*t[0]+e+i+e+t[3]*t[3]+n+i+n+t[5]*t[5])}},{key:"off",value:function(){var t=this.elements;return Math.sqrt(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:"applyToVector3",value:function(t){var e=t.x,i=t.y,n=t.z,s=this.elements;return t.x=s[0]*e+s[1]*i+s[2]*n,t.y=s[1]*e+s[3]*i+s[4]*n,t.z=s[2]*e+s[4]*i+s[5]*n,t}},{key:"equals",value:function(t){var e=this.elements,i=t.elements,n=!0,s=void 0;for(s=0;n&&s<6;++s)e[s]!==i[s]&&(n=!1);return n}}],[{key:"calculateIndex",value:function(t,e){return 3-(3-t)*(2-t)/2+e}}])}(),function(){function s(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;h(this,s),this.x=t,this.y=e,this.z=i,this.w=n}u(s,[{key:"set",value:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}},{key:"toArray",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}},{key:"setAxisAngleFromQuaternion",value:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}},{key:"setAxisAngleFromRotationMatrix",value:function(t){var e=t.elements,i=e[0],n=e[4],s=e[8],r=e[1],a=e[5],o=e[9],h=e[2],u=e[6],l=e[10],c=void 0,y=void 0,v=void 0,d=void 0,m=void 0,f=void 0,x=void 0,p=void 0,k=void 0,g=void 0,w=void 0;return Math.abs(n-r)<.01&&Math.abs(s-h)<.01&&Math.abs(o-u)<.01?Math.abs(n+r)<.1&&Math.abs(s+h)<.1&&Math.abs(o+u)<.1&&Math.abs(i+a+l-3)<.1?this.set(1,0,0,0):(c=Math.PI,x=(l+1)/2,p=(n+r)/4,k=(s+h)/4,g=(o+u)/4,(f=(a+1)/2)<(m=(i+1)/2)&&x<m?m<.01?(y=0,d=v=.707106781):(v=p/(y=Math.sqrt(m)),d=k/y):x<f?f<.01?(v=0,d=y=.707106781):(y=p/(v=Math.sqrt(f)),d=g/v):x<.01?(v=y=.707106781,d=0):(y=k/(d=Math.sqrt(x)),v=g/d),this.set(y,v,d,c)):(w=Math.sqrt((u-o)*(u-o)+(s-h)*(s-h)+(r-n)*(r-n)),Math.abs(w)<.001&&(w=1),this.x=(u-o)/w,this.y=(s-h)/w,this.z=(r-n)/w,this.w=Math.acos((i+a+l-1)/2)),this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this.w=t.w*e.w,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this}},{key:"applyMatrix4",value:function(t){var e=this.x,i=this.y,n=this.z,s=this.w,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12]*s,this.y=r[1]*e+r[5]*i+r[9]*n+r[13]*s,this.z=r[2]*e+r[6]*i+r[10]*n+r[14]*s,this.w=r[3]*e+r[7]*i+r[11]*n+r[15]*s,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanDistanceTo",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z,s=this.w-t.w;return e*e+i*i+n*n+s*s}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}},{key:"lerpVectors",value:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}])}(),0),rt=1,at=2,ot=2*Math.PI,ht=new A,ut=new tt,lt=function(){function s(t,e,i,n){h(this,s),this.position=t,this.quaternion=e,this.target=i,this.settings=n,this.spherical=new nt}return u(s,[{key:"setPosition",value:function(t){return this.position=t,this}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this}},{key:"setTarget",value:function(t){return this.target=t,this}},{key:"updateQuaternion",value:function(){var t=this.settings,e=t.rotation;return t.general.orbit?ut.lookAt(ht.subVectors(this.position,this.target),e.pivotOffset,e.up):ut.lookAt(ht.set(0,0,0),this.target.setFromSpherical(this.spherical),e.up),this.quaternion.setFromRotationMatrix(ut),this}},{key:"adjustSpherical",value:function(t,e){var i=this.settings,n=i.general.orbit,s=i.rotation,r=this.spherical;return r.theta=s.invertX?r.theta+t:r.theta-t,r.phi=!n&&!s.invertY||n&&s.invertY?r.phi+e:r.phi-e,r.theta=Math.min(Math.max(r.theta,s.minAzimuthalAngle),s.maxAzimuthalAngle),r.phi=Math.min(Math.max(r.phi,s.minPolarAngle),s.maxPolarAngle),r.theta%=ot,r.makeSafe(),n&&this.position.setFromSpherical(r).add(this.target),this}},{key:"zoom",value:function(t){var e=this.settings,i=e.general,n=e.sensitivity,s=e.zoom,r=this.spherical,a=void 0,o=void 0,h=void 0;return i.orbit&&s.enabled&&(a=t*n.zoom,s.invert&&(a=-a),o=Math.max(s.minDistance,1e-6),h=Math.min(s.maxDistance,1/0),r.radius=Math.min(Math.max(r.radius+a,o),h),this.position.setFromSpherical(r).add(this.target)),this}},{key:"update",value:function(t){}},{key:"lookAt",value:function(t){var e=this.spherical,i=this.position,n=this.target;return n.copy(t),this.settings.general.orbit?ht.subVectors(i,n):ht.subVectors(n,i).normalize(),e.setFromVector3(ht),e.radius=Math.max(e.radius,1e-6),this.updateQuaternion(),this}},{key:"getViewDirection",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A;return t.setFromSpherical(this.spherical).normalize(),this.settings.general.orbit&&t.negate(),t}}]),s}(),ct=function(){function t(){h(this,t),this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1}return u(t,[{key:"reset",value:function(){return this.left=!1,this.right=!1,this.forward=!1,this.backward=!1,this.up=!1,this.down=!1,this}}]),t}(),yt=new A(1,0,0),vt=new A(0,1,0),dt=new A(0,0,1),mt=new A,ft=function(){function s(t,e,i,n){h(this,s),this.position=t,this.quaternion=e,this.target=i,this.settings=n,this.movementState=new ct}return u(s,[{key:"setPosition",value:function(t){return this.position=t,this}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this}},{key:"setTarget",value:function(t){return this.target=t,this}},{key:"translateOnAxis",value:function(t,e){mt.copy(t).applyQuaternion(this.quaternion).multiplyScalar(e),this.position.add(mt),this.settings.general.orbit&&this.target.add(mt)}},{key:"translate",value:function(t){var e=this.settings.sensitivity,i=this.movementState,n=t*e.translation;i.backward?this.translateOnAxis(dt,n):i.forward&&this.translateOnAxis(dt,-n),i.right?this.translateOnAxis(yt,n):i.left&&this.translateOnAxis(yt,-n),i.up?this.translateOnAxis(vt,n):i.down&&this.translateOnAxis(vt,-n)}},{key:"update",value:function(t){this.settings.translation.enabled&&this.translate(t)}},{key:"moveTo",value:function(t){return this.settings.general.orbit?this.target.copy(t):this.position.copy(t),this}}]),s}(),xt=new Proxy({BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,META_LEFT:91,META_RIGHT:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},{get:function(t,e){return e in t?t[e]:1===e.length?e.toUpperCase().charCodeAt(0):void 0}}),pt=function(){function t(){h(this,t),this.orbit=!0}return u(t,[{key:"copy",value:function(t){return this.orbit=t.orbit,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),kt=function(){function t(){h(this,t),this.defaultActions=new Map,this.actions=new Map}return u(t,[{key:"reset",value:function(){return this.actions=new Map(this.defaultActions),this}},{key:"setDefault",value:function(t){return this.defaultActions=t,this.reset()}},{key:"copy",value:function(t){return this.defaultActions=new Map(t.defaultActions),this.actions=new Map(t.actions),this}},{key:"clearDefault",value:function(){return this.defaultActions.clear(),this}},{key:"clear",value:function(){return this.actions.clear(),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"has",value:function(t){return this.actions.has(t)}},{key:"get",value:function(t){return this.actions.get(t)}},{key:"set",value:function(t,e){return this.actions.set(t,e),this}},{key:"delete",value:function(t){return this.actions.delete(t)}},{key:"toJSON",value:function(){return{defaultActions:[].concat(y(this.defaultActions)),actions:[].concat(y(this.actions))}}}]),t}(),gt=function(){function t(){h(this,t),this.hold=!1,this.lock=!0}return u(t,[{key:"copy",value:function(t){return this.hold=t.hold,this.lock=t.lock,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),wt=function(){function t(){h(this,t),this.up=new A,this.up.copy(vt),this.pivotOffset=new A,this.minAzimuthalAngle=-1/0,this.maxAzimuthalAngle=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.invertX=!1,this.invertY=!1}return u(t,[{key:"copy",value:function(t){return this.up.copy(t.up),this.pivotOffset.copy(t.pivotOffset),this.minAzimuthalAngle=null!==t.minAzimuthalAngle?t.minAzimuthalAngle:-1/0,this.maxAzimuthalAngle=null!==t.maxAzimuthalAngle?t.maxAzimuthalAngle:1/0,this.minPolarAngle=t.minPolarAngle,this.maxPolarAngle=t.maxPolarAngle,this.invertX=t.invertX,this.invertY=t.invertY,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),zt=function(){function t(){h(this,t),this.rotation=.0025,this.translation=1,this.zoom=.1}return u(t,[{key:"copy",value:function(t){return this.rotation=t.rotation,this.translation=t.translation,this.zoom=t.zoom,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),Mt=function(){function t(){h(this,t),this.enabled=!0}return u(t,[{key:"copy",value:function(t){return this.enabled=t.enabled,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),bt=function(){function t(){h(this,t),this.enabled=!0,this.invert=!1,this.minDistance=1e-6,this.maxDistance=1/0}return u(t,[{key:"copy",value:function(t){return this.enabled=t.enabled,this.invert=t.invert,this.minDistance=t.minDistance,this.maxDistance=t.maxDistance,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),t}(),At=function(){function t(){h(this,t),this.general=new pt,this.keyBindings=new kt,this.keyBindings.setDefault(new Map([[xt.W,f],[xt.UP,f],[xt.A,x],[xt.LEFT,x],[xt.S,p],[xt.DOWN,p],[xt.D,k],[xt.RIGHT,k],[xt.X,g],[xt.SPACE,z],[xt.PAGE_DOWN,M],[xt.PAGE_UP,b]])),this.pointer=new gt,this.rotation=new wt,this.sensitivity=new zt,this.translation=new Mt,this.zoom=new bt}return u(t,[{key:"copy",value:function(t){return this.general.copy(t.general),this.keyBindings.copy(t.keyBindings),this.pointer.copy(t.pointer),this.rotation.copy(t.rotation),this.sensitivity.copy(t.sensitivity),this.translation.copy(t.translation),this.zoom.copy(t.zoom),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toDataURL",value:function(){return URL.createObjectURL(new Blob([JSON.stringify(this)],{type:"text/json"}))}}]),t}(),Pt=function(){function t(){h(this,t)}return u(t,[{key:"execute",value:function(t){throw new Error("Strategy#execute method not implemented!")}}]),t}(),St=function(t){function n(t,e){h(this,n);var i=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return i.movementState=t,i.direction=e,i}return l(n,Pt),u(n,[{key:"execute",value:function(t){var e=this.movementState;switch(this.direction){case Et.FORWARD:e.forward=t;break;case Et.LEFT:e.left=t;break;case Et.BACKWARD:e.backward=t;break;case Et.RIGHT:e.right=t;break;case Et.DOWN:e.down=t;break;case Et.UP:e.up=t}}}]),n}(),Et={FORWARD:0,LEFT:1,BACKWARD:2,RIGHT:3,DOWN:4,UP:5},Tt=function(t){function n(t,e){h(this,n);var i=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return i.rotationManager=t,i.zoomIn=e,i}return l(n,Pt),u(n,[{key:"execute",value:function(t){t&&this.rotationManager.zoom(this.zoomIn?-1:1)}}]),n}(),Ot=function(){function a(){var t,e,i,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:document.body;h(this,a),this.dom=r,this.position=n,this.quaternion=s,this.target=new A,this.settings=new At,this.rotationManager=new lt(n,s,this.target,this.settings),this.translationManager=new ft(n,s,this.target,this.settings),this.strategies=(t=this.rotationManager,e=this.translationManager,i=e.movementState,new Map([[f,new St(i,Et.FORWARD)],[x,new St(i,Et.LEFT)],[p,new St(i,Et.BACKWARD)],[k,new St(i,Et.RIGHT)],[g,new St(i,Et.DOWN)],[z,new St(i,Et.UP)],[M,new Tt(t,!1)],[b,new Tt(t,!0)]])),this.lastScreenPosition=new O,this.dragging=!1,this.enabled=!1,null!==n&&null!==s&&(this.lookAt(this.target),null!==r&&this.setEnabled())}return u(a,[{key:"getDom",value:function(){return this.dom}},{key:"getPosition",value:function(){return this.position}},{key:"getQuaternion",value:function(){return this.quaternion}},{key:"getTarget",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A;return t.copy(this.target),this.settings.general.orbit||t.add(this.position),t}},{key:"getViewDirection",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A;return this.rotationManager.getViewDirection(t)}},{key:"setDom",value:function(t){var e=this.enabled;return null!==t&&(e&&this.setEnabled(!1),this.dom=t,this.setEnabled(e)),this}},{key:"setPosition",value:function(t){return this.position=t,this.rotationManager.setPosition(t),this.translationManager.setPosition(t),this.lookAt(this.target)}},{key:"setQuaternion",value:function(t){return this.quaternion=t,this.rotationManager.setQuaternion(t),this.translationManager.setQuaternion(t),this.lookAt(this.target)}},{key:"setTarget",value:function(t){return this.target=t,this.rotationManager.setTarget(t),this.translationManager.setTarget(t),this.lookAt(this.target)}},{key:"setOrbitEnabled",value:function(t){var e=this.settings.general;return e.orbit!==t&&(this.getTarget(this.target),e.orbit=t,this.lookAt(this.target)),this}},{key:"copy",value:function(t){return this.dom=t.getDom(),this.position=t.getPosition(),this.quaternion=t.getQuaternion(),this.target=t.getTarget(),this.settings.copy(t.settings),this.rotationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.translationManager.setPosition(this.position).setQuaternion(this.quaternion).setTarget(this.target),this.lookAt(this.target)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"handlePointerMoveEvent",value:function(t){var e=this.settings,i=e.pointer,n=e.sensitivity,s=this.rotationManager,r=this.lastScreenPosition,a=void 0,o=void 0;document.pointerLockElement===this.dom?i.hold&&!this.dragging||s.adjustSpherical(t.movementX*n.rotation,t.movementY*n.rotation).updateQuaternion():(a=t.screenX-r.x,o=t.screenY-r.y,r.set(t.screenX,t.screenY),s.adjustSpherical(a*n.rotation,o*n.rotation).updateQuaternion())}},{key:"handleTouchMoveEvent",value:function(t){var e=this.settings.sensitivity,i=this.rotationManager,n=this.lastScreenPosition,s=t.touches[0],r=s.screenX-n.x,a=s.screenY-n.y;n.set(s.screenX,s.screenY),t.preventDefault(),i.adjustSpherical(r*e.rotation,a*e.rotation).updateQuaternion()}},{key:"handleMainPointerButton",value:function(t,e){this.dragging=e,this.settings.pointer.lock?this.setPointerLocked():e?(this.lastScreenPosition.set(t.screenX,t.screenY),this.dom.addEventListener("mousemove",this)):this.dom.removeEventListener("mousemove",this)}},{key:"handleAuxiliaryPointerButton",value:function(t,e){}},{key:"handleSecondaryPointerButton",value:function(t,e){}},{key:"handlePointerButtonEvent",value:function(t,e){switch(t.preventDefault(),t.button){case st:this.handleMainPointerButton(t,e);break;case rt:this.handleAuxiliaryPointerButton(t,e);break;case at:this.handleSecondaryPointerButton(t,e)}}},{key:"handleTouchEvent",value:function(t,e){var i=t.touches[0];t.preventDefault(),e?(this.lastScreenPosition.set(i.screenX,i.screenY),this.dom.addEventListener("touchmove",this)):this.dom.removeEventListener("touchmove",this)}},{key:"handleKeyboardEvent",value:function(t,e){var i=this.settings.keyBindings;i.has(t.keyCode)&&(t.preventDefault(),this.strategies.get(i.get(t.keyCode)).execute(e))}},{key:"handleWheelEvent",value:function(t){this.rotationManager.zoom(Math.sign(t.deltaY))}},{key:"handlePointerLockEvent",value:function(){document.pointerLockElement===this.dom?this.dom.addEventListener("mousemove",this):this.dom.removeEventListener("mousemove",this)}},{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.handlePointerMoveEvent(t);break;case"touchmove":this.handleTouchMoveEvent(t);break;case"mousedown":this.handlePointerButtonEvent(t,!0);break;case"mouseup":this.handlePointerButtonEvent(t,!1);break;case"touchstart":this.handleTouchEvent(t,!0);break;case"touchend":this.handleTouchEvent(t,!1);break;case"keydown":this.handleKeyboardEvent(t,!0);break;case"keyup":this.handleKeyboardEvent(t,!1);break;case"wheel":this.handleWheelEvent(t);break;case"pointerlockchange":this.handlePointerLockEvent()}}},{key:"update",value:function(t){this.rotationManager.update(t),this.translationManager.update(t)}},{key:"moveTo",value:function(t){return this.rotationManager.moveTo(t),this}},{key:"lookAt",value:function(t){return this.rotationManager.lookAt(t),this}},{key:"setPointerLocked",value:function(){!(0<arguments.length&&void 0!==arguments[0])||arguments[0]?document.pointerLockElement!==this.dom&&void 0!==this.dom.requestPointerLock&&this.dom.requestPointerLock():void 0!==document.exitPointerLock&&document.exitPointerLock()}},{key:"setEnabled",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=this.dom;return this.translationManager.movementState.reset(),t&&!this.enabled?(document.addEventListener("pointerlockchange",this),document.body.addEventListener("keyup",this),document.body.addEventListener("keydown",this),e.addEventListener("mousedown",this),e.addEventListener("mouseup",this),e.addEventListener("touchstart",this),e.addEventListener("touchend",this),e.addEventListener("wheel",this)):!t&&this.enabled&&(document.removeEventListener("pointerlockchange",this),document.body.removeEventListener("keyup",this),document.body.removeEventListener("keydown",this),e.removeEventListener("mousedown",this),e.removeEventListener("mouseup",this),e.removeEventListener("touchstart",this),e.removeEventListener("touchend",this),e.removeEventListener("wheel",this),e.removeEventListener("mousemove",this),e.removeEventListener("touchmove",this)),this.setPointerLocked(!1),this.enabled=t,this}},{key:"dispose",value:function(){this.setEnabled(!1)}}]),a}(),qt=function(t){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;h(this,i);var e=c(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.name="OctreeHelper",e.octree=t,e.update(),e}return l(i,t),u(i,[{key:"createLineSegments",value:function(t,e){var i=Math.pow(2,16)/8-1,n=new w.Group,s=new w.LineBasicMaterial({color:16777215*Math.random()}),r=void 0,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,m=void 0,f=void 0,x=void 0,p=void 0,k=void 0,g=void 0;for(o=d=0,p=Math.ceil(e/i);0<p;--p){for(o+=e<i?e:i,e-=i,a=8*o,h=new Uint16Array(3*a),u=new Float32Array(3*a),x=f=0,r=t.next();!r.done&&d<o;){for(c=(l=r.value).min,y=l.max,m=0;m<12;++m)g=Ft[m],h[x++]=f+g[0],h[x++]=f+g[1];for(m=0;m<8;++m,++f)k=Ct[m],u[3*f]=0===k[0]?c.x:y.x,u[3*f+1]=0===k[1]?c.y:y.y,u[3*f+2]=0===k[2]?c.z:y.z;++d<o&&(r=t.next())}(v=new w.BufferGeometry).setIndex(new w.BufferAttribute(h,1)),v.addAttribute("position",new w.BufferAttribute(u,3)),n.add(new w.LineSegments(v,s))}this.add(n)}},{key:"update",value:function(){var t=null!==this.octree?this.octree.getDepth():-1,e=0,i=void 0;for(this.dispose();e<=t;)i=this.octree.findOctantsByLevel(e),this.createLineSegments(i[Symbol.iterator](),"number"==typeof i.size?i.size:i.length),++e}},{key:"dispose",value:function(){var t,e=this.children,i=void 0,n=void 0,s=void 0,r=void 0,a=void 0;for(s=0,t=e.length;s<t;++s){for(r=0,a=(n=(i=e[s]).children).length;r<a;++r)n[r].geometry.dispose(),n[r].material.dispose();for(;0<n.length;)i.remove(n[0])}for(;0<e.length;)this.remove(e[0])}}]),i}(w.Group),Ct=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],Ft=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],Dt=new A,Lt=function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new A;h(this,i),this.min=t,this.max=e,this.children=null}return u(i,[{key:"getCenter",value:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A).addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A).subVectors(this.max,this.min)}},{key:"split",value:function(){var t=this.min,e=this.max,i=this.getCenter(Dt),n=this.children=[null,null,null,null,null,null,null,null],s=void 0,r=void 0;for(s=0;s<8;++s)r=_t[s],n[s]=new this.constructor(new A(0===r[0]?t.x:i.x,0===r[1]?t.y:i.y,0===r[2]?t.z:i.z),new A(0===r[0]?i.x:e.x,0===r[1]?i.y:e.y,0===r[2]?i.z:e.z))}}]),i}(),_t=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],Bt=new A,Ut=(function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;h(this,i),this.min=t,this.size=e,this.children=null}u(i,[{key:"getCenter",value:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A).copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:new A).set(this.size,this.size,this.size)}},{key:"split",value:function(){var t=this.min,e=this.getCenter(Bt),i=.5*this.size,n=this.children=[null,null,null,null,null,null,null,null],s=void 0,r=void 0;for(s=0;s<8;++s)r=_t[s],n[s]=new this.constructor(new A(0===r[0]?t.x:e.x,0===r[1]?t.y:e.y,0===r[2]?t.z:e.z),i)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}])}(),function(){function i(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];h(this,i),this.value=t,this.done=e}return u(i,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),i}()),Vt=new S,Rt=function(){function i(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;h(this,i),this.octree=t,this.region=e,this.cull=null!==e,this.result=new Ut,this.trace=null,this.indices=null,this.reset()}return u(i,[{key:"reset",value:function(){var t=this.octree.root;return this.trace=[],this.indices=[],null!==t&&(Vt.min=t.min,Vt.max=t.max,this.cull&&!this.region.intersectsBox(Vt)||(this.trace.push(t),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var t=this.cull,e=this.region,i=this.indices,n=this.trace,s=null,r=n.length-1,a=void 0,o=void 0,h=void 0;null===s&&0<=r;)if(a=i[r],o=n[r].children,++i[r],a<8)if(null!==o){if(h=o[a],t&&(Vt.min=h.min,Vt.max=h.max,!e.intersectsBox(Vt)))continue;n.push(h),i.push(0),++r}else s=n.pop(),i.pop();else n.pop(),i.pop(),--r;return this.result.value=s,this.result.done=null===s,this.result}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),i}(),jt=[new A,new A,new A],It=new S,Nt=new it,Ht=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],Qt=0;function Wt(t,e,i,n){var s=void 0,r=0;return e<i?(s=e,r=0):(s=i,r=1),n<s&&(r=2),Ht[t][r]}var Gt=function(){function t(){h(this,t)}return u(t,null,[{key:"intersectOctree",value:function(t,e,i){var n,s,r,a,o,h,u,l,c,y=It.min.set(0,0,0),v=It.max.subVectors(t.max,t.min),d=t.getDimensions(jt[0]),m=jt[1].copy(d).multiplyScalar(.5),f=Nt.origin.copy(e.ray.origin),x=Nt.direction.copy(e.ray.direction);f.sub(t.getCenter(jt[2])).add(m),Qt=0,x.x<0&&(f.x=d.x-f.x,x.x=-x.x,Qt|=4),x.y<0&&(f.y=d.y-f.y,x.y=-x.y,Qt|=2),x.z<0&&(f.z=d.z-f.z,x.z=-x.z,Qt|=1),n=1/x.x,s=1/x.y,r=1/x.z,a=(y.x-f.x)*n,o=(v.x-f.x)*n,h=(y.y-f.y)*s,u=(v.y-f.y)*s,l=(y.z-f.z)*r,c=(v.z-f.z)*r,Math.max(Math.max(a,h),l)<Math.min(Math.min(o,u),c)&&function t(e,i,n,s,r,a,o,h,u){var l,c,y,v,d,m,f,x=e.children,p=void 0,k=void 0,g=void 0,w=void 0;if(0<=r&&0<=a&&0<=o)if(null===x)u.push(e);else{v=k=.5*(i+r),d=g=.5*(n+a),m=w=.5*((y=s)+o),f=0,(c=n)<(l=i)&&y<l?(d<l&&(f|=2),m<l&&(f|=1)):y<c?(v<c&&(f|=4),m<c&&(f|=1)):(v<y&&(f|=4),d<y&&(f|=2)),p=f;do{switch(p){case 0:t(x[Qt],i,n,s,k,g,w,h,u),p=Wt(p,k,g,w);break;case 1:t(x[1^Qt],i,n,w,k,g,o,h,u),p=Wt(p,k,g,o);break;case 2:t(x[2^Qt],i,g,s,k,a,w,h,u),p=Wt(p,k,a,w);break;case 3:t(x[3^Qt],i,g,w,k,a,o,h,u),p=Wt(p,k,a,o);break;case 4:t(x[4^Qt],k,n,s,r,g,w,h,u),p=Wt(p,r,g,w);break;case 5:t(x[5^Qt],k,n,w,r,g,o,h,u),p=Wt(p,r,g,o);break;case 6:t(x[6^Qt],k,g,s,r,a,w,h,u),p=Wt(p,r,a,w);break;case 7:t(x[7^Qt],k,g,w,r,a,o,h,u),p=8}}while(p<8)}}(t.root,a,h,l,o,u,c,e,i)}}]),t}(),Yt=new S;var Xt=function(){function i(t,e){h(this,i),this.root=void 0!==t&&void 0!==e?new Lt(t,e):null}return u(i,[{key:"getCenter",value:function(t){return this.root.getCenter(t)}},{key:"getDimensions",value:function(t){return this.root.getDimensions(t)}},{key:"getDepth",value:function(){return function t(e){var i=e.children,n=0,s=void 0,r=void 0,a=void 0;if(null!==i)for(s=0,r=i.length;s<r;++s)n<(a=1+t(i[s]))&&(n=a);return n}(this.root)}},{key:"cull",value:function(t){var e=[];return function t(e,i,n){var s=e.children,r=void 0,a=void 0;if(Yt.min=e.min,Yt.max=e.max,i.intersectsBox(Yt))if(null!==s)for(r=0,a=s.length;r<a;++r)t(s[r],i,n);else n.push(e)}(this.root,t,e),e}},{key:"findOctantsByLevel",value:function(t){var e=[];return function t(e,i,n,s){var r=e.children,a=void 0,o=void 0;if(n===i)s.push(e);else if(null!==r)for(++n,a=0,o=r.length;a<o;++a)t(r[a],i,n,s)}(this.root,t,0,e),e}},{key:"raycast",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return Gt.intersectOctree(this,t,e),e}},{key:"leaves",value:function(t){return new Rt(this,t)}},{key:Symbol.iterator,value:function(){return new Rt(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),i}(),Kt=new A,Zt=function(t){function n(t,e){h(this,n);var i=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t,e));return i.points=null,i.data=null,i}return l(n,Lt),u(n,[{key:"distanceToSquared",value:function(t){return Kt.copy(t).clamp(this.min,this.max).sub(t).lengthSquared()}},{key:"distanceToCenterSquared",value:function(t){var e=this.getCenter(Kt),i=t.x-e.x,n=t.y-e.x,s=t.z-e.z;return i*i+n*n+s*s}},{key:"contains",value:function(t,e){var i=this.min,n=this.max;return t.x>=i.x-e&&t.y>=i.y-e&&t.z>=i.z-e&&t.x<=n.x+e&&t.y<=n.y+e&&t.z<=n.z+e}},{key:"redistribute",value:function(t){var e=this.children,i=this.points,n=this.data,s=void 0,r=void 0,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0;if(null!==e&&null!==i)for(s=0,a=i.length;s<a;++s)for(u=i[s],l=n[s],r=0,o=e.length;r<o;++r)if((h=e[r]).contains(u,t)){null===h.points&&(h.points=[],h.data=[]),h.points.push(u),h.data.push(l);break}this.points=null,this.data=null}},{key:"merge",value:function(){var t=this.children,e=void 0,i=void 0,n=void 0;if(null!==t){for(this.points=[],this.data=[],e=0,i=t.length;e<i;++e){var s,r;if(null!==(n=t[e]).points)(s=this.points).push.apply(s,y(n.points)),(r=this.data).push.apply(r,y(n.data))}this.children=null}}}]),n}(),Jt=function t(e,i,n){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;h(this,t),this.distance=e,this.distanceToRay=i,this.point=n,this.object=s},$t=new A,te=1e-6;function ee(t){var e=t.children,i=0,n=void 0,s=void 0;if(null!==e)for(n=0,s=e.length;n<s;++n)i+=ee(e[n]);else null!==t.points&&(i=t.points.length);return i}function ie(t,e,i,n,s){var r=n.children,a=!1,o=!1,h=void 0,u=void 0;if(n.contains(t,i.bias)){if(null===r){if(null===n.points)n.points=[],n.data=[];else for(h=0,u=n.points.length;!a&&h<u;++h)a=n.points[h].equals(t);a?(n.data[h-1]=e,o=!0):n.points.length<i.maxPoints||s===i.maxDepth?(n.points.push(t.clone()),n.data.push(e),++i.pointCount,o=!0):(n.split(),n.redistribute(i.bias),r=n.children)}if(null!==r)for(++s,h=0,u=r.length;!o&&h<u;++h)o=ie(t,e,i,r[h],s)}return o}function ne(t,e,i,n){var s=i.children,r=null,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0;if(i.contains(t,e.bias))if(null!==s)for(a=0,o=s.length;null===r&&a<o;++a)r=ne(t,e,s[a],i);else if(null!==i.points)for(h=i.points,u=i.data,a=0,o=h.length;a<o;++a)if(h[a].equals(t)){l=o-1,r=u[a],a<l&&(h[a]=h[l],u[a]=u[l]),h.pop(),u.pop(),--e.pointCount,null!==n&&ee(n)<=e.maxPoints&&n.merge();break}return r}var se=function(t){function a(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:8,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:8;h(this,a);var r=c(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return r.root=new Zt(t,e),r.bias=Math.max(0,i),r.maxPoints=Math.max(1,Math.round(n)),r.maxDepth=Math.max(0,Math.round(s)),r.pointCount=0,r}return l(a,Xt),u(a,[{key:"countPoints",value:function(t){return ee(t)}},{key:"put",value:function(t,e){return ie(t,e,this,this.root,0)}},{key:"remove",value:function(t){return ne(t,this,this.root,null)}},{key:"fetch",value:function(t){return function t(e,i,n){var s=n.children,r=null,a=void 0,o=void 0,h=void 0;if(n.contains(e,i.bias))if(null!==s)for(a=0,o=s.length;null===r&&a<o;++a)r=t(e,i,s[a]);else if(null!==n.points)for(a=0,o=(h=n.points).length;null===r&&a<o;++a)e.distanceToSquared(h[a])<=te&&(r=n.data[a]);return r}(t,this,this.root)}},{key:"move",value:function(t,e){return function t(e,i,n,s,r,a){var o=s.children,h=null,u=void 0,l=void 0,c=void 0;if(s.contains(e,n.bias))if(s.contains(i,n.bias)){if(null!==o)for(++a,u=0,l=o.length;null===h&&u<l;++u)h=t(e,i,n,o[u],s,a);else if(null!==s.points)for(u=0,l=(c=s.points).length;u<l;++u)if(e.distanceToSquared(c[u])<=te){c[u].copy(i),h=s.data[u];break}}else ie(i,h=ne(e,n,s,r),n,r,a-1);return h}(t,e,this,this.root,null,0)}},{key:"findNearestPoint",value:function(t){return function t(e,i,n,s){var r=s.points,a=s.children,o=null,h=i,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,m=void 0;if(null!==a)for(u=0,l=(v=a.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(t,e){return t.distance-e.distance})).length;u<l;++u)(d=v[u].octant).contains(e,h)&&null!==(m=t(e,h,n,d))&&(y=m.point.distanceToSquared(e),(!n||0<y)&&y<h&&(h=y,o=m));else if(null!==r)for(u=0,l=r.length;u<l;++u)c=r[u],y=e.distanceToSquared(c),(!n||0<y)&&y<h&&(h=y,o={point:c.clone(),data:s.data[u]});return o}(t,1<arguments.length&&void 0!==arguments[1]?arguments[1]:1/0,2<arguments.length&&void 0!==arguments[2]&&arguments[2],this.root)}},{key:"findPoints",value:function(t,e){var i=[];return function t(e,i,n,s,r){var a=s.points,o=s.children,h=i*i,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0;if(null!==o)for(u=0,l=o.length;u<l;++u)(v=o[u]).contains(e,i)&&t(e,i,n,v,r);else if(null!==a)for(u=0,l=a.length;u<l;++u)c=a[u],y=e.distanceToSquared(c),(!n||0<y)&&y<=h&&r.push({point:c.clone(),data:s.data[u]})}(t,e,2<arguments.length&&void 0!==arguments[2]&&arguments[2],this.root,i),i}},{key:"raycast",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=n(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"raycast",this).call(this,t);return 0<i.length&&this.testPoints(i,t,e),e}},{key:"testPoints",value:function(t,e,i){var n,s=e.params.Points.threshold,r=s*s,a=void 0,o=void 0,h=void 0,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,m=void 0;for(l=0,n=t.length;l<n;++l)if(null!==(d=(v=t[l]).points))for(c=0,y=d.length;c<y;++c)m=d[c],(u=e.ray.distanceSqToPoint(m))<r&&(a=e.ray.closestPointToPoint(m,$t),(o=e.ray.origin.distanceTo(a))>=e.near&&o<=e.far&&(h=Math.sqrt(u),i.push(new Jt(o,h,a,v.data[c]))))}}]),a}(),re=new S,ae=new A,oe=new A,he=new A,ue=(function(){function t(){h(this,t)}u(t,null,[{key:"recycleOctants",value:function(t,e){var i=t.min,n=t.getCenter(oe),s=t.getDimensions(he).multiplyScalar(.5),r=t.children,a=e.length,o=void 0,h=void 0,u=void 0,l=void 0;for(o=0;o<8;++o)for(u=_t[o],re.min.addVectors(i,ae.fromArray(u).multiply(s)),re.max.addVectors(n,ae.fromArray(u).multiply(s)),h=0;h<a;++h)if(null!==(l=e[h])&&re.min.equals(l.min)&&re.max.equals(l.max)){r[o]=l,e[h]=null;break}}}])}(),new w.Vector2),le=function(t){function s(t,e,i){h(this,s);var n=c(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return n.params.Points.threshold=.1,n.octree=t,n.camera=e,n.object=i,n.enabled=!0,n.delta="",n.selectedObject=null,n.selectedPoint=new w.Mesh(new w.SphereBufferGeometry(.2,16,16),new w.MeshBasicMaterial({transparent:!0,color:52479,opacity:.75})),n.selectedPoint.visible=!1,n}return l(s,t),u(s,[{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.raycast(t)}}},{key:"raycast",value:function(t){var e=void 0,i=void 0,n=void 0,s=void 0;ue.x=t.clientX/window.innerWidth*2-1,ue.y=-t.clientY/window.innerHeight*2+1,this.setFromCamera(ue,this.camera),this.enabled?(i=performance.now(),e=this.octree.raycast(this)):(i=performance.now(),e=this.intersectObjects(this.object.children)),n=performance.now(),this.delta=(n-i).toFixed(2)+" ms",null!==this.selectedObject&&(this.selectedObject.material.color.setHex(12582912),this.selectedObject=null,this.selectedPoint.visible=!1),0<e.length&&(void 0!==(s=e[0]).object?(this.selectedObject=s.object,this.selectedObject.material.color.setHex(13434624),this.selectedPoint.visible=s.object.parent.visible,this.selectedPoint.position.copy(s.point)):console.warn(e))}},{key:"registerOptions",value:function(t){var e=t.addFolder("Raycasting");e.add(this,"enabled"),e.add(this,"delta").listen(),e.open()}}]),s}(w.Raycaster),ce=new w.Matrix4,ye=new w.Frustum,ve=function(){function i(t,e){h(this,i),this.octree=t,this.scene=e,this.enabled=!1,this.cullCamera=new w.PerspectiveCamera(20,1.77,.5,5),this.cullCamera.matrixAutoUpdate=!1,this.s=new w.Spherical(5,Math.PI/3,1.75*Math.PI),this.delta="",this.culledOctants=new w.Points(new w.BufferGeometry,new w.PointsMaterial({color:13434624,sizeAttenuation:!1,size:2})),this.culledOctants.visible=!1,this.cameraHelper=new w.CameraHelper(this.cullCamera),this.cameraHelper.visible=!1}return u(i,[{key:"updateCamera",value:function(){var t=this.cullCamera;t.position.setFromSpherical(this.s),t.lookAt(this.scene.position),t.updateMatrix(),t.updateMatrixWorld(),ye.setFromMatrix(ce.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse))}},{key:"cull",value:function(){var t=this.culledOctants,e=void 0,i=void 0,n=void 0,s=void 0,r=void 0,a=void 0,o=void 0;if(this.enabled){if(this.updateCamera(),e=performance.now(),a=this.octree.cull(ye),this.delta=(performance.now()-e).toFixed(2)+" ms",0<a.length){for(o=new Float32Array(3*a.length*2),n=i=0,s=a.length;i<s;++i)r=a[i],o[n++]=r.min.x,o[n++]=r.min.y,o[n++]=r.min.z,o[n++]=r.max.x,o[n++]=r.max.y,o[n++]=r.max.z;t.geometry.removeAttribute("position"),t.geometry.addAttribute("position",new w.BufferAttribute(o,3)),this.scene.remove(t),this.scene.add(t)}else this.scene.remove(t);this.cameraHelper.update()}}},{key:"registerOptions",value:function(t){var e=this,i=t.addFolder("Frustum Culling");i.add(this,"enabled").onChange(function(){e.cameraHelper.visible=e.culledOctants.visible=e.enabled,e.cull()}),i.add(this,"delta").listen(),i.open();var n=i.addFolder("Camera Adjustment");n.add(this.s,"radius").min(.1).max(10).step(.1).onChange(function(){e.cull()}),n.add(this.s,"phi").min(1e-6).max(Math.PI-1e-6).onChange(function(){e.cull()}),n.add(this.s,"theta").min(0).max(2*Math.PI).onChange(function(){e.cull()})}}]),i}(),de=function(t){function e(){h(this,e);var t=c(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,"point-octree"));return t.points=null,t.octreeHelper=null,t.octreeRaycaster=null,t.frustumCuller=null,t}return l(e,i),u(e,[{key:"initialize",value:function(){var l=this.scene,t=this.renderer,e=new w.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.01,200);e.position.set(10,6,10),this.camera=e;var i=new Ot(e.position,e.quaternion,t.domElement);i.settings.pointer.lock=!1,i.settings.zoom.maxDistance=60,i.settings.sensitivity.translation=10,i.settings.sensitivity.zoom=1,i.lookAt(l.position),this.controls=i,l.fog=new w.FogExp2(855309,.025),t.setClearColor(l.fog.color);var n=function(){function t(t,e,i,n){var s,r=new w.BufferGeometry,a=new Float32Array(3*t),o=e/2,h=void 0,u=void 0,l=void 0,c=void 0;for(c=0,s=a.length;c<s;c+=3)h=Math.random()*e-o,u=Math.random()*e-o,l=i+(Math.random()*n*2-n),a[c]=h,a[c+1]=u,a[c+2]=l;return r.addAttribute("position",new w.BufferAttribute(a,3)),r}var e=new w.Object3D,i=8,n=6/(i-1),s=-3,r=void 0,a=new w.PointsMaterial({color:12582912,sizeAttenuation:!1,size:1});for(console.log("Generating",65536*i,"points...");0<i--;)r=new w.Points(t(65536,6,s,.25),a),a=a.clone(),s+=n,e.add(r);return e}();this.points=n,l.add(n);var s,r,a,o=function(t){var e=new w.Vector3,i=new w.Box3;i.setFromObject(l);var n=performance.now(),s=void 0,r=void 0,a=void 0,o=void 0,h=void 0,u=new se(i.min,i.max,0,8,5);for(s=t.children.length-1;0<=s;--s)for(a=0,o=(h=(r=t.children[s]).geometry.getAttribute("position").array).length;a<o;a+=3)u.put(e.fromArray(h,a),r);return console.log("Octree:",u,"created in",(performance.now()-n).toFixed(2)+" ms"),u}(n),h=(s=o,r=performance.now(),(a=new qt(s)).visible=!1,console.log("OctreeHelper:",a,"created in",(performance.now()-r).toFixed(2)+" ms"),a);this.octreeHelper=h,l.add(h),this.raycaster=new le(o,e,n),t.domElement.addEventListener("mousemove",this.raycaster),l.add(this.raycaster.selectedPoint),this.frustumCuller=new ve(o,l),l.add(this.frustumCuller.cameraHelper)}},{key:"render",value:function(t){this.controls.update(t),n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"render",this).call(this,t)}},{key:"registerOptions",value:function(t){var e=this.points,i=this.octreeHelper;this.raycaster.registerOptions(t),this.frustumCuller.registerOptions(t);var n={"level mask":i.children.length},s=t.addFolder("Points");s.add(e,"visible"),s.open(),(s=t.addFolder("Octree Helper")).add(i,"visible"),s.add(n,"level mask").min(0).max(i.children.length).step(1).onChange(function(){var t,e=void 0;for(e=0,t=i.children.length;e<t;++e)i.children[e].visible=n["level mask"]===i.children.length||e===n["level mask"]}),s.open()}},{key:"reset",value:function(){return n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"reset",this).call(this),this.composer.renderer.domElement.removeEventListener("mousemove",this.raycaster),this}}]),e}(),me=void 0;function fe(t){requestAnimationFrame(fe),me.render(t)}function xe(t){document.getElementById("viewport").children[0].style.display="initial"}function pe(t){document.getElementById("viewport").children[0].style.display="none"}window.addEventListener("load",function t(e){this.removeEventListener("load",t);var i=document.getElementById("viewport"),n=new w.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!0});n.setSize(i.clientWidth,i.clientHeight),n.setPixelRatio(window.devicePixelRatio),n.setClearColor(0),(me=new r(i,{aside:document.getElementById("aside"),renderer:n})).addEventListener("change",xe),me.addEventListener("load",pe),me.addDemo(new de),fe()}),window.addEventListener("resize",function(){var n=0;function e(t){var e=t.target.innerWidth,i=t.target.innerHeight;me.setSize(e,i),n=0}return function(t){0===n&&(n=setTimeout(e,66,t))}}()),document.addEventListener("keydown",function(t){var e=this.getElementById("aside");t.altKey&&null!==e&&(t.preventDefault(),e.style.visibility="hidden"===e.style.visibility?"visible":"hidden")})}(THREE,dat,Stats);