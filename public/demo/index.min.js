!function(t,i,e){"use strict";function n(t,i,e){return Math.max(Math.min(t,e),i)}function r(t,i,e,n,r,s){var o=0;return t>i&&t>e?(r<t&&(o|=2),s<t&&(o|=1)):i>e?(n<i&&(o|=4),s<i&&(o|=1)):(n<e&&(o|=4),r<e&&(o|=2)),o}function s(t,i,e,n){var r,s=0;return i<e?(r=i,s=0):(r=e,s=1),n<r&&(s=2),ht[t][s]}function o(t,i,e,n,h,a,u,c,p){var y,l,m,d,f=t.children;if(h>=0&&a>=0&&u>=0)if(null===f)p.push(t);else{y=r(i,e,n,l=.5*(i+h),m=.5*(e+a),d=.5*(n+u));do{switch(y){case 0:o(f[ot[8]],i,e,n,l,m,d,c,p),y=s(y,l,m,d);break;case 1:o(f[ot[8]^ot[1]],i,e,d,l,m,u,c,p),y=s(y,l,m,u);break;case 2:o(f[ot[8]^ot[2]],i,m,n,l,a,d,c,p),y=s(y,l,a,d);break;case 3:o(f[ot[8]^ot[3]],i,m,d,l,a,u,c,p),y=s(y,l,a,u);break;case 4:o(f[ot[8]^ot[4]],l,e,n,h,m,d,c,p),y=s(y,h,m,d);break;case 5:o(f[ot[8]^ot[5]],l,e,d,h,m,u,c,p),y=s(y,h,m,u);break;case 6:o(f[ot[8]^ot[6]],l,m,n,h,a,d,c,p),y=s(y,h,a,d);break;case 7:o(f[ot[8]^ot[7]],l,m,d,h,a,u,c,p),y=8}}while(y<8)}}function h(t){var i,e,n,r=t.children,s=0;if(null!==r)for(i=0,e=r.length;i<e;++i)(n=1+h(r[i]))>s&&(s=n);return s}function a(t,i,e){var n,r,s=t.children;if(ft.min=t.min,ft.max=t.max,i.intersectsBox(ft))if(null!==s)for(n=0,r=s.length;n<r;++n)a(s[n],i,e);else e.push(t)}function u(t,i,e,n){var r,s,o=t.children;if(e===i)n.push(t);else if(null!==o)for(++e,r=0,s=o.length;r<s;++r)u(o[r],i,e,n)}function c(t){var i,e,n=t.children,r=0;if(null!==n)for(i=0,e=n.length;i<e;++i)r+=c(n[i]);else null!==t.points&&(r=t.points.length);return r}function p(t,i,e,n,r){var s,o,h=n.children,a=!1,u=!1;if(n.contains(t,e.bias)){if(null===h){if(null===n.points)n.points=[],n.data=[];else for(s=0,o=n.points.length;!a&&s<o;++s)a=n.points[s].equals(t);a?(n.data[s-1]=i,u=!0):n.points.length<e.maxPoints||r===e.maxDepth?(n.points.push(t.clone()),n.data.push(i),++e.pointCount,u=!0):(n.split(),n.redistribute(e.bias),h=n.children)}if(null!==h)for(++r,s=0,o=h.length;!u&&s<o;++s)u=p(t,i,e,h[s],r)}return u}function y(t,i,e,n){var r,s,o,h,a,u=e.children,p=null;if(e.contains(t,i.bias))if(null!==u)for(r=0,s=u.length;null===p&&r<s;++r)p=y(t,i,u[r],e);else if(null!==e.points)for(o=e.points,h=e.data,r=0,s=o.length;r<s;++r)if(o[r].equals(t)){a=s-1,p=h[r],r<a&&(o[r]=o[a],h[r]=h[a]),o.pop(),h.pop(),--i.pointCount,null!==n&&c(n)<=i.maxPoints&&n.merge();break}return p}function l(t,i,e){var n,r,s,o=e.children,h=null;if(e.contains(t,i.bias))if(null!==o)for(n=0,r=o.length;null===h&&n<r;++n)h=l(t,i,o[n]);else for(n=0,r=(s=e.points).length;null===h&&n<r;++n)t.distanceToSquared(s[n])<=gt&&(h=e.data[n]);return h}function m(t,i,e,n,r,s){var o,h,a,u=n.children,c=null;if(n.contains(t,e.bias))if(n.contains(i,e.bias)){if(null!==u)for(++s,o=0,h=u.length;null===c&&o<h;++o)c=m(t,i,e,u[o],n,s);else for(o=0,h=(a=n.points).length;o<h;++o)if(t.distanceToSquared(a[o])<=gt){a[o].copy(i),c=n.data[o];break}}else p(i,c=y(t,e,n,r),e,r,s-1);return c}function d(t,i,e,n){var r,s,o,h,a,u,c,p=n.points,y=n.children,l=null,m=i;if(null!==y)for(r=0,s=(a=y.map(function(i){return{octant:i,distance:i.distanceToCenterSquared(t)}}).sort(function(t,i){return t.distance-i.distance})).length;r<s;++r)(u=a[r].octant).contains(t,m)&&null!==(c=d(t,m,e,u))&&(h=c.point.distanceToSquared(t),(!e||h>0)&&h<m&&(m=h,l=c));else if(null!==p)for(r=0,s=p.length;r<s;++r)o=p[r],h=t.distanceToSquared(o),(!e||h>0)&&h<m&&(m=h,l={point:o.clone(),data:n.data[r]});return l}function f(t,i,e,n,r){var s,o,h,a,u,c=n.points,p=n.children,y=i*i;if(null!==p)for(s=0,o=p.length;s<o;++s)(u=p[s]).contains(t,i)&&f(t,i,e,u,r);else if(null!==c)for(s=0,o=c.length;s<o;++s)h=c[s],a=t.distanceToSquared(h),(!e||a>0)&&a<=y&&r.push({point:h.clone(),data:n.data[s]})}i=i&&i.hasOwnProperty("default")?i.default:i,e=e&&e.hasOwnProperty("default")?e.default:e;var x=function(i){function e(t){void 0===t&&(t=null),i.call(this),this.name="OctreeHelper",this.octree=t,this.update()}return i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e,e.prototype.createLineSegments=function(e,n){var r,s,o,h,a,u,c,p,y,l,m,d,f,x,z,M,g=Math.pow(2,16)/8-1,b=new i,S=new t.LineBasicMaterial({color:16777215*Math.random()});for(l=0,o=0,x=Math.ceil(n/g);x>0;--x){for(o+=n<g?n:g,n-=g,s=8*o,h=new Uint16Array(3*s),a=new Float32Array(3*s),d=0,f=0,r=e.next();!r.done&&l<o;){for(c=(u=r.value).min,p=u.max,m=0;m<12;++m)M=v[m],h[f++]=d+M[0],h[f++]=d+M[1];for(m=0;m<8;++m,++d)z=w[m],a[3*d]=0===z[0]?c.x:p.x,a[3*d+1]=0===z[1]?c.y:p.y,a[3*d+2]=0===z[2]?c.z:p.z;++l<o&&(r=e.next())}(y=new t.BufferGeometry).setIndex(new t.BufferAttribute(h,1)),y.addAttribute("position",new t.BufferAttribute(a,3)),b.add(new t.LineSegments(y,S))}this.add(b)},e.prototype.update=function(){var t,i=this,e=null!==this.octree?this.octree.getDepth():-1,n=0;for(this.dispose();n<=e;)t=i.octree.findOctantsByLevel(n),i.createLineSegments(t[Symbol.iterator](),"number"==typeof t.size?t.size:t.length),++n},e.prototype.dispose=function(){var t,i,e,n,r,s,o=this,h=this.children;for(e=0,r=h.length;e<r;++e){for(n=0,s=(i=(t=h[e]).children).length;n<s;++n)i[n].geometry.dispose(),i[n].material.dispose();for(;i.length>0;)t.remove(i[0])}for(;h.length>0;)o.remove(h[0])},e}(t.Object3D),w=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],v=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],z=function(t,i,e){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=0),this.x=t,this.y=i,this.z=e};z.prototype.set=function(t,i,e){return this.x=t,this.y=i,this.z=e,this},z.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},z.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z)},z.prototype.fromArray=function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this},z.prototype.toArray=function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t},z.prototype.setFromSpherical=function(t){var i=Math.sin(t.phi)*t.radius;return this.x=i*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=i*Math.cos(t.theta),this},z.prototype.setFromCylindrical=function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},z.prototype.setFromMatrixColumn=function(t,i){return this.fromArray(t.elements,4*i)},z.prototype.setFromMatrixPosition=function(t){var i=t.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this},z.prototype.setFromMatrixScale=function(t){var i=this.setFromMatrixColumn(t,0).length(),e=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=i,this.y=e,this.z=n,this},z.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},z.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this},z.prototype.addVectors=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},z.prototype.addScaledVector=function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},z.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},z.prototype.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this},z.prototype.subVectors=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},z.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},z.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},z.prototype.multiplyVectors=function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this},z.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},z.prototype.divideScalar=function(t){return this.x/=t,this.y/=t,this.z/=t,this},z.prototype.cross=function(t){var i=this.x,e=this.y,n=this.z;return this.x=e*t.z-n*t.y,this.y=n*t.x-i*t.z,this.z=i*t.y-e*t.x,this},z.prototype.crossVectors=function(t,i){var e=t.x,n=t.y,r=t.z,s=i.x,o=i.y,h=i.z;return this.x=n*h-r*o,this.y=r*s-e*h,this.z=e*o-n*s,this},z.prototype.applyMatrix3=function(t){var i=this.x,e=this.y,n=this.z,r=t.elements;return this.x=r[0]*i+r[3]*e+r[6]*n,this.y=r[1]*i+r[4]*e+r[7]*n,this.z=r[2]*i+r[5]*e+r[8]*n,this},z.prototype.applyMatrix4=function(t){var i=this.x,e=this.y,n=this.z,r=t.elements;return this.x=r[0]*i+r[4]*e+r[8]*n+r[12],this.y=r[1]*i+r[5]*e+r[9]*n+r[13],this.z=r[2]*i+r[6]*e+r[10]*n+r[14],this},z.prototype.applyQuaternion=function(t){var i=this.x,e=this.y,n=this.z,r=t.x,s=t.y,o=t.z,h=t.w,a=h*i+s*n-o*e,u=h*e+o*i-r*n,c=h*n+r*e-s*i,p=-r*i-s*e-o*n;return this.x=a*h+p*-r+u*-o-c*-s,this.y=u*h+p*-s+c*-r-a*-o,this.z=c*h+p*-o+a*-s-u*-r,this},z.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},z.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},z.prototype.reflect=function(t,i){void 0===i&&(i=new z);var e=t.x,n=t.y,r=t.z;return this.sub(t.multiplyScalar(2*this.dot(t))),t.set(e,n,r),this},z.prototype.angleTo=function(t){var i=this.dot(t)/Math.sqrt(this.lengthSquared()*t.lengthSquared());return Math.acos(Math.min(Math.max(i,-1),1))},z.prototype.lengthManhattan=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},z.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},z.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},z.prototype.distanceToManhattan=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},z.prototype.distanceToSquared=function(t){var i=this.x-t.x,e=this.y-t.y,n=this.z-t.z;return i*i+e*e+n*n},z.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},z.prototype.normalize=function(){return this.divideScalar(this.length())},z.prototype.setLength=function(t){return this.normalize().multiplyScalar(t)},z.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},z.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},z.prototype.clamp=function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this},z.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},z.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},z.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},z.prototype.lerp=function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this},z.prototype.lerpVectors=function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)},z.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z};var M=new z,g=function(t,i){void 0===t&&(t=new z(1/0,1/0,1/0)),void 0===i&&(i=new z(-1/0,-1/0,-1/0)),this.min=t,this.max=i};g.prototype.set=function(t,i){return this.min.copy(t),this.max.copy(i),this},g.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},g.prototype.clone=function(){return(new this.constructor).copy(this)},g.prototype.makeEmpty=function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},g.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},g.prototype.getCenter=function(t){return void 0===t&&(t=new z),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},g.prototype.getSize=function(t){return void 0===t&&(t=new z),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},g.prototype.getBoundingSphere=function(t){return void 0===t&&(t=new S),this.getCenter(t.center),t.radius=.5*this.getSize(M).length(),t},g.prototype.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},g.prototype.expandByVector=function(t){return this.min.sub(t),this.max.add(t),this},g.prototype.expandByScalar=function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},g.prototype.setFromPoints=function(t){var i,e,n=this;for(this.min.set(0,0,0),this.max.set(0,0,0),i=0,e=t.length;i<e;++i)n.expandByPoint(t[i]);return this},g.prototype.setFromCenterAndSize=function(t,i){var e=M.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this},g.prototype.clampPoint=function(t,i){return void 0===i&&(i=new z),i.copy(t).clamp(this.min,this.max)},g.prototype.distanceToPoint=function(t){return M.copy(t).clamp(this.min,this.max).sub(t).length()},g.prototype.translate=function(t){return this.min.add(t),this.max.add(t),this},g.prototype.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},g.prototype.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},g.prototype.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},g.prototype.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},g.prototype.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},g.prototype.intersectsSphere=function(t){return this.clampPoint(t.center,M).distanceToSquared(t.center)<=t.radius*t.radius},g.prototype.intersectsPlane=function(t){var i,e;return t.normal.x>0?(i=t.normal.x*this.min.x,e=t.normal.x*this.max.x):(i=t.normal.x*this.max.x,e=t.normal.x*this.min.x),t.normal.y>0?(i+=t.normal.y*this.min.y,e+=t.normal.y*this.max.y):(i+=t.normal.y*this.max.y,e+=t.normal.y*this.min.y),t.normal.z>0?(i+=t.normal.z*this.min.z,e+=t.normal.z*this.max.z):(i+=t.normal.z*this.max.z,e+=t.normal.z*this.min.z),i<=t.constant&&e>=t.constant},g.prototype.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)};var b=new g,S=function(t,i){void 0===t&&(t=new z),void 0===i&&(i=0),this.center=t,this.radius=i};S.prototype.set=function(t,i){return this.center.copy(t),this.radius=i,this},S.prototype.copy=function(t){return this.center.copy(t.center),this.radius=t.radius,this},S.prototype.clone=function(){return(new this.constructor).copy(this)},S.prototype.setFromPoints=function(t,i){void 0===i&&(i=b.setFromPoints(t).getCenter(this.center));var e,n,r=this.center,s=0;for(e=0,n=t.length;e<n;++e)s=Math.max(s,r.distanceToSquared(t[e]));return this.radius=Math.sqrt(s),this},S.prototype.getBoundingBox=function(t){return void 0===t&&(t=new g),t.set(this.center,this.center),t.expandByScalar(this.radius),t},S.prototype.isEmpty=function(){return this.radius<=0},S.prototype.translate=function(t){return this.center.add(t),this},S.prototype.clampPoint=function(t,i){void 0===i&&(i=new z);var e=this.center.distanceToSquared(t);return i.copy(t),e>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},S.prototype.distanceToPoint=function(t){return t.distanceTo(this.center)-this.radius},S.prototype.containsPoint=function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},S.prototype.intersectsSphere=function(t){var i=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=i*i},S.prototype.intersectsBox=function(t){return t.intersectsSphere(this)},S.prototype.intersectsPlane=function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},S.prototype.equals=function(t){return t.center.equals(this.center)&&t.radius===this.radius};var A=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i},P={width:{configurable:!0},height:{configurable:!0}};P.width.get=function(){return this.x},P.width.set=function(t){return this.x=t},P.height.get=function(){return this.y},P.height.set=function(t){return this.y=t},A.prototype.set=function(t,i){return this.x=t,this.y=i,this},A.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},A.prototype.clone=function(){return new this.constructor(this.x,this.y)},A.prototype.fromArray=function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this},A.prototype.toArray=function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t},A.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},A.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},A.prototype.addVectors=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this},A.prototype.addScaledVector=function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this},A.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},A.prototype.subScalar=function(t){return this.x-=t,this.y-=t,this},A.prototype.subVectors=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this},A.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},A.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},A.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},A.prototype.divideScalar=function(t){return this.x/=t,this.y/=t,this},A.prototype.applyMatrix3=function(t){var i=this.x,e=this.y,n=t.elements;return this.x=n[0]*i+n[3]*e+n[6],this.y=n[1]*i+n[4]*e+n[7],this},A.prototype.dot=function(t){return this.x*t.x+this.y*t.y},A.prototype.lengthManhattan=function(){return Math.abs(this.x)+Math.abs(this.y)},A.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},A.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},A.prototype.distanceToManhattan=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},A.prototype.distanceToSquared=function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e},A.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},A.prototype.normalize=function(){return this.divideScalar(this.length())},A.prototype.setLength=function(t){return this.normalize().multiplyScalar(t)},A.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},A.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},A.prototype.clamp=function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this},A.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},A.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},A.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},A.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},A.prototype.angle=function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},A.prototype.lerp=function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this},A.prototype.lerpVectors=function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)},A.prototype.rotateAround=function(t,i){var e=Math.cos(i),n=Math.sin(i),r=this.x-t.x,s=this.y-t.y;return this.x=r*e-s*n+t.x,this.y=r*n+s*e+t.y,this},A.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},Object.defineProperties(A.prototype,P);var q=new A,C=function(t,i){void 0===t&&(t=new A(1/0,1/0)),void 0===i&&(i=new A(-1/0,-1/0)),this.min=t,this.max=i};C.prototype.set=function(t,i){return this.min.copy(t),this.max.copy(i),this},C.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},C.prototype.clone=function(){return(new this.constructor).copy(this)},C.prototype.makeEmpty=function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},C.prototype.isEmpty=function(){return this.max.x<this.min.x||this.max.y<this.min.y},C.prototype.getCenter=function(t){return void 0===t&&(t=new A),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},C.prototype.getSize=function(t){return void 0===t&&(t=new A),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},C.prototype.getBoundingSphere=function(t){return void 0===t&&(t=new S),this.getCenter(t.center),t.radius=.5*this.getSize(q).length(),t},C.prototype.expandByPoint=function(t){return this.min.min(t),this.max.max(t),this},C.prototype.expandByVector=function(t){return this.min.sub(t),this.max.add(t),this},C.prototype.expandByScalar=function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},C.prototype.setFromPoints=function(t){var i,e,n=this;for(this.min.set(0,0),this.max.set(0,0),i=0,e=t.length;i<e;++i)n.expandByPoint(t[i]);return this},C.prototype.setFromCenterAndSize=function(t,i){var e=q.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this},C.prototype.clampPoint=function(t,i){return void 0===i&&(i=new A),i.copy(t).clamp(this.min,this.max)},C.prototype.distanceToPoint=function(t){return q.copy(t).clamp(this.min,this.max).sub(t).length()},C.prototype.translate=function(t){return this.min.add(t),this.max.add(t),this},C.prototype.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},C.prototype.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},C.prototype.containsPoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},C.prototype.containsBox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},C.prototype.intersectsBox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},C.prototype.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)};var F=function(t,i,e){void 0===t&&(t=1),void 0===i&&(i=0),void 0===e&&(e=0),this.radius=t,this.theta=i,this.y=e};F.prototype.set=function(t,i,e){return this.radius=t,this.theta=i,this.y=e,this},F.prototype.copy=function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},F.prototype.clone=function(){return(new this.constructor).copy(this)},F.prototype.setFromVector3=function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this};var k=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])};k.prototype.set=function(t,i,e,n,r,s,o,h,a){var u=this.elements;return u[0]=t,u[3]=i,u[6]=e,u[1]=n,u[4]=r,u[7]=s,u[2]=o,u[5]=h,u[8]=a,this},k.prototype.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},k.prototype.copy=function(t){var i=t.elements,e=this.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},k.prototype.clone=function(){return(new this.constructor).fromArray(this.elements)},k.prototype.fromArray=function(t,i){void 0===i&&(i=0);var e,n=this.elements;for(e=0;e<9;++e)n[e]=t[e+i];return this},k.prototype.toArray=function(t,i){void 0===t&&(t=[]),void 0===i&&(i=0);var e,n=this.elements;for(e=0;e<9;++e)t[e+i]=n[e];return t},k.prototype.multiplyMatrices=function(t,i){var e=t.elements,n=i.elements,r=this.elements,s=e[0],o=e[3],h=e[6],a=e[1],u=e[4],c=e[7],p=e[2],y=e[5],l=e[8],m=n[0],d=n[3],f=n[6],x=n[1],w=n[4],v=n[7],z=n[2],M=n[5],g=n[8];return r[0]=s*m+o*x+h*z,r[3]=s*d+o*w+h*M,r[6]=s*f+o*v+h*g,r[1]=a*m+u*x+c*z,r[4]=a*d+u*w+c*M,r[7]=a*f+u*v+c*g,r[2]=p*m+y*x+l*z,r[5]=p*d+y*w+l*M,r[8]=p*f+y*v+l*g,this},k.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},k.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},k.prototype.multiplyScalar=function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},k.prototype.determinant=function(){var t=this.elements,i=t[0],e=t[1],n=t[2],r=t[3],s=t[4],o=t[5],h=t[6],a=t[7],u=t[8];return i*s*u-i*o*a-e*r*u+e*o*h+n*r*a-n*s*h},k.prototype.getInverse=function(t){var i,e=t.elements,n=this.elements,r=e[0],s=e[1],o=e[2],h=e[3],a=e[4],u=e[5],c=e[6],p=e[7],y=e[8],l=y*a-u*p,m=u*c-y*h,d=p*h-a*c,f=r*l+s*m+o*d;return 0!==f?(i=1/f,n[0]=l*i,n[1]=(o*p-y*s)*i,n[2]=(u*s-o*a)*i,n[3]=m*i,n[4]=(y*r-o*c)*i,n[5]=(o*h-u*r)*i,n[6]=d*i,n[7]=(s*c-p*r)*i,n[8]=(a*r-s*h)*i):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this},k.prototype.transpose=function(){var t,i=this.elements;return t=i[1],i[1]=i[3],i[3]=t,t=i[2],i[2]=i[6],i[6]=t,t=i[5],i[5]=i[7],i[7]=t,this},k.prototype.scale=function(t,i){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=i,e[4]*=i,e[7]*=i,this},k.prototype.rotate=function(t){var i=Math.cos(t),e=Math.sin(t),n=this.elements,r=n[0],s=n[3],o=n[6],h=n[1],a=n[4],u=n[7];return n[0]=i*r+e*h,n[3]=i*s+e*a,n[6]=i*o+e*u,n[1]=-e*r+i*h,n[4]=-e*s+i*a,n[7]=-e*o+i*u,this},k.prototype.translate=function(t,i){var e=this.elements;return e[0]+=t*e[2],e[3]+=t*e[5],e[6]+=t*e[8],e[1]+=i*e[2],e[4]+=i*e[5],e[7]+=i*e[8],this},k.prototype.equals=function(t){var i,e=this.elements,n=t.elements,r=!0;for(i=0;r&&i<9;++i)e[i]!==n[i]&&(r=!1);return r};var T={XYZ:"XYZ",YZX:"YZX",ZXY:"ZXY",XZY:"XZY",YXZ:"YXZ",ZYX:"ZYX"},V=new z,U=function(t,i,e,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=t,this.z=t,this.w=t};U.prototype.set=function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this},U.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},U.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z,this.w)},U.prototype.fromArray=function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},U.prototype.toArray=function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t},U.prototype.setFromEuler=function(t){var i=t.x,e=t.y,n=t.z,r=Math.cos,s=Math.sin,o=r(i/2),h=r(e/2),a=r(n/2),u=s(i/2),c=s(e/2),p=s(n/2);switch(t.order){case T.XYZ:this.x=u*h*a+o*c*p,this.y=o*c*a-u*h*p,this.z=o*h*p+u*c*a,this.w=o*h*a-u*c*p;break;case T.YXZ:this.x=u*h*a+o*c*p,this.y=o*c*a-u*h*p,this.z=o*h*p-u*c*a,this.w=o*h*a+u*c*p;break;case T.ZXY:this.x=u*h*a-o*c*p,this.y=o*c*a+u*h*p,this.z=o*h*p+u*c*a,this.w=o*h*a-u*c*p;break;case T.ZYX:this.x=u*h*a-o*c*p,this.y=o*c*a+u*h*p,this.z=o*h*p-u*c*a,this.w=o*h*a+u*c*p;break;case T.YZX:this.x=u*h*a+o*c*p,this.y=o*c*a+u*h*p,this.z=o*h*p-u*c*a,this.w=o*h*a-u*c*p;break;case T.XZY:this.x=u*h*a-o*c*p,this.y=o*c*a-u*h*p,this.z=o*h*p+u*c*a,this.w=o*h*a+u*c*p}return this},U.prototype.setFromAxisAngle=function(t,i){var e=i/2,n=Math.sin(e);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(e),this},U.prototype.setFromRotationMatrix=function(t){var i,e=t.elements,n=e[0],r=e[4],s=e[8],o=e[1],h=e[5],a=e[9],u=e[2],c=e[6],p=e[10],y=n+h+p;return y>0?(i=.5/Math.sqrt(y+1),this.w=.25/i,this.x=(c-a)*i,this.y=(s-u)*i,this.z=(o-r)*i):n>h&&n>p?(i=2*Math.sqrt(1+n-h-p),this.w=(c-a)/i,this.x=.25*i,this.y=(r+o)/i,this.z=(s+u)/i):h>p?(i=2*Math.sqrt(1+h-n-p),this.w=(s-u)/i,this.x=(r+o)/i,this.y=.25*i,this.z=(a+c)/i):(i=2*Math.sqrt(1+p-n-h),this.w=(o-r)/i,this.x=(s+u)/i,this.y=(a+c)/i,this.z=.25*i),this},U.prototype.setFromUnitVectors=function(t,i){var e=t.dot(i)+1;return e<1e-6?(e=0,Math.abs(t.x)>Math.abs(t.z)?V.set(-t.y,t.x,0):V.set(0,-t.z,t.y)):V.crossVectors(t,i),this.x=V.x,this.y=V.y,this.z=V.z,this.w=e,this.normalize()},U.prototype.invert=function(){return this.conjugate().normalize()},U.prototype.conjugate=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},U.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},U.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},U.prototype.normalize=function(){var t,i=this.length();return 0===i?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/i,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this},U.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},U.prototype.multiplyQuaternions=function(t,i){var e=t.x,n=t.y,r=t.z,s=t.w,o=i.x,h=i.y,a=i.z,u=i.w;return this.x=e*u+s*o+n*a-r*h,this.y=n*u+s*h+r*o-e*a,this.z=r*u+s*a+e*h-n*o,this.w=s*u-e*o-n*h-r*a,this},U.prototype.multiply=function(t){return this.multiplyQuaternions(this,t)},U.prototype.premultiply=function(t){return this.multiplyQuaternions(t,this)},U.prototype.slerp=function(t,i){var e,n,r,s,o,h=this.x,a=this.y,u=this.z,c=this.w;if(1===i)this.copy(t);else if(i>0){if((e=c*t.w+h*t.x+a*t.y+u*t.z)<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,e=-e):this.copy(t),e>=1)return this.w=c,this.x=h,this.y=a,this.z=u,this;if(n=Math.sqrt(1-e*e),Math.abs(n)<.001)return this.w=.5*(c+this.w),this.x=.5*(h+this.x),this.y=.5*(a+this.y),this.z=.5*(u+this.z),this;r=Math.atan2(n,e),s=Math.sin((1-i)*r)/n,o=Math.sin(i*r)/n,this.w=c*s+this.w*o,this.x=h*s+this.x*o,this.y=a*s+this.y*o,this.z=u*s+this.z*o}return this},U.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},U.slerp=function(t,i,e,n){return void 0===e&&(e=new U),e.copy(t).slerp(i,n)},U.slerpFlat=function(t,i,e,n,r,s,o){var h,a,u,c,p,y,l,m,d=r[s],f=r[s+1],x=r[s+2],w=r[s+3],v=e[n],z=e[n+1],M=e[n+2],g=e[n+3];g===w&&v===d&&z===f&&M===x||(h=1-o,y=(c=v*d+z*f+M*x+g*w)>=0?1:-1,(p=1-c*c)>Number.EPSILON&&(u=Math.sqrt(p),l=Math.atan2(u,c*y),h=Math.sin(h*l)/u,o=Math.sin(o*l)/u),v=v*h+d*(m=o*y),z=z*h+f*m,M=M*h+x*m,g=g*h+w*m,h===1-o&&(v*=a=1/Math.sqrt(v*v+z*z+M*M+g*g),z*=a,M*=a,g*=a)),t[i]=v,t[i+1]=z,t[i+2]=M,t[i+3]=g};var B=new k,O=new U,E=function t(i,e,n){void 0===i&&(i=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=i,this.y=e,this.z=n,this.order=t.defaultOrder},X={defaultOrder:{configurable:!0}};E.prototype.set=function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.order=e,this},E.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this},E.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z,this.order)},E.prototype.fromArray=function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.order=t[i+3],this},E.prototype.toArray=function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.order,t},E.prototype.toVector3=function(t){return void 0===t&&(t=new z),t.set(this.x,this.y,this.z)},E.prototype.setFromRotationMatrix=function(t,i){void 0===i&&(i=this.order);var e=t.elements,r=e[0],s=e[4],o=e[8],h=e[1],a=e[5],u=e[9],c=e[2],p=e[6],y=e[10];switch(i){case T.XYZ:this.y=Math.asin(n(o,-1,1)),Math.abs(o)<.99999?(this.x=Math.atan2(-u,y),this.z=Math.atan2(-s,r)):(this.x=Math.atan2(p,a),this.z=0);break;case T.YXZ:this.x=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this.y=Math.atan2(o,y),this.z=Math.atan2(h,a)):(this.y=Math.atan2(-c,r),this.z=0);break;case T.ZXY:this.x=Math.asin(n(p,-1,1)),Math.abs(p)<.99999?(this.y=Math.atan2(-c,y),this.z=Math.atan2(-s,a)):(this.y=0,this.z=Math.atan2(h,r));break;case T.ZYX:this.y=Math.asin(-n(c,-1,1)),Math.abs(c)<.99999?(this.x=Math.atan2(p,y),this.z=Math.atan2(h,r)):(this.x=0,this.z=Math.atan2(-s,a));break;case T.YZX:this.z=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(this.x=Math.atan2(-u,a),this.y=Math.atan2(-c,r)):(this.x=0,this.y=Math.atan2(o,y));break;case T.XZY:this.z=Math.asin(-n(s,-1,1)),Math.abs(s)<.99999?(this.x=Math.atan2(p,a),this.y=Math.atan2(o,r)):(this.x=Math.atan2(-u,y),this.y=0)}return this.order=i,this},E.prototype.setFromQuaternion=function(t,i){return B.makeRotationFromQuaternion(t),this.setFromRotationMatrix(B,i)},E.prototype.setFromVector3=function(t,i){return void 0===i&&(i=this.order),this.set(t.x,t.y,t.z,i)},E.prototype.reorder=function(t){return O.setFromEuler(this),this.setFromQuaternion(O,t)},E.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order},X.defaultOrder.get=function(){return T.XYZ},Object.defineProperties(E,X);var Y=new z,j=new z,Z=function(t,i){void 0===t&&(t=new z),void 0===i&&(i=new z),this.start=t,this.end=i};Z.prototype.set=function(t,i){return this.start.copy(t),this.end.copy(i),this},Z.prototype.copy=function(t){return this.start.copy(t.start),this.end.copy(t.end),this},Z.prototype.clone=function(){return(new this.constructor).copy(this)},Z.prototype.getCenter=function(t){return void 0===t&&(t=new z),t.addVectors(this.start,this.end).multiplyScalar(.5)},Z.prototype.delta=function(t){return void 0===t&&(t=new z),t.subVectors(this.end,this.start)},Z.prototype.lengthSquared=function(){return this.start.distanceToSquared(this.end)},Z.prototype.length=function(){return this.start.distanceTo(this.end)},Z.prototype.at=function(t,i){return this.delta(i).multiplyScalar(t).add(this.start)},Z.prototype.closestPointToPointParameter=function(t,i){Y.subVectors(t,this.start),j.subVectors(this.end,this.start);var e=j.dot(j),n=j.dot(Y);return i?Math.min(Math.max(n/e,0),1):n/e},Z.prototype.closestPointToPoint=function(t,i,e){void 0===i&&(i=!1),void 0===e&&(e=new z);var n=this.closestPointToPointParameter(t,i);return this.delta(e).multiplyScalar(n).add(this.start)},Z.prototype.equals=function(t){return t.start.equals(this.start)&&t.end.equals(this.end)};var R=new z,H=new z,_=new z,L=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};L.prototype.set=function(t,i,e,n,r,s,o,h,a,u,c,p,y,l,m,d){var f=this.elements;return f[0]=t,f[4]=i,f[8]=e,f[12]=n,f[1]=r,f[5]=s,f[9]=o,f[13]=h,f[2]=a,f[6]=u,f[10]=c,f[14]=p,f[3]=y,f[7]=l,f[11]=m,f[15]=d,this},L.prototype.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},L.prototype.copy=function(t){var i=t.elements,e=this.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},L.prototype.clone=function(){return(new this.constructor).fromArray(this.elements)},L.prototype.fromArray=function(t,i){void 0===i&&(i=0);var e,n=this.elements;for(e=0;e<16;++e)n[e]=t[e+i];return this},L.prototype.toArray=function(t,i){void 0===t&&(t=[]),void 0===i&&(i=0);var e,n=this.elements;for(e=0;e<16;++e)t[e+i]=n[e];return t},L.prototype.getMaxScaleOnAxis=function(){var t=this.elements,i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],e=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(i,e,n))},L.prototype.copyPosition=function(t){var i=this.elements,e=t.elements;return i[12]=e[12],i[13]=e[13],i[14]=e[14],this},L.prototype.setPosition=function(t){var i=this.elements;return i[12]=t.x,i[13]=t.y,i[14]=t.z,this},L.prototype.extractBasis=function(t,i,e){return t.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),e.setFromMatrixColumn(this,2),this},L.prototype.makeBasis=function(t,i,e){return this.set(t.x,i.x,e.x,0,t.y,i.y,e.y,0,t.z,i.z,e.z,0,0,0,0,1),this},L.prototype.extractRotation=function(t){var i=this.elements,e=t.elements,n=1/R.setFromMatrixColumn(t,0).length(),r=1/R.setFromMatrixColumn(t,1).length(),s=1/R.setFromMatrixColumn(t,2).length();return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[4]=e[4]*r,i[5]=e[5]*r,i[6]=e[6]*r,i[8]=e[8]*s,i[9]=e[9]*s,i[10]=e[10]*s,this},L.prototype.makeRotationFromEuler=function(t){var i,e,n,r,s,o,h,a,u,c,p,y,l=this.elements,m=t.x,d=t.y,f=t.z,x=Math.cos(m),w=Math.sin(m),v=Math.cos(d),z=Math.sin(d),M=Math.cos(f),g=Math.sin(f);switch(t.order){case T.XYZ:i=x*M,e=x*g,n=w*M,r=w*g,l[0]=v*M,l[4]=-v*g,l[8]=z,l[1]=e+n*z,l[5]=i-r*z,l[9]=-w*v,l[2]=r-i*z,l[6]=n+e*z,l[10]=x*v;break;case T.YXZ:s=v*M,o=v*g,h=z*M,a=z*g,l[0]=s+a*w,l[4]=h*w-o,l[8]=x*z,l[1]=x*g,l[5]=x*M,l[9]=-w,l[2]=o*w-h,l[6]=a+s*w,l[10]=x*v;break;case T.ZXY:s=v*M,o=v*g,h=z*M,a=z*g,l[0]=s-a*w,l[4]=-x*g,l[8]=h+o*w,l[1]=o+h*w,l[5]=x*M,l[9]=a-s*w,l[2]=-x*z,l[6]=w,l[10]=x*v;break;case T.ZYX:i=x*M,e=x*g,n=w*M,r=w*g,l[0]=v*M,l[4]=n*z-e,l[8]=i*z+r,l[1]=v*g,l[5]=r*z+i,l[9]=e*z-n,l[2]=-z,l[6]=w*v,l[10]=x*v;break;case T.YZX:u=x*v,c=x*z,p=w*v,y=w*z,l[0]=v*M,l[4]=y-u*g,l[8]=p*g+c,l[1]=g,l[5]=x*M,l[9]=-w*M,l[2]=-z*M,l[6]=c*g+p,l[10]=u-y*g;break;case T.XZY:u=x*v,c=x*z,p=w*v,y=w*z,l[0]=v*M,l[4]=-g,l[8]=z*M,l[1]=u*g+y,l[5]=x*M,l[9]=c*g-p,l[2]=p*g-c,l[6]=w*M,l[10]=y*g+u}return l[3]=0,l[7]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this},L.prototype.makeRotationFromQuaternion=function(t){var i=this.elements,e=t.x,n=t.y,r=t.z,s=t.w,o=e+e,h=n+n,a=r+r,u=e*o,c=e*h,p=e*a,y=n*h,l=n*a,m=r*a,d=s*o,f=s*h,x=s*a;return i[0]=1-(y+m),i[4]=c-x,i[8]=p+f,i[1]=c+x,i[5]=1-(u+m),i[9]=l-d,i[2]=p-f,i[6]=l+d,i[10]=1-(u+y),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},L.prototype.lookAt=function(t,i,e){var n=this.elements,r=R,s=H,o=_;return o.subVectors(t,i),0===o.lengthSquared()&&(o.z=1),o.normalize(),r.crossVectors(e,o),0===r.lengthSquared()&&(1===Math.abs(e.z)?o.x+=1e-4:o.z+=1e-4,o.normalize(),r.crossVectors(e,o)),r.normalize(),s.crossVectors(o,r),n[0]=r.x,n[4]=s.x,n[8]=o.x,n[1]=r.y,n[5]=s.y,n[9]=o.y,n[2]=r.z,n[6]=s.z,n[10]=o.z,this},L.prototype.multiplyMatrices=function(t,i){var e=this.elements,n=t.elements,r=i.elements,s=n[0],o=n[4],h=n[8],a=n[12],u=n[1],c=n[5],p=n[9],y=n[13],l=n[2],m=n[6],d=n[10],f=n[14],x=n[3],w=n[7],v=n[11],z=n[15],M=r[0],g=r[4],b=r[8],S=r[12],A=r[1],P=r[5],q=r[9],C=r[13],F=r[2],k=r[6],T=r[10],V=r[14],U=r[3],B=r[7],O=r[11],E=r[15];return e[0]=s*M+o*A+h*F+a*U,e[4]=s*g+o*P+h*k+a*B,e[8]=s*b+o*q+h*T+a*O,e[12]=s*S+o*C+h*V+a*E,e[1]=u*M+c*A+p*F+y*U,e[5]=u*g+c*P+p*k+y*B,e[9]=u*b+c*q+p*T+y*O,e[13]=u*S+c*C+p*V+y*E,e[2]=l*M+m*A+d*F+f*U,e[6]=l*g+m*P+d*k+f*B,e[10]=l*b+m*q+d*T+f*O,e[14]=l*S+m*C+d*V+f*E,e[3]=x*M+w*A+v*F+z*U,e[7]=x*g+w*P+v*k+z*B,e[11]=x*b+w*q+v*T+z*O,e[15]=x*S+w*C+v*V+z*E,this},L.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},L.prototype.premultiply=function(t){return this.multiplyMatrices(t,this)},L.prototype.multiplyScalar=function(t){var i=this.elements;return i[0]*=t,i[4]*=t,i[8]*=t,i[12]*=t,i[1]*=t,i[5]*=t,i[9]*=t,i[13]*=t,i[2]*=t,i[6]*=t,i[10]*=t,i[14]*=t,i[3]*=t,i[7]*=t,i[11]*=t,i[15]*=t,this},L.prototype.determinant=function(){var t=this.elements,i=t[0],e=t[4],n=t[8],r=t[12],s=t[1],o=t[5],h=t[9],a=t[13],u=t[2],c=t[6],p=t[10],y=t[14],l=i*o,m=i*h,d=i*a,f=e*s,x=e*h,w=e*a,v=n*s,z=n*o,M=n*a,g=r*s,b=r*o,S=r*h;return t[3]*(S*c-M*c-b*p+w*p+z*y-x*y)+t[7]*(m*y-d*p+g*p-v*y+M*u-S*u)+t[11]*(d*c-l*y-g*c+f*y+b*u-w*u)+t[15]*(-z*u-m*c+l*p+v*c-f*p+x*u)},L.prototype.getInverse=function(t){var i,e=this.elements,n=t.elements,r=n[0],s=n[1],o=n[2],h=n[3],a=n[4],u=n[5],c=n[6],p=n[7],y=n[8],l=n[9],m=n[10],d=n[11],f=n[12],x=n[13],w=n[14],v=n[15],z=l*w*p-x*m*p+x*c*d-u*w*d-l*c*v+u*m*v,M=f*m*p-y*w*p-f*c*d+a*w*d+y*c*v-a*m*v,g=y*x*p-f*l*p+f*u*d-a*x*d-y*u*v+a*l*v,b=f*l*c-y*x*c-f*u*m+a*x*m+y*u*w-a*l*w,S=r*z+s*M+o*g+h*b;return 0!==S?(i=1/S,e[0]=z*i,e[1]=(x*m*h-l*w*h-x*o*d+s*w*d+l*o*v-s*m*v)*i,e[2]=(u*w*h-x*c*h+x*o*p-s*w*p-u*o*v+s*c*v)*i,e[3]=(l*c*h-u*m*h-l*o*p+s*m*p+u*o*d-s*c*d)*i,e[4]=M*i,e[5]=(y*w*h-f*m*h+f*o*d-r*w*d-y*o*v+r*m*v)*i,e[6]=(f*c*h-a*w*h-f*o*p+r*w*p+a*o*v-r*c*v)*i,e[7]=(a*m*h-y*c*h+y*o*p-r*m*p-a*o*d+r*c*d)*i,e[8]=g*i,e[9]=(f*l*h-y*x*h-f*s*d+r*x*d+y*s*v-r*l*v)*i,e[10]=(a*x*h-f*u*h+f*s*p-r*x*p-a*s*v+r*u*v)*i,e[11]=(y*u*h-a*l*h-y*s*p+r*l*p+a*s*d-r*u*d)*i,e[12]=b*i,e[13]=(y*x*o-f*l*o+f*s*m-r*x*m-y*s*w+r*l*w)*i,e[14]=(f*u*o-a*x*o-f*s*c+r*x*c+a*s*w-r*u*w)*i,e[15]=(a*l*o-y*u*o+y*s*c-r*l*c-a*s*m+r*u*m)*i):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this},L.prototype.transpose=function(){var t,i=this.elements;return t=i[1],i[1]=i[4],i[4]=t,t=i[2],i[2]=i[8],i[8]=t,t=i[6],i[6]=i[9],i[9]=t,t=i[3],i[3]=i[12],i[12]=t,t=i[7],i[7]=i[13],i[13]=t,t=i[11],i[11]=i[14],i[14]=t,this},L.prototype.scale=function(t,i,e){var n=this.elements;return n[0]*=t,n[4]*=i,n[8]*=e,n[1]*=t,n[5]*=i,n[9]*=e,n[2]*=t,n[6]*=i,n[10]*=e,n[3]*=t,n[7]*=i,n[11]*=e,this},L.prototype.makeScale=function(t,i,e){return this.set(t,0,0,0,0,i,0,0,0,0,e,0,0,0,0,1),this},L.prototype.makeTranslation=function(t,i,e){return this.set(1,0,0,t,0,1,0,i,0,0,1,e,0,0,0,1),this},L.prototype.makeRotationX=function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(1,0,0,0,0,i,-e,0,0,e,i,0,0,0,0,1),this},L.prototype.makeRotationY=function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,0,e,0,0,1,0,0,-e,0,i,0,0,0,0,1),this},L.prototype.makeRotationZ=function(t){var i=Math.cos(t),e=Math.sin(t);return this.set(i,-e,0,0,e,i,0,0,0,0,1,0,0,0,0,1),this},L.prototype.makeRotationAxis=function(t,i){var e=Math.cos(i),n=Math.sin(i),r=1-e,s=t.x,o=t.y,h=t.z,a=r*s,u=r*o;return this.set(a*s+e,a*o-n*h,a*h+n*o,0,a*o+n*h,u*o+e,u*h-n*s,0,a*h-n*o,u*h+n*s,r*h*h+e,0,0,0,0,1),this},L.prototype.makeShear=function(t,i,e){return this.set(1,i,e,0,t,1,e,0,t,i,1,0,0,0,0,1),this},L.prototype.compose=function(t,i,e){return this.makeRotationFromQuaternion(i),this.scale(e.x,e.y,e.z),this.setPosition(t),this},L.prototype.decompose=function(t,i,e){var n=this.elements,r=n[0],s=n[1],o=n[2],h=n[4],a=n[5],u=n[6],c=n[8],p=n[9],y=n[10],l=this.determinant(),m=R.set(r,s,o).length()*(l<0?-1:1),d=R.set(h,a,u).length(),f=R.set(c,p,y).length(),x=1/m,w=1/d,v=1/f;return t.x=n[12],t.y=n[13],t.z=n[14],n[0]*=x,n[1]*=x,n[2]*=x,n[4]*=w,n[5]*=w,n[6]*=w,n[8]*=v,n[9]*=v,n[10]*=v,i.setFromRotationMatrix(this),n[0]=r,n[1]=s,n[2]=o,n[4]=h,n[5]=a,n[6]=u,n[8]=c,n[9]=p,n[10]=y,e.x=m,e.y=d,e.z=f,this},L.prototype.makePerspective=function(t,i,e,n,r,s){var o=this.elements,h=2*r/(i-t),a=2*r/(e-n),u=(i+t)/(i-t),c=(e+n)/(e-n),p=-(s+r)/(s-r),y=-2*s*r/(s-r);return o[0]=h,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=a,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=p,o[14]=y,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},L.prototype.makeOrthographic=function(t,i,e,n,r,s){var o=this.elements,h=1/(i-t),a=1/(e-n),u=1/(s-r),c=(i+t)*h,p=(e+n)*a,y=(s+r)*u;return o[0]=2*h,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*a,o[9]=0,o[13]=-p,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-y,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},L.prototype.equals=function(t){var i,e=this.elements,n=t.elements,r=!0;for(i=0;r&&i<16;++i)e[i]!==n[i]&&(r=!1);return r};var I=new z,D=new z,Q=function(t,i){void 0===t&&(t=new z(1,0,0)),void 0===i&&(i=0),this.normal=t,this.constant=i};Q.prototype.set=function(t,i){return this.normal.copy(t),this.constant=i,this},Q.prototype.setComponents=function(t,i,e,n){return this.normal.set(t,i,e),this.constant=n,this},Q.prototype.copy=function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},Q.prototype.clone=function(){return(new this.constructor).copy(this)},Q.prototype.setFromNormalAndCoplanarPoint=function(t,i){return this.normal.copy(t),this.constant=-i.dot(this.normal),this},Q.prototype.setFromCoplanarPoints=function(t,i,e){var n=I.subVectors(e,i).cross(D.subVectors(t,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,I),this},Q.prototype.normalize=function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},Q.prototype.negate=function(){return this.normal.negate(),this.constant=-this.constant,this},Q.prototype.distanceToPoint=function(t){return this.normal.dot(t)+this.constant},Q.prototype.distanceToSphere=function(t){return this.distanceToPoint(t.center)-t.radius},Q.prototype.projectPoint=function(t,i){return i.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},Q.prototype.coplanarPoint=function(t){return t.copy(this.normal).multiplyScalar(-this.constant)},Q.prototype.translate=function(t){return this.constant-=t.dot(this.normal),this},Q.prototype.intersectLine=function(t,i){var e=t.delta(I),n=this.normal.dot(e);if(0===n)0===this.distanceToPoint(t.start)&&i.copy(t.start);else{var r=-(t.start.dot(this.normal)+this.constant)/n;r>=0&&r<=1&&i.copy(e).multiplyScalar(r).add(t.start)}return i},Q.prototype.intersectsLine=function(t){var i=this.distanceToPoint(t.start),e=this.distanceToPoint(t.end);return i<0&&e>0||e<0&&i>0},Q.prototype.intersectsBox=function(t){return t.intersectsPlane(this)},Q.prototype.intersectsSphere=function(t){return t.intersectsPlane(this)},Q.prototype.equals=function(t){return t.normal.equals(this.normal)&&t.constant===this.constant};var W=function(t,i,e){void 0===t&&(t=1),void 0===i&&(i=0),void 0===e&&(e=0),this.radius=t,this.phi=i,this.theta=e};W.prototype.set=function(t,i,e){return this.radius=t,this.phi=i,this.theta=e,this},W.prototype.copy=function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},W.prototype.clone=function(){return(new this.constructor).copy(this)},W.prototype.setFromVector3=function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Math.min(Math.max(t.y/this.radius,-1),1))),this.makeSafe()},W.prototype.makeSafe=function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this};var G=function(){this.elements=new Float32Array([1,0,0,1,0,1])};G.prototype.set=function(t,i,e,n,r,s){var o=this.elements;return o[0]=t,o[1]=i,o[3]=n,o[2]=e,o[4]=r,o[5]=s,this},G.prototype.identity=function(){return this.set(1,0,0,1,0,1),this},G.prototype.copy=function(t){var i=t.elements;return this.set(i[0],i[1],i[2],i[3],i[4],i[5]),this},G.prototype.clone=function(){return(new this.constructor).copy(this)},G.prototype.toMatrix3=function(t){var i=t.elements;t.set(i[0],i[1],i[2],i[1],i[3],i[4],i[2],i[4],i[5])},G.prototype.add=function(t){var i=this.elements,e=t.elements;return i[0]+=e[0],i[1]+=e[1],i[3]+=e[3],i[2]+=e[2],i[4]+=e[4],i[5]+=e[5],this},G.prototype.norm=function(){var t=this.elements,i=t[1]*t[1],e=t[2]*t[2],n=t[4]*t[4];return Math.sqrt(t[0]*t[0]+i+e+i+t[3]*t[3]+n+e+n+t[5]*t[5])},G.prototype.off=function(){var t=this.elements;return Math.sqrt(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))},G.prototype.applyToVector3=function(t){var i=t.x,e=t.y,n=t.z,r=this.elements;return t.x=r[0]*i+r[1]*e+r[2]*n,t.y=r[1]*i+r[3]*e+r[4]*n,t.z=r[2]*i+r[4]*e+r[5]*n,t},G.prototype.equals=function(t){var i,e=this.elements,n=t.elements,r=!0;for(i=0;r&&i<6;++i)e[i]!==n[i]&&(r=!1);return r},G.calculateIndex=function(t,i){return 3-(3-t)*(2-t)/2+i};var N=function(t,i,e,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=i,this.z=e,this.w=n};N.prototype.set=function(t,i,e,n){return this.x=t,this.y=i,this.z=e,this.w=n,this},N.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},N.prototype.clone=function(){return new this.constructor(this.x,this.y,this.z,this.w)},N.prototype.fromArray=function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this.w=t[i+3],this},N.prototype.toArray=function(t,i){return void 0===t&&(t=[]),void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w,t},N.prototype.setAxisAngleFromQuaternion=function(t){this.w=2*Math.acos(t.w);var i=Math.sqrt(1-t.w*t.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/i,this.y=t.y/i,this.z=t.z/i),this},N.prototype.setAxisAngleFromRotationMatrix=function(t){var i,e,n,r,s,o,h,a,u,c,p,y=.01,l=t.elements,m=l[0],d=l[4],f=l[8],x=l[1],w=l[5],v=l[9],z=l[2],M=l[6],g=l[10];return Math.abs(d-x)<y&&Math.abs(f-z)<y&&Math.abs(v-M)<y?Math.abs(d+x)<.1&&Math.abs(f+z)<.1&&Math.abs(v+M)<.1&&Math.abs(m+w+g-3)<.1?this.set(1,0,0,0):(i=Math.PI,h=(g+1)/2,a=(d+x)/4,u=(f+z)/4,c=(v+M)/4,(s=(m+1)/2)>(o=(w+1)/2)&&s>h?s<y?(e=0,n=.707106781,r=.707106781):(n=a/(e=Math.sqrt(s)),r=u/e):o>h?o<y?(e=.707106781,n=0,r=.707106781):(e=a/(n=Math.sqrt(o)),r=c/n):h<y?(e=.707106781,n=.707106781,r=0):(e=u/(r=Math.sqrt(h)),n=c/r),this.set(e,n,r,i)):(p=Math.sqrt((M-v)*(M-v)+(f-z)*(f-z)+(x-d)*(x-d)),Math.abs(p)<.001&&(p=1),this.x=(M-v)/p,this.y=(f-z)/p,this.z=(x-d)/p,this.w=Math.acos((m+w+g-1)/2)),this},N.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},N.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},N.prototype.addVectors=function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this.w=t.w+i.w,this},N.prototype.addScaledVector=function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this.w+=t.w*i,this},N.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},N.prototype.subScalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},N.prototype.subVectors=function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this.w=t.w-i.w,this},N.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},N.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},N.prototype.multiplyVectors=function(t,i){return this.x=t.x*i.x,this.y=t.y*i.y,this.z=t.z*i.z,this.w=t.w*i.w,this},N.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this},N.prototype.divideScalar=function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},N.prototype.applyMatrix4=function(t){var i=this.x,e=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*i+s[4]*e+s[8]*n+s[12]*r,this.y=s[1]*i+s[5]*e+s[9]*n+s[13]*r,this.z=s[2]*i+s[6]*e+s[10]*n+s[14]*r,this.w=s[3]*i+s[7]*e+s[11]*n+s[15]*r,this},N.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},N.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},N.prototype.lengthManhattan=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},N.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},N.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},N.prototype.distanceToManhattan=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)},N.prototype.distanceToSquared=function(t){var i=this.x-t.x,e=this.y-t.y,n=this.z-t.z,r=this.w-t.w;return i*i+e*e+n*n+r*r},N.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},N.prototype.normalize=function(){return this.divideScalar(this.length())},N.prototype.setLength=function(t){return this.normalize().multiplyScalar(t)},N.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},N.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},N.prototype.clamp=function(t,i){return this.x=Math.max(t.x,Math.min(i.x,this.x)),this.y=Math.max(t.y,Math.min(i.y,this.y)),this.z=Math.max(t.z,Math.min(i.z,this.z)),this.w=Math.max(t.w,Math.min(i.w,this.w)),this},N.prototype.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},N.prototype.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},N.prototype.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},N.prototype.lerp=function(t,i){return this.x+=(t.x-this.x)*i,this.y+=(t.y-this.y)*i,this.z+=(t.z-this.z)*i,this.w+=(t.w-this.w)*i,this},N.prototype.lerpVectors=function(t,i,e){return this.subVectors(i,t).multiplyScalar(e).add(t)},N.prototype.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w};var K=new z,J=function(t,i){void 0===t&&(t=new z),void 0===i&&(i=new z),this.min=t,this.max=i,this.children=null};J.prototype.getCenter=function(t){return void 0===t&&(t=new z),t.addVectors(this.min,this.max).multiplyScalar(.5)},J.prototype.getDimensions=function(t){return void 0===t&&(t=new z),t.subVectors(this.max,this.min)},J.prototype.split=function(){var t,i,e=this,n=this.min,r=this.max,s=this.getCenter(K),o=this.children=[null,null,null,null,null,null,null,null];for(t=0;t<8;++t)i=$[t],o[t]=new e.constructor(new z(0===i[0]?n.x:s.x,0===i[1]?n.y:s.y,0===i[2]?n.z:s.z),new z(0===i[0]?s.x:r.x,0===i[1]?s.y:r.y,0===i[2]?s.z:r.z))};var $=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],tt=new z,it=function(t,i){void 0===t&&(t=new z),void 0===i&&(i=0),this.min=t,this.size=i,this.children=null},et={max:{configurable:!0}};et.max.get=function(){return this.min.clone().addScalar(this.size)},it.prototype.getCenter=function(t){return void 0===t&&(t=new z),t.copy(this.min).addScalar(.5*this.size)},it.prototype.getDimensions=function(t){return void 0===t&&(t=new z),t.set(this.size,this.size,this.size)},it.prototype.split=function(){var t,i,e=this,n=this.min,r=this.getCenter(tt),s=.5*this.size,o=this.children=[null,null,null,null,null,null,null,null];for(t=0;t<8;++t)i=$[t],o[t]=new e.constructor(new z(0===i[0]?n.x:r.x,0===i[1]?n.y:r.y,0===i[2]?n.z:r.z),s)},Object.defineProperties(it.prototype,et);var nt=function(t,i){void 0===t&&(t=null),void 0===i&&(i=!1),this.value=t,this.done=i};nt.prototype.reset=function(){this.value=null,this.done=!1};var rt=new g,st=function(t,i){void 0===i&&(i=null),this.octree=t,this.region=i,this.cull=null!==i,this.result=new nt,this.trace=null,this.indices=null,this.reset()};st.prototype.reset=function(){var t=this.octree.root;return this.trace=[],this.indices=[],null!==t&&(rt.min=t.min,rt.max=t.max,this.cull&&!this.region.intersectsBox(rt)||(this.trace.push(t),this.indices.push(0))),this.result.reset(),this},st.prototype.next=function(){for(var t,i,e,n=this.cull,r=this.region,s=this.indices,o=this.trace,h=null,a=o.length-1;null===h&&a>=0;)if(t=s[a],i=o[a].children,++s[a],t<8)if(null!==i){if(e=i[t],n&&(rt.min=e.min,rt.max=e.max,!r.intersectsBox(rt)))continue;o.push(e),s.push(0),++a}else h=o.pop(),s.pop();else o.pop(),s.pop(),--a;return this.result.value=h,this.result.done=null===h,this.result},st.prototype.return=function(t){return this.result.value=t,this.result.done=!0,this.result},st.prototype[Symbol.iterator]=function(){return this};var ot=new Uint8Array([0,1,2,3,4,5,6,7,0]),ht=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],at=new z,ut=new z,ct=new z,pt=new z,yt=new z,lt=new z,mt=new z,dt=function(){};dt.intersectOctree=function(t,i,e){var n,r,s,h,a,u,c,p,y;t.getDimensions(at),ut.copy(at).multiplyScalar(.5),pt.copy(t.min).sub(t.min),yt.copy(t.max).sub(t.min),lt.copy(i.ray.direction),mt.copy(i.ray.origin),mt.sub(t.getCenter(ct)).add(ut),ot[8]=ot[0],lt.x<0&&(mt.x=at.x-mt.x,lt.x=-lt.x,ot[8]|=ot[4]),lt.y<0&&(mt.y=at.y-mt.y,lt.y=-lt.y,ot[8]|=ot[2]),lt.z<0&&(mt.z=at.z-mt.z,lt.z=-lt.z,ot[8]|=ot[1]),n=1/lt.x,r=1/lt.y,s=1/lt.z,h=(pt.x-mt.x)*n,a=(yt.x-mt.x)*n,u=(pt.y-mt.y)*r,c=(yt.y-mt.y)*r,p=(pt.z-mt.z)*s,y=(yt.z-mt.z)*s,Math.max(Math.max(h,u),p)<Math.min(Math.min(a,c),y)&&o(t.root,h,u,p,a,c,y,i,e)};var ft=new g,xt=function(t,i){this.root=void 0!==t&&void 0!==i?new J(t,i):null},wt={min:{configurable:!0},max:{configurable:!0},children:{configurable:!0}};wt.min.get=function(){return this.root.min},wt.max.get=function(){return this.root.max},wt.children.get=function(){return this.root.children},xt.prototype.getCenter=function(t){return this.root.getCenter(t)},xt.prototype.getDimensions=function(t){return this.root.getDimensions(t)},xt.prototype.getDepth=function(){return h(this.root)},xt.prototype.cull=function(t){var i=[];return a(this.root,t,i),i},xt.prototype.findOctantsByLevel=function(t){var i=[];return u(this.root,t,0,i),i},xt.prototype.raycast=function(t,i){return void 0===i&&(i=[]),dt.intersectOctree(this,t,i),i},xt.prototype.leaves=function(t){return new st(this,t)},xt.prototype[Symbol.iterator]=function(){return new st(this)},Object.defineProperties(xt.prototype,wt);var vt=new z,zt=function(t){function i(i,e){t.call(this,i,e),this.points=null,this.data=null}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.distanceToSquared=function(t){return vt.copy(t).clamp(this.min,this.max).sub(t).lengthSquared()},i.prototype.distanceToCenterSquared=function(t){var i=this.getCenter(vt),e=t.x-i.x,n=t.y-i.x,r=t.z-i.z;return e*e+n*n+r*r},i.prototype.contains=function(t,i){var e=this.min,n=this.max;return t.x>=e.x-i&&t.y>=e.y-i&&t.z>=e.z-i&&t.x<=n.x+i&&t.y<=n.y+i&&t.z<=n.z+i},i.prototype.redistribute=function(t){var i,e,n,r,s,o,h,a=this.children,u=this.points,c=this.data;if(null!==a)for(i=0,n=u.length;i<n;++i)for(o=u[i],h=c[i],e=0,r=a.length;e<r;++e)if((s=a[e]).contains(o,t)){null===s.points&&(s.points=[],s.data=[]),s.points.push(o),s.data.push(h);break}this.points=null,this.data=null},i.prototype.merge=function(){var t,i,e,n=this,r=this.children;if(null!==r){for(this.points=[],this.data=[],t=0,i=r.length;t<i;++t)null!==(e=r[t]).points&&((s=n.points).push.apply(s,e.points),(o=n.data).push.apply(o,e.data));this.children=null}var s,o},i}(J),Mt=function(t,i,e,n){void 0===n&&(n=null),this.distance=t,this.distanceToRay=i,this.point=e,this.object=n},gt=1e-6,bt=function(t){function i(i,e,n,r,s){void 0===n&&(n=0),void 0===r&&(r=8),void 0===s&&(s=8),t.call(this),this.root=new zt(i,e),this.bias=Math.max(0,n),this.maxPoints=Math.max(1,Math.round(r)),this.maxDepth=Math.max(0,Math.round(s)),this.pointCount=0}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.countPoints=function(t){return c(t)},i.prototype.put=function(t,i){return p(t,i,this,this.root,0)},i.prototype.remove=function(t){return y(t,this,this.root,null)},i.prototype.fetch=function(t){return l(t,this,this.root)},i.prototype.move=function(t,i){return m(t,i,this,this.root,null,0)},i.prototype.findNearestPoint=function(t,i,e){return void 0===i&&(i=1/0),void 0===e&&(e=!1),d(t,i,e,this.root)},i.prototype.findPoints=function(t,i,e){void 0===e&&(e=!1);var n=[];return f(t,i,e,this.root,n),n},i.prototype.raycast=function(i,e){void 0===e&&(e=[]);var n=t.prototype.raycast.call(this,i);return n.length>0&&this.testPoints(n,i,e),e},i.prototype.testPoints=function(t,i,e){var n,r,s,o,h,a,u,c,p,y,l,m=i.params.Points.threshold,d=m*m;for(h=0,u=t.length;h<u;++h)if(p=t[h],null!==(y=p.points))for(a=0,c=y.length;a<c;++a)l=y[a],(o=i.ray.distanceSqToPoint(l))<d&&(n=i.ray.closestPointToPoint(l),(r=i.ray.origin.distanceTo(n))>=i.near&&r<=i.far&&(s=Math.sqrt(o),e.push(new Mt(r,s,n,p.data[a]))))},i}(xt),St=function(i){this.renderer=i,this.loadingManager=new t.LoadingManager,this.assets=null,this.scene=new t.Scene,this.scene.fog=new t.FogExp2(855309,.0025),this.camera=new t.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.1,2e3),this.controls=null};St.prototype.load=function(t){t()},St.prototype.initialise=function(){},St.prototype.render=function(t){},St.prototype.configure=function(t){},St.prototype.reset=function(){var i=this.scene.fog;return this.scene=new t.Scene,this.scene.fog=i,null!==this.controls&&(this.controls.dispose(),this.controls=null),this};var At=new t.Vector2,Pt=function(i){function e(e,n,r){i.call(this),this.params.Points.threshold=.1,this.octree=e,this.camera=n,this.object=r,this.enabled=!0,this.delta="",this.selectedObject=null,this.selectedPoint=new t.Mesh(new t.SphereBufferGeometry(.2,16,16),new t.MeshBasicMaterial({transparent:!0,color:52479,opacity:.75})),this.selectedPoint.visible=!1}return i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e,e.prototype.handleEvent=function(t){switch(t.type){case"mousemove":this.raycast(t)}},e.prototype.raycast=function(t){var i,e,n,r;At.x=t.clientX/window.innerWidth*2-1,At.y=-t.clientY/window.innerHeight*2+1,this.setFromCamera(At,this.camera),this.enabled?(e=performance.now(),i=this.octree.raycast(this),n=performance.now()):(e=performance.now(),i=this.intersectObjects(this.object.children),n=performance.now()),this.delta=(n-e).toFixed(2)+" ms",null!==this.selectedObject&&(this.selectedObject.material.color.setHex(12582912),this.selectedObject=null,this.selectedPoint.visible=!1),i.length>0&&(void 0!==(r=i[0]).object?(this.selectedObject=r.object,this.selectedObject.material.color.setHex(13434624),this.selectedPoint.visible=r.object.parent.visible,this.selectedPoint.position.copy(r.point)):console.warn(i))},e.prototype.configure=function(t){var i=t.addFolder("Raycasting");i.add(this,"enabled"),i.add(this,"delta").listen(),i.open()},e}(t.Raycaster),qt=new t.Matrix4,Ct=new t.Frustum,Ft=function(i,e){this.octree=i,this.scene=e,this.enabled=!1,this.cullCamera=new t.PerspectiveCamera(20,1.77,.5,5),this.cullCamera.matrixAutoUpdate=!1,this.s=new t.Spherical(5,Math.PI/3,1.75*Math.PI),this.delta="",this.culledOctants=new t.Points(new t.BufferGeometry,new t.PointsMaterial({color:13434624,sizeAttenuation:!1,size:2})),this.culledOctants.visible=!1,this.cameraHelper=new t.CameraHelper(this.cullCamera),this.cameraHelper.visible=!1};Ft.prototype.updateCamera=function(){var t=this.cullCamera;t.position.setFromSpherical(this.s),t.lookAt(this.scene.position),t.updateMatrix(),t.updateMatrixWorld(),Ct.setFromMatrix(qt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse))},Ft.prototype.cull=function(){var i,e,n,r,s,o,h,a=this.culledOctants;if(this.enabled){if(this.updateCamera(),i=performance.now(),o=this.octree.cull(Ct),this.delta=(performance.now()-i).toFixed(2)+" ms",o.length>0){for(h=new Float32Array(3*o.length*2),e=0,n=0,r=o.length;e<r;++e)s=o[e],h[n++]=s.min.x,h[n++]=s.min.y,h[n++]=s.min.z,h[n++]=s.max.x,h[n++]=s.max.y,h[n++]=s.max.z;a.geometry.removeAttribute("position"),a.geometry.addAttribute("position",new t.BufferAttribute(h,3)),this.scene.remove(a),this.scene.add(a)}else this.scene.remove(a);this.cameraHelper.update()}},Ft.prototype.configure=function(t){var i=this,e=t.addFolder("Frustum Culling");e.add(this,"enabled").onChange(function(){i.cameraHelper.visible=i.culledOctants.visible=i.enabled,i.cull()}),e.add(this,"delta").listen(),e.open();var n=e.addFolder("Camera Adjustment");n.add(this.s,"radius").min(.1).max(10).step(.1).onChange(function(){i.cull()}),n.add(this.s,"phi").min(1e-6).max(Math.PI-1e-6).onChange(function(){i.cull()}),n.add(this.s,"theta").min(0).max(2*Math.PI).onChange(function(){i.cull()})};var kt=function(i){function e(t){i.call(this,t),this.points=null,this.octreeHelper=null,this.octreeRaycaster=null,this.frustumCuller=null}return i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e,e.prototype.initialise=function(){var i=this.scene,e=this.camera,n=this.renderer;i.fog=new t.FogExp2(855309,.025),this.controls=new t.OrbitControls(e,n.domElement),this.controls.maxDistance=60,e.near=.1,e.far=200,e.position.set(10,6,10),e.lookAt(this.controls.target);var r=function(){var i,e=new t.Object3D,n=8,r=6/(n-1),s=-3,o=new t.PointsMaterial({color:12582912,sizeAttenuation:!1,size:1});for(console.log("Generating",65536*n,"points...");n-- >0;)i=new t.Points(function(i,e,n,r){var s,o,h,a,u,c=new t.BufferGeometry,p=new Float32Array(3*i),y=e/2;for(a=0,u=p.length;a<u;a+=3)s=Math.random()*e-y,o=Math.random()*e-y,h=n+(Math.random()*r*2-r),p[a]=s,p[a+1]=o,p[a+2]=h;return c.addAttribute("position",new t.BufferAttribute(p,3)),c}(65536,6,s,.25),o),o=o.clone(),s+=r,e.add(i);return e}();this.points=r,i.add(r);var s=function(e){var n=new t.Vector3,r=new t.Box3;r.setFromObject(i);var s,o,h,a,u,c=performance.now(),p=new bt(r.min,r.max,0,8,5);for(s=e.children.length-1;s>=0;--s)for(h=0,a=(u=(o=e.children[s]).geometry.getAttribute("position").array).length;h<a;h+=3)p.put(n.fromArray(u,h),o);return console.log("Octree:",p,"created in",(performance.now()-c).toFixed(2)+" ms"),p}(r),o=function(t){var i=performance.now(),e=new x(t);return e.visible=!1,console.log("OctreeHelper:",e,"created in",(performance.now()-i).toFixed(2)+" ms"),e}(s);this.octreeHelper=o,i.add(o),this.raycaster=new Pt(s,e,r),n.domElement.parentNode.addEventListener("mousemove",this.raycaster),i.add(this.raycaster.selectedPoint),this.frustumCuller=new Ft(s,i),i.add(this.frustumCuller.cameraHelper)},e.prototype.render=function(t){this.renderer.render(this.scene,this.camera)},e.prototype.configure=function(t){var i=this.points,e=this.octreeHelper;this.raycaster.configure(t),this.frustumCuller.configure(t);var n={"level mask":e.children.length},r=t.addFolder("Points");r.add(i,"visible"),r.open(),(r=t.addFolder("Octree Helper")).add(e,"visible"),r.add(n,"level mask").min(0).max(e.children.length).step(1).onChange(function(){var t,i;for(t=0,i=e.children.length;t<i;++t)e.children[t].visible=n["level mask"]===e.children.length||t===n["level mask"]}),r.open()},e}(St),Tt=function(){this.clock=new t.Clock,this.renderer=new t.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(0),this.renderer.setPixelRatio(window.devicePixelRatio),this.stats=function(){var t=new e;return t.showPanel(0),t.dom.id="stats",t}(),this.demos=function(t){var i=new Map;return i.set("point-octree",new kt(t)),i}(this.renderer),this.key=function(t){var i=window.location.hash.slice(1);return 0!==i.length&&t.has(i)||(i=t.keys().next().value),i}(this.demos)};Tt.prototype.initialise=function(t,e,n){function r(){p.initialise(),p.camera.aspect=window.innerWidth/window.innerHeight,p.camera.updateProjectionMatrix(),(y=new i.GUI({autoPlace:!1})).add(o,"key",Array.from(c.keys())).onChange(s),p.configure(y),e.appendChild(y.domElement),n.style.display="none",h.domElement.style.visibility="visible"}function s(){var t=h.getSize();n.style.display="block",h.domElement.style.visibility="hidden",null!==y&&(y.destroy(),e.removeChild(y.domElement)),null!==p&&(p.reset(),h.setSize(t.width,t.height)),(p=c.get(o.key)).load(r),window.location.hash=o.key}var o=this,h=this.renderer,a=this.clock,u=this.stats,c=this.demos,p=null,y=null;t.appendChild(h.domElement),e.appendChild(u.dom),s(),document.addEventListener("keydown",function(t){t.altKey&&(t.preventDefault(),e.style.visibility="hidden"===e.style.visibility?"visible":"hidden")}),window.addEventListener("resize",function(){function t(t){var e=t.target.innerWidth,n=t.target.innerHeight;h.setSize(e,n),p.camera.aspect=e/n,p.camera.updateProjectionMatrix(),i=0}var i=0;return function(e){0===i&&(i=setTimeout(t,66,e))}}()),function t(i){var e=a.getDelta();requestAnimationFrame(t),u.begin(),p.render(e),u.end()}()},window.addEventListener("load",function t(i){var e=document.getElementById("viewport"),n=e.children[0],r=document.getElementById("aside"),s=new Tt;window.removeEventListener("load",t),r.style.visibility="visible",s.initialise(e,r,n)})}(THREE,dat,Stats);