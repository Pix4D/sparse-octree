!function(t,e,i){"use strict";function n(t,e,i){return Math.max(Math.min(t,i),e)}function s(t,e,i,n,s,r){var a=0;return t>e&&t>i?(s<t&&(a|=2),r<t&&(a|=1)):e>i?(n<e&&(a|=4),r<e&&(a|=1)):(n<i&&(a|=4),s<i&&(a|=2)),a}function r(t,e,i,n){var s=void 0,r=0;return e<i?(s=e,r=0):(s=i,r=1),n<s&&(r=2),tt[t][r]}function a(t,e,i,n,h,o,u,l,c){var y=t.children,v=void 0,d=void 0,m=void 0,f=void 0;if(h>=0&&o>=0&&u>=0)if(null===y)c.push(t);else{v=s(e,i,n,d=.5*(e+h),m=.5*(i+o),f=.5*(n+u));do{switch(v){case 0:a(y[$[8]],e,i,n,d,m,f,l,c),v=r(v,d,m,f);break;case 1:a(y[$[8]^$[1]],e,i,f,d,m,u,l,c),v=r(v,d,m,u);break;case 2:a(y[$[8]^$[2]],e,m,n,d,o,f,l,c),v=r(v,d,o,f);break;case 3:a(y[$[8]^$[3]],e,m,f,d,o,u,l,c),v=r(v,d,o,u);break;case 4:a(y[$[8]^$[4]],d,i,n,h,m,f,l,c),v=r(v,h,m,f);break;case 5:a(y[$[8]^$[5]],d,i,f,h,m,u,l,c),v=r(v,h,m,u);break;case 6:a(y[$[8]^$[6]],d,m,n,h,o,f,l,c),v=r(v,h,o,f);break;case 7:a(y[$[8]^$[7]],d,m,f,h,o,u,l,c),v=8}}while(v<8)}}function h(t){var e=t.children,i=0,n=void 0,s=void 0,r=void 0;if(null!==e)for(n=0,s=e.length;n<s;++n)(r=1+h(e[n]))>i&&(i=r);return i}function o(t,e,i){var n=t.children,s=void 0,r=void 0;if(ut.min=t.min,ut.max=t.max,e.intersectsBox(ut))if(null!==n)for(s=0,r=n.length;s<r;++s)o(n[s],e,i);else i.push(t)}function u(t,e,i,n){var s=t.children,r=void 0,a=void 0;if(i===e)n.push(t);else if(null!==s)for(++i,r=0,a=s.length;r<a;++r)u(s[r],e,i,n)}function l(t){var e=t.children,i=0,n=void 0,s=void 0;if(null!==e)for(n=0,s=e.length;n<s;++n)i+=l(e[n]);else null!==t.points&&(i=t.points.length);return i}function c(t,e,i,n,s){var r=n.children,a=!1,h=!1,o=void 0,u=void 0;if(n.contains(t,i.bias)){if(null===r){if(null===n.points)n.points=[],n.data=[];else for(o=0,u=n.points.length;!a&&o<u;++o)a=n.points[o].equals(t);a?(n.data[o-1]=e,h=!0):n.points.length<i.maxPoints||s===i.maxDepth?(n.points.push(t.clone()),n.data.push(e),++i.pointCount,h=!0):(n.split(),n.redistribute(i.bias),r=n.children)}if(null!==r)for(++s,o=0,u=r.length;!h&&o<u;++o)h=c(t,e,i,r[o],s)}return h}function y(t,e,i,n){var s=i.children,r=null,a=void 0,h=void 0,o=void 0,u=void 0,c=void 0;if(i.contains(t,e.bias))if(null!==s)for(a=0,h=s.length;null===r&&a<h;++a)r=y(t,e,s[a],i);else if(null!==i.points)for(o=i.points,u=i.data,a=0,h=o.length;a<h;++a)if(o[a].equals(t)){c=h-1,r=u[a],a<c&&(o[a]=o[c],u[a]=u[c]),o.pop(),u.pop(),--e.pointCount,null!==n&&l(n)<=e.maxPoints&&n.merge();break}return r}function v(t,e,i){var n=i.children,s=null,r=void 0,a=void 0,h=void 0;if(i.contains(t,e.bias))if(null!==n)for(r=0,a=n.length;null===s&&r<a;++r)s=v(t,e,n[r]);else for(r=0,a=(h=i.points).length;null===s&&r<a;++r)t.distanceToSquared(h[r])<=dt&&(s=i.data[r]);return s}function d(t,e,i,n,s,r){var a=n.children,h=null,o=void 0,u=void 0,l=void 0;if(n.contains(t,i.bias))if(n.contains(e,i.bias)){if(null!==a)for(++r,o=0,u=a.length;null===h&&o<u;++o)h=d(t,e,i,a[o],n,r);else for(o=0,u=(l=n.points).length;o<u;++o)if(t.distanceToSquared(l[o])<=dt){l[o].copy(e),h=n.data[o];break}}else c(e,h=y(t,i,n,s),i,s,r-1);return h}function m(t,e,i,n){var s=n.points,r=n.children,a=null,h=e,o=void 0,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0;if(null!==r)for(o=0,u=(y=r.map(function(e){return{octant:e,distance:e.distanceToCenterSquared(t)}}).sort(function(t,e){return t.distance-e.distance})).length;o<u;++o)(v=y[o].octant).contains(t,h)&&null!==(d=m(t,h,i,v))&&(c=d.point.distanceToSquared(t),(!i||c>0)&&c<h&&(h=c,a=d));else if(null!==s)for(o=0,u=s.length;o<u;++o)l=s[o],c=t.distanceToSquared(l),(!i||c>0)&&c<h&&(h=c,a={point:l.clone(),data:n.data[o]});return a}function f(t,e,i,n,s){var r=n.points,a=n.children,h=e*e,o=void 0,u=void 0,l=void 0,c=void 0,y=void 0;if(null!==a)for(o=0,u=a.length;o<u;++o)(y=a[o]).contains(t,e)&&f(t,e,i,y,s);else if(null!==r)for(o=0,u=r.length;o<u;++o)l=r[o],c=t.distanceToSquared(l),(!i||c>0)&&c<=h&&s.push({point:l.clone(),data:n.data[o]})}e=e&&e.hasOwnProperty("default")?e.default:e,i=i&&i.hasOwnProperty("default")?i.default:i;!function(){function t(t){this.value=t}function e(e){function i(s,r){try{var a=e[s](r),h=a.value;h instanceof t?Promise.resolve(h.value).then(function(t){i("next",t)},function(t){i("throw",t)}):n(a.done?"return":"normal",a.value)}catch(t){n("throw",t)}}function n(t,e){switch(t){case"return":s.resolve({value:e,done:!0});break;case"throw":s.reject(e);break;default:s.resolve({value:e,done:!1})}(s=s.next)?i(s.key,s.arg):r=null}var s,r;this._invoke=function(t,e){return new Promise(function(n,a){var h={key:t,arg:e,resolve:n,reject:a,next:null};r?r=r.next=h:(s=r=h,i(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}();var x=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},k=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),p=function t(e,i,n){null===e&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,i);if(void 0===s){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in s)return s.value;var a=s.get;if(void 0!==a)return a.call(n)},w=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},z=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},g=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)},M=function(e){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;x(this,i);var e=z(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.name="OctreeHelper",e.octree=t,e.update(),e}return w(i,e),k(i,[{key:"createLineSegments",value:function(e,i){var n=Math.pow(2,16)/8-1,s=new t.Object3D,r=new t.LineBasicMaterial({color:16777215*Math.random()}),a=void 0,h=void 0,o=void 0,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,m=void 0,f=void 0,x=void 0,k=void 0,p=void 0,w=void 0,z=void 0;for(m=0,o=0,p=Math.ceil(i/n);p>0;--p){for(o+=i<n?i:n,i-=n,h=8*o,u=new Uint16Array(3*h),l=new Float32Array(3*h),x=0,k=0,a=e.next();!a.done&&m<o;){for(y=(c=a.value).min,v=c.max,f=0;f<12;++f)z=S[f],u[k++]=x+z[0],u[k++]=x+z[1];for(f=0;f<8;++f,++x)w=b[f],l[3*x]=0===w[0]?y.x:v.x,l[3*x+1]=0===w[1]?y.y:v.y,l[3*x+2]=0===w[2]?y.z:v.z;++m<o&&(a=e.next())}(d=new t.BufferGeometry).setIndex(new t.BufferAttribute(u,1)),d.addAttribute("position",new t.BufferAttribute(l,3)),s.add(new t.LineSegments(d,r))}this.add(s)}},{key:"update",value:function(){var t=null!==this.octree?this.octree.getDepth():-1,e=0,i=void 0;for(this.dispose();e<=t;)i=this.octree.findOctantsByLevel(e),this.createLineSegments(i[Symbol.iterator](),"number"==typeof i.size?i.size:i.length),++e}},{key:"dispose",value:function(){var t=this.children,e=void 0,i=void 0,n=void 0,s=void 0,r=void 0,a=void 0;for(n=0,r=t.length;n<r;++n){for(s=0,a=(i=(e=t[n]).children).length;s<a;++s)i[s].geometry.dispose(),i[s].material.dispose();for(;i.length>0;)e.remove(i[0])}for(;t.length>0;)this.remove(t[0])}}]),i}(t.Object3D),b=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],S=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],P=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;x(this,t),this.x=e,this.y=i,this.z=n}return k(t,[{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}},{key:"setFromSpherical",value:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this}},{key:"setFromCylindrical",value:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this}},{key:"setFromMatrixColumn",value:function(t,e){return this.fromArray(t.elements,4*e)}},{key:"setFromMatrixPosition",value:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}},{key:"setFromMatrixScale",value:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this}},{key:"cross",value:function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this}},{key:"crossVectors",value:function(t,e){var i=t.x,n=t.y,s=t.z,r=e.x,a=e.y,h=e.z;return this.x=n*h-s*a,this.y=s*r-i*h,this.z=i*a-n*r,this}},{key:"applyMatrix3",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}},{key:"applyMatrix4",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12],this.y=s[1]*e+s[5]*i+s[9]*n+s[13],this.z=s[2]*e+s[6]*i+s[10]*n+s[14],this}},{key:"applyQuaternion",value:function(t){var e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,a=t.z,h=t.w,o=h*e+r*n-a*i,u=h*i+a*e-s*n,l=h*n+s*i-r*e,c=-s*e-r*i-a*n;return this.x=o*h+c*-s+u*-a-l*-r,this.y=u*h+c*-r+l*-s-o*-a,this.z=l*h+c*-a+o*-r-u*-s,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"reflect",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:new t;var i=e.x,n=e.y,s=e.z;return this.sub(e.multiplyScalar(2*this.dot(e))),e.set(i,n,s),this}},{key:"angleTo",value:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSquared()*t.lengthSquared());return Math.acos(Math.min(Math.max(e,-1),1))}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distanceToManhattan",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}},{key:"lerpVectors",value:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}}]),t}(),A=new P,q=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P(1/0,1/0,1/0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P(-1/0,-1/0,-1/0);x(this,t),this.min=e,this.max=i}return k(t,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new F;return this.getCenter(t.center),t.radius=.5*this.getSize(A).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var e=void 0,i=void 0;for(this.min.set(0,0,0),this.max.set(0,0,0),e=0,i=t.length;e<i;++e)this.expandByPoint(t[e]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var i=A.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}},{key:"clampPoint",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return A.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}},{key:"containsBox",value:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}},{key:"intersectsBox",value:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}},{key:"intersectsSphere",value:function(t){return this.clampPoint(t.center,A).distanceToSquared(t.center)<=t.radius*t.radius}},{key:"intersectsPlane",value:function(t){var e=void 0,i=void 0;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=t.constant&&i>=t.constant}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}]),t}(),C=new q,F=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;x(this,t),this.center=e,this.radius=i}return k(t,[{key:"set",value:function(t,e){return this.center.copy(t),this.radius=e,this}},{key:"copy",value:function(t){return this.center.copy(t.center),this.radius=t.radius,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromPoints",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:C.setFromPoints(t).getCenter(this.center);var e=this.center,i=0,n=void 0,s=void 0;for(n=0,s=t.length;n<s;++n)i=Math.max(i,e.distanceToSquared(t[n]));return this.radius=Math.sqrt(i),this}},{key:"getBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new q;return t.set(this.center,this.center),t.expandByScalar(this.radius),t}},{key:"isEmpty",value:function(){return this.radius<=0}},{key:"translate",value:function(t){return this.center.add(t),this}},{key:"clampPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P,i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}},{key:"distanceToPoint",value:function(t){return t.distanceTo(this.center)-this.radius}},{key:"containsPoint",value:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"intersectsSphere",value:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}},{key:"intersectsBox",value:function(t){return t.intersectsSphere(this)}},{key:"intersectsPlane",value:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}},{key:"equals",value:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}]),t}(),O=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;x(this,t),this.x=e,this.y=i}return k(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this}},{key:"applyMatrix3",value:function(t){var e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"distanceToManhattan",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"angle",value:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}},{key:"lerpVectors",value:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)}},{key:"rotateAround",value:function(t,e){var i=Math.cos(e),n=Math.sin(e),s=this.x-t.x,r=this.y-t.y;return this.x=s*i-r*n+t.x,this.y=s*n+r*i+t.y,this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"width",get:function(){return this.x},set:function(t){return this.x=t}},{key:"height",get:function(){return this.y},set:function(t){return this.y=t}}]),t}(),T=new O,V=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new O(1/0,1/0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O(-1/0,-1/0);x(this,t),this.min=e,this.max=i}k(t,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new O;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new O;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new F;return this.getCenter(t.center),t.radius=.5*this.getSize(T).length(),t}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"expandByVector",value:function(t){return this.min.sub(t),this.max.add(t),this}},{key:"expandByScalar",value:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this}},{key:"setFromPoints",value:function(t){var e=void 0,i=void 0;for(this.min.set(0,0),this.max.set(0,0),e=0,i=t.length;e<i;++e)this.expandByPoint(t[e]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var i=T.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}},{key:"clampPoint",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new O).copy(t).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return T.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"translate",value:function(t){return this.min.add(t),this.max.add(t),this}},{key:"intersect",value:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"containsPoint",value:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}},{key:"containsBox",value:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}},{key:"intersectsBox",value:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}},{key:"equals",value:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}])}(),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;x(this,t),this.radius=e,this.theta=i,this.y=n}k(t,[{key:"set",value:function(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=Math.sqrt(t.x*t.x+t.z*t.z),this.theta=Math.atan2(t.x,t.z),this.y=t.y,this}}])}(),function(){function t(){x(this,t),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}return k(t,[{key:"set",value:function(t,e,i,n,s,r,a,h,o){var u=this.elements;return u[0]=t,u[3]=e,u[6]=i,u[1]=n,u[4]=s,u[7]=r,u[2]=a,u[5]=h,u[8]=o,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(t){var e=t.elements,i=this.elements;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements,n=void 0;for(n=0;n<9;++n)i[n]=t[n+e];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements,n=void 0;for(n=0;n<9;++n)t[n+e]=i[n];return t}},{key:"multiplyMatrices",value:function(t,e){var i=t.elements,n=e.elements,s=this.elements,r=i[0],a=i[3],h=i[6],o=i[1],u=i[4],l=i[7],c=i[2],y=i[5],v=i[8],d=n[0],m=n[3],f=n[6],x=n[1],k=n[4],p=n[7],w=n[2],z=n[5],g=n[8];return s[0]=r*d+a*x+h*w,s[3]=r*m+a*k+h*z,s[6]=r*f+a*p+h*g,s[1]=o*d+u*x+l*w,s[4]=o*m+u*k+l*z,s[7]=o*f+u*p+l*g,s[2]=c*d+y*x+v*w,s[5]=c*m+y*k+v*z,s[8]=c*f+y*p+v*g,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],a=t[5],h=t[6],o=t[7],u=t[8];return e*r*u-e*a*o-i*s*u+i*a*h+n*s*o-n*r*h}},{key:"getInverse",value:function(t){var e=t.elements,i=this.elements,n=e[0],s=e[1],r=e[2],a=e[3],h=e[4],o=e[5],u=e[6],l=e[7],c=e[8],y=c*h-o*l,v=o*u-c*a,d=l*a-h*u,m=n*y+s*v+r*d,f=void 0;return 0!==m?(f=1/m,i[0]=y*f,i[1]=(r*l-c*s)*f,i[2]=(o*s-r*h)*f,i[3]=v*f,i[4]=(c*n-r*u)*f,i[5]=(r*a-o*n)*f,i[6]=d*f,i[7]=(s*u-l*n)*f,i[8]=(h*n-s*a)*f):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,e=void 0;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"scale",value:function(t,e){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}},{key:"rotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.elements,s=n[0],r=n[3],a=n[6],h=n[1],o=n[4],u=n[7];return n[0]=e*s+i*h,n[3]=e*r+i*o,n[6]=e*a+i*u,n[1]=-i*s+e*h,n[4]=-i*r+e*o,n[7]=-i*a+e*u,this}},{key:"translate",value:function(t,e){var i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}},{key:"equals",value:function(t){var e=this.elements,i=t.elements,n=!0,s=void 0;for(s=0;n&&s<9;++s)e[s]!==i[s]&&(n=!1);return n}}]),t}()),U={XYZ:"XYZ",YZX:"YZX",ZXY:"ZXY",XZY:"XZY",YXZ:"YXZ",ZYX:"ZYX"},B=new P,j=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;x(this,t),this.x=e,this.y=e,this.z=e,this.w=e}return k(t,[{key:"set",value:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}},{key:"setFromEuler",value:function(t){var e=t.x,i=t.y,n=t.z,s=Math.cos,r=Math.sin,a=s(e/2),h=s(i/2),o=s(n/2),u=r(e/2),l=r(i/2),c=r(n/2);switch(t.order){case U.XYZ:this.x=u*h*o+a*l*c,this.y=a*l*o-u*h*c,this.z=a*h*c+u*l*o,this.w=a*h*o-u*l*c;break;case U.YXZ:this.x=u*h*o+a*l*c,this.y=a*l*o-u*h*c,this.z=a*h*c-u*l*o,this.w=a*h*o+u*l*c;break;case U.ZXY:this.x=u*h*o-a*l*c,this.y=a*l*o+u*h*c,this.z=a*h*c+u*l*o,this.w=a*h*o-u*l*c;break;case U.ZYX:this.x=u*h*o-a*l*c,this.y=a*l*o+u*h*c,this.z=a*h*c-u*l*o,this.w=a*h*o+u*l*c;break;case U.YZX:this.x=u*h*o+a*l*c,this.y=a*l*o+u*h*c,this.z=a*h*c-u*l*o,this.w=a*h*o-u*l*c;break;case U.XZY:this.x=u*h*o-a*l*c,this.y=a*l*o-u*h*c,this.z=a*h*c+u*l*o,this.w=a*h*o+u*l*c}return this}},{key:"setFromAxisAngle",value:function(t,e){var i=e/2,n=Math.sin(i);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(i),this}},{key:"setFromRotationMatrix",value:function(t){var e=t.elements,i=e[0],n=e[4],s=e[8],r=e[1],a=e[5],h=e[9],o=e[2],u=e[6],l=e[10],c=i+a+l,y=void 0;return c>0?(y=.5/Math.sqrt(c+1),this.w=.25/y,this.x=(u-h)*y,this.y=(s-o)*y,this.z=(r-n)*y):i>a&&i>l?(y=2*Math.sqrt(1+i-a-l),this.w=(u-h)/y,this.x=.25*y,this.y=(n+r)/y,this.z=(s+o)/y):a>l?(y=2*Math.sqrt(1+a-i-l),this.w=(s-o)/y,this.x=(n+r)/y,this.y=.25*y,this.z=(h+u)/y):(y=2*Math.sqrt(1+l-i-a),this.w=(r-n)/y,this.x=(s+o)/y,this.y=(h+u)/y,this.z=.25*y),this}},{key:"setFromUnitVectors",value:function(t,e){var i=t.dot(e)+1;return i<1e-6?(i=0,Math.abs(t.x)>Math.abs(t.z)?B.set(-t.y,t.x,0):B.set(0,-t.z,t.y)):B.crossVectors(t,e),this.x=B.x,this.y=B.y,this.z=B.z,this.w=i,this.normalize()}},{key:"invert",value:function(){return this.conjugate().normalize()}},{key:"conjugate",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"normalize",value:function(){var t=this.length(),e=void 0;return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/t,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"multiplyQuaternions",value:function(t,e){var i=t.x,n=t.y,s=t.z,r=t.w,a=e.x,h=e.y,o=e.z,u=e.w;return this.x=i*u+r*a+n*o-s*h,this.y=n*u+r*h+s*a-i*o,this.z=s*u+r*o+i*h-n*a,this.w=r*u-i*a-n*h-s*o,this}},{key:"multiply",value:function(t){return this.multiplyQuaternions(this,t)}},{key:"premultiply",value:function(t){return this.multiplyQuaternions(t,this)}},{key:"slerp",value:function(t,e){var i=this.x,n=this.y,s=this.z,r=this.w,a=void 0,h=void 0,o=void 0,u=void 0,l=void 0;if(1===e)this.copy(t);else if(e>0){if((a=r*t.w+i*t.x+n*t.y+s*t.z)<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,a=-a):this.copy(t),a>=1)return this.w=r,this.x=i,this.y=n,this.z=s,this;if(h=Math.sqrt(1-a*a),Math.abs(h)<.001)return this.w=.5*(r+this.w),this.x=.5*(i+this.x),this.y=.5*(n+this.y),this.z=.5*(s+this.z),this;o=Math.atan2(h,a),u=Math.sin((1-e)*o)/h,l=Math.sin(e*o)/h,this.w=r*u+this.w*l,this.x=i*u+this.x*l,this.y=n*u+this.y*l,this.z=s*u+this.z*l}return this}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}],[{key:"slerp",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t,s=arguments[3];return n.copy(e).slerp(i,s)}},{key:"slerpFlat",value:function(t,e,i,n,s,r,a){var h=s[r],o=s[r+1],u=s[r+2],l=s[r+3],c=i[n],y=i[n+1],v=i[n+2],d=i[n+3],m=void 0,f=void 0,x=void 0,k=void 0,p=void 0,w=void 0,z=void 0,g=void 0;d===l&&c===h&&y===o&&v===u||(m=1-a,w=(k=c*h+y*o+v*u+d*l)>=0?1:-1,(p=1-k*k)>Number.EPSILON&&(x=Math.sqrt(p),z=Math.atan2(x,k*w),m=Math.sin(m*z)/x,a=Math.sin(a*z)/x),c=c*m+h*(g=a*w),y=y*m+o*g,v=v*m+u*g,d=d*m+l*g,m===1-a&&(c*=f=1/Math.sqrt(c*c+y*y+v*v+d*d),y*=f,v*=f,d*=f)),t[e]=c,t[e+1]=y,t[e+2]=v,t[e+3]=d}}]),t}(),E=new V,X=new j,Y=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;x(this,t),this.x=e,this.y=i,this.z=n,this.order=t.defaultOrder}k(t,[{key:"set",value:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.order=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.order)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.order=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.order,t}},{key:"toVector3",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P).set(this.x,this.y,this.z)}},{key:"setFromRotationMatrix",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order,i=t.elements,s=i[0],r=i[4],a=i[8],h=i[1],o=i[5],u=i[9],l=i[2],c=i[6],y=i[10];switch(e){case U.XYZ:this.y=Math.asin(n(a,-1,1)),Math.abs(a)<.99999?(this.x=Math.atan2(-u,y),this.z=Math.atan2(-r,s)):(this.x=Math.atan2(c,o),this.z=0);break;case U.YXZ:this.x=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this.y=Math.atan2(a,y),this.z=Math.atan2(h,o)):(this.y=Math.atan2(-l,s),this.z=0);break;case U.ZXY:this.x=Math.asin(n(c,-1,1)),Math.abs(c)<.99999?(this.y=Math.atan2(-l,y),this.z=Math.atan2(-r,o)):(this.y=0,this.z=Math.atan2(h,s));break;case U.ZYX:this.y=Math.asin(-n(l,-1,1)),Math.abs(l)<.99999?(this.x=Math.atan2(c,y),this.z=Math.atan2(h,s)):(this.x=0,this.z=Math.atan2(-r,o));break;case U.YZX:this.z=Math.asin(n(h,-1,1)),Math.abs(h)<.99999?(this.x=Math.atan2(-u,o),this.y=Math.atan2(-l,s)):(this.x=0,this.y=Math.atan2(a,y));break;case U.XZY:this.z=Math.asin(-n(r,-1,1)),Math.abs(r)<.99999?(this.x=Math.atan2(c,o),this.y=Math.atan2(a,s)):(this.x=Math.atan2(-u,y),this.y=0)}return this.order=e,this}},{key:"setFromQuaternion",value:function(t,e){return E.makeRotationFromQuaternion(t),this.setFromRotationMatrix(E,e)}},{key:"setFromVector3",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order;return this.set(t.x,t.y,t.z,e)}},{key:"reorder",value:function(t){return X.setFromEuler(this),this.setFromQuaternion(X,t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}],[{key:"defaultOrder",get:function(){return U.XYZ}}])}(),new P),Z=new P,_=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P;x(this,t),this.start=e,this.end=i}k(t,[{key:"set",value:function(t,e){return this.start.copy(t),this.end.copy(e),this}},{key:"copy",value:function(t){return this.start.copy(t.start),this.end.copy(t.end),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P).addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P).subVectors(this.end,this.start)}},{key:"lengthSquared",value:function(){return this.start.distanceToSquared(this.end)}},{key:"length",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}},{key:"closestPointToPointParameter",value:function(t,e){Y.subVectors(t,this.start),Z.subVectors(this.end,this.start);var i=Z.dot(Z),n=Z.dot(Y);return e?Math.min(Math.max(n/i,0),1):n/i}},{key:"closestPointToPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new P,n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}},{key:"equals",value:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}])}(),new P),R=new P,H=new P,L=(function(){function t(){x(this,t),this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}k(t,[{key:"set",value:function(t,e,i,n,s,r,a,h,o,u,l,c,y,v,d,m){var f=this.elements;return f[0]=t,f[4]=e,f[8]=i,f[12]=n,f[1]=s,f[5]=r,f[9]=a,f[13]=h,f[2]=o,f[6]=u,f[10]=l,f[14]=c,f[3]=y,f[7]=v,f[11]=d,f[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"copy",value:function(t){var e=t.elements,i=this.elements;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements,n=void 0;for(n=0;n<16;++n)i[n]=t[n+e];return this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements,n=void 0;for(n=0;n<16;++n)t[n+e]=i[n];return t}},{key:"getMaxScaleOnAxis",value:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}},{key:"copyPosition",value:function(t){var e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}},{key:"setPosition",value:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this}},{key:"extractBasis",value:function(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var e=this.elements,i=t.elements,n=1/_.setFromMatrixColumn(t,0).length(),s=1/_.setFromMatrixColumn(t,1).length(),r=1/_.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,this}},{key:"makeRotationFromEuler",value:function(t){var e=this.elements,i=t.x,n=t.y,s=t.z,r=Math.cos(i),a=Math.sin(i),h=Math.cos(n),o=Math.sin(n),u=Math.cos(s),l=Math.sin(s),c=void 0,y=void 0,v=void 0,d=void 0,m=void 0,f=void 0,x=void 0,k=void 0,p=void 0,w=void 0,z=void 0,g=void 0;switch(t.order){case U.XYZ:c=r*u,y=r*l,v=a*u,d=a*l,e[0]=h*u,e[4]=-h*l,e[8]=o,e[1]=y+v*o,e[5]=c-d*o,e[9]=-a*h,e[2]=d-c*o,e[6]=v+y*o,e[10]=r*h;break;case U.YXZ:m=h*u,f=h*l,x=o*u,k=o*l,e[0]=m+k*a,e[4]=x*a-f,e[8]=r*o,e[1]=r*l,e[5]=r*u,e[9]=-a,e[2]=f*a-x,e[6]=k+m*a,e[10]=r*h;break;case U.ZXY:m=h*u,f=h*l,x=o*u,k=o*l,e[0]=m-k*a,e[4]=-r*l,e[8]=x+f*a,e[1]=f+x*a,e[5]=r*u,e[9]=k-m*a,e[2]=-r*o,e[6]=a,e[10]=r*h;break;case U.ZYX:c=r*u,y=r*l,v=a*u,d=a*l,e[0]=h*u,e[4]=v*o-y,e[8]=c*o+d,e[1]=h*l,e[5]=d*o+c,e[9]=y*o-v,e[2]=-o,e[6]=a*h,e[10]=r*h;break;case U.YZX:p=r*h,w=r*o,z=a*h,g=a*o,e[0]=h*u,e[4]=g-p*l,e[8]=z*l+w,e[1]=l,e[5]=r*u,e[9]=-a*u,e[2]=-o*u,e[6]=w*l+z,e[10]=p-g*l;break;case U.XZY:p=r*h,w=r*o,z=a*h,g=a*o,e[0]=h*u,e[4]=-l,e[8]=o*u,e[1]=p*l+g,e[5]=r*u,e[9]=w*l-z,e[2]=z*l-w,e[6]=a*u,e[10]=g*l+p}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){var e=this.elements,i=t.x,n=t.y,s=t.z,r=t.w,a=i+i,h=n+n,o=s+s,u=i*a,l=i*h,c=i*o,y=n*h,v=n*o,d=s*o,m=r*a,f=r*h,x=r*o;return e[0]=1-(y+d),e[4]=l-x,e[8]=c+f,e[1]=l+x,e[5]=1-(u+d),e[9]=v-m,e[2]=c-f,e[6]=v+m,e[10]=1-(u+y),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}},{key:"lookAt",value:function(t,e,i){var n=this.elements,s=_,r=R,a=H;return a.subVectors(t,e),0===a.lengthSquared()&&(a.z=1),a.normalize(),s.crossVectors(i,a),0===s.lengthSquared()&&(1===Math.abs(i.z)?a.x+=1e-4:a.z+=1e-4,a.normalize(),s.crossVectors(i,a)),s.normalize(),r.crossVectors(a,s),n[0]=s.x,n[4]=r.x,n[8]=a.x,n[1]=s.y,n[5]=r.y,n[9]=a.y,n[2]=s.z,n[6]=r.z,n[10]=a.z,this}},{key:"multiplyMatrices",value:function(t,e){var i=this.elements,n=t.elements,s=e.elements,r=n[0],a=n[4],h=n[8],o=n[12],u=n[1],l=n[5],c=n[9],y=n[13],v=n[2],d=n[6],m=n[10],f=n[14],x=n[3],k=n[7],p=n[11],w=n[15],z=s[0],g=s[4],M=s[8],b=s[12],S=s[1],P=s[5],A=s[9],q=s[13],C=s[2],F=s[6],O=s[10],T=s[14],V=s[3],U=s[7],B=s[11],j=s[15];return i[0]=r*z+a*S+h*C+o*V,i[4]=r*g+a*P+h*F+o*U,i[8]=r*M+a*A+h*O+o*B,i[12]=r*b+a*q+h*T+o*j,i[1]=u*z+l*S+c*C+y*V,i[5]=u*g+l*P+c*F+y*U,i[9]=u*M+l*A+c*O+y*B,i[13]=u*b+l*q+c*T+y*j,i[2]=v*z+d*S+m*C+f*V,i[6]=v*g+d*P+m*F+f*U,i[10]=v*M+d*A+m*O+f*B,i[14]=v*b+d*q+m*T+f*j,i[3]=x*z+k*S+p*C+w*V,i[7]=x*g+k*P+p*F+w*U,i[11]=x*M+k*A+p*O+w*B,i[15]=x*b+k*q+p*T+w*j,this}},{key:"multiply",value:function(t){return this.multiplyMatrices(this,t)}},{key:"premultiply",value:function(t){return this.multiplyMatrices(t,this)}},{key:"multiplyScalar",value:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}},{key:"determinant",value:function(){var t=this.elements,e=t[0],i=t[4],n=t[8],s=t[12],r=t[1],a=t[5],h=t[9],o=t[13],u=t[2],l=t[6],c=t[10],y=t[14],v=e*a,d=e*h,m=e*o,f=i*r,x=i*h,k=i*o,p=n*r,w=n*a,z=n*o,g=s*r,M=s*a,b=s*h;return t[3]*(b*l-z*l-M*c+k*c+w*y-x*y)+t[7]*(d*y-m*c+g*c-p*y+z*u-b*u)+t[11]*(m*l-v*y-g*l+f*y+M*u-k*u)+t[15]*(-w*u-d*l+v*c+p*l-f*c+x*u)}},{key:"getInverse",value:function(t){var e=this.elements,i=t.elements,n=i[0],s=i[1],r=i[2],a=i[3],h=i[4],o=i[5],u=i[6],l=i[7],c=i[8],y=i[9],v=i[10],d=i[11],m=i[12],f=i[13],x=i[14],k=i[15],p=y*x*l-f*v*l+f*u*d-o*x*d-y*u*k+o*v*k,w=m*v*l-c*x*l-m*u*d+h*x*d+c*u*k-h*v*k,z=c*f*l-m*y*l+m*o*d-h*f*d-c*o*k+h*y*k,g=m*y*u-c*f*u-m*o*v+h*f*v+c*o*x-h*y*x,M=n*p+s*w+r*z+a*g,b=void 0;return 0!==M?(b=1/M,e[0]=p*b,e[1]=(f*v*a-y*x*a-f*r*d+s*x*d+y*r*k-s*v*k)*b,e[2]=(o*x*a-f*u*a+f*r*l-s*x*l-o*r*k+s*u*k)*b,e[3]=(y*u*a-o*v*a-y*r*l+s*v*l+o*r*d-s*u*d)*b,e[4]=w*b,e[5]=(c*x*a-m*v*a+m*r*d-n*x*d-c*r*k+n*v*k)*b,e[6]=(m*u*a-h*x*a-m*r*l+n*x*l+h*r*k-n*u*k)*b,e[7]=(h*v*a-c*u*a+c*r*l-n*v*l-h*r*d+n*u*d)*b,e[8]=z*b,e[9]=(m*y*a-c*f*a-m*s*d+n*f*d+c*s*k-n*y*k)*b,e[10]=(h*f*a-m*o*a+m*s*l-n*f*l-h*s*k+n*o*k)*b,e[11]=(c*o*a-h*y*a-c*s*l+n*y*l+h*s*d-n*o*d)*b,e[12]=g*b,e[13]=(c*f*r-m*y*r+m*s*v-n*f*v-c*s*x+n*y*x)*b,e[14]=(m*o*r-h*f*r-m*s*u+n*f*u+h*s*x-n*o*x)*b,e[15]=(h*y*r-c*o*r+c*s*u-n*y*u-h*s*v+n*o*v)*b):(console.error("Can't invert matrix, determinant is zero",t),this.identity()),this}},{key:"transpose",value:function(){var t=this.elements,e=void 0;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"scale",value:function(t,e,i){var n=this.elements;return n[0]*=t,n[4]*=e,n[8]*=i,n[1]*=t,n[5]*=e,n[9]*=i,n[2]*=t,n[6]*=e,n[10]*=i,n[3]*=t,n[7]*=e,n[11]*=i,this}},{key:"makeScale",value:function(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}},{key:"makeTranslation",value:function(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}},{key:"makeRotationX",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}},{key:"makeRotationY",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(t,e){var i=Math.cos(e),n=Math.sin(e),s=1-i,r=t.x,a=t.y,h=t.z,o=s*r,u=s*a;return this.set(o*r+i,o*a-n*h,o*h+n*a,0,o*a+n*h,u*a+i,u*h-n*r,0,o*h-n*a,u*h+n*r,s*h*h+i,0,0,0,0,1),this}},{key:"makeShear",value:function(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this}},{key:"compose",value:function(t,e,i){return this.makeRotationFromQuaternion(e),this.scale(i.x,i.y,i.z),this.setPosition(t),this}},{key:"decompose",value:function(t,e,i){var n=this.elements,s=n[0],r=n[1],a=n[2],h=n[4],o=n[5],u=n[6],l=n[8],c=n[9],y=n[10],v=this.determinant(),d=_.set(s,r,a).length()*(v<0?-1:1),m=_.set(h,o,u).length(),f=_.set(l,c,y).length(),x=1/d,k=1/m,p=1/f;return t.x=n[12],t.y=n[13],t.z=n[14],n[0]*=x,n[1]*=x,n[2]*=x,n[4]*=k,n[5]*=k,n[6]*=k,n[8]*=p,n[9]*=p,n[10]*=p,e.setFromRotationMatrix(this),n[0]=s,n[1]=r,n[2]=a,n[4]=h,n[5]=o,n[6]=u,n[8]=l,n[9]=c,n[10]=y,i.x=d,i.y=m,i.z=f,this}},{key:"makePerspective",value:function(t,e,i,n,s,r){var a=this.elements,h=2*s/(e-t),o=2*s/(i-n),u=(e+t)/(e-t),l=(i+n)/(i-n),c=-(r+s)/(r-s),y=-2*r*s/(r-s);return a[0]=h,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=o,a[9]=l,a[13]=0,a[2]=0,a[6]=0,a[10]=c,a[14]=y,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}},{key:"makeOrthographic",value:function(t,e,i,n,s,r){var a=this.elements,h=1/(e-t),o=1/(i-n),u=1/(r-s),l=(e+t)*h,c=(i+n)*o,y=(r+s)*u;return a[0]=2*h,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*o,a[9]=0,a[13]=-c,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-y,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}},{key:"equals",value:function(t){var e=this.elements,i=t.elements,n=!0,s=void 0;for(s=0;n&&s<16;++s)e[s]!==i[s]&&(n=!1);return n}}])}(),new P),D=new P,I=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P(1,0,0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;x(this,t),this.normal=e,this.constant=i}k(t,[{key:"set",value:function(t,e){return this.normal.copy(t),this.constant=e,this}},{key:"setComponents",value:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}},{key:"copy",value:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromNormalAndCoplanarPoint",value:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(t,e,i){var n=L.subVectors(i,e).cross(D.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,L),this}},{key:"normalize",value:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}},{key:"negate",value:function(){return this.normal.negate(),this.constant=-this.constant,this}},{key:"distanceToPoint",value:function(t){return this.normal.dot(t)+this.constant}},{key:"distanceToSphere",value:function(t){return this.distanceToPoint(t.center)-t.radius}},{key:"projectPoint",value:function(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}},{key:"coplanarPoint",value:function(t){return t.copy(this.normal).multiplyScalar(-this.constant)}},{key:"translate",value:function(t){return this.constant-=t.dot(this.normal),this}},{key:"intersectLine",value:function(t,e){var i=t.delta(L),n=this.normal.dot(i);if(0===n)0===this.distanceToPoint(t.start)&&e.copy(t.start);else{var s=-(t.start.dot(this.normal)+this.constant)/n;s>=0&&s<=1&&e.copy(i).multiplyScalar(s).add(t.start)}return e}},{key:"intersectsLine",value:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}},{key:"intersectsBox",value:function(t){return t.intersectsPlane(this)}},{key:"intersectsSphere",value:function(t){return t.intersectsPlane(this)}},{key:"equals",value:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}])}(),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;x(this,t),this.radius=e,this.phi=i,this.theta=n}k(t,[{key:"set",value:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}},{key:"copy",value:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"setFromVector3",value:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Math.min(Math.max(t.y/this.radius,-1),1))),this.makeSafe()}},{key:"makeSafe",value:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}}])}(),function(){function t(){x(this,t),this.elements=new Float32Array([1,0,0,1,0,1])}k(t,[{key:"set",value:function(t,e,i,n,s,r){var a=this.elements;return a[0]=t,a[1]=e,a[3]=n,a[2]=i,a[4]=s,a[5]=r,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(t){var e=t.elements;return this.set(e[0],e[1],e[2],e[3],e[4],e[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(t){var e=t.elements;t.set(e[0],e[1],e[2],e[1],e[3],e[4],e[2],e[4],e[5])}},{key:"add",value:function(t){var e=this.elements,i=t.elements;return e[0]+=i[0],e[1]+=i[1],e[3]+=i[3],e[2]+=i[2],e[4]+=i[4],e[5]+=i[5],this}},{key:"norm",value:function(){var t=this.elements,e=t[1]*t[1],i=t[2]*t[2],n=t[4]*t[4];return Math.sqrt(t[0]*t[0]+e+i+e+t[3]*t[3]+n+i+n+t[5]*t[5])}},{key:"off",value:function(){var t=this.elements;return Math.sqrt(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:"applyToVector3",value:function(t){var e=t.x,i=t.y,n=t.z,s=this.elements;return t.x=s[0]*e+s[1]*i+s[2]*n,t.y=s[1]*e+s[3]*i+s[4]*n,t.z=s[2]*e+s[4]*i+s[5]*n,t}},{key:"equals",value:function(t){var e=this.elements,i=t.elements,n=!0,s=void 0;for(s=0;n&&s<6;++s)e[s]!==i[s]&&(n=!1);return n}}],[{key:"calculateIndex",value:function(t,e){return 3-(3-t)*(2-t)/2+e}}])}(),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;x(this,t),this.x=e,this.y=i,this.z=n,this.w=s}k(t,[{key:"set",value:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}},{key:"setAxisAngleFromQuaternion",value:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}},{key:"setAxisAngleFromRotationMatrix",value:function(t){var e=.01,i=t.elements,n=i[0],s=i[4],r=i[8],a=i[1],h=i[5],o=i[9],u=i[2],l=i[6],c=i[10],y=void 0,v=void 0,d=void 0,m=void 0,f=void 0,x=void 0,k=void 0,p=void 0,w=void 0,z=void 0,g=void 0;return Math.abs(s-a)<e&&Math.abs(r-u)<e&&Math.abs(o-l)<e?Math.abs(s+a)<.1&&Math.abs(r+u)<.1&&Math.abs(o+l)<.1&&Math.abs(n+h+c-3)<.1?this.set(1,0,0,0):(y=Math.PI,k=(c+1)/2,p=(s+a)/4,w=(r+u)/4,z=(o+l)/4,(f=(n+1)/2)>(x=(h+1)/2)&&f>k?f<e?(v=0,d=.707106781,m=.707106781):(d=p/(v=Math.sqrt(f)),m=w/v):x>k?x<e?(v=.707106781,d=0,m=.707106781):(v=p/(d=Math.sqrt(x)),m=z/d):k<e?(v=.707106781,d=.707106781,m=0):(v=w/(m=Math.sqrt(k)),d=z/m),this.set(v,d,m,y)):(g=Math.sqrt((l-o)*(l-o)+(r-u)*(r-u)+(a-s)*(a-s)),Math.abs(g)<.001&&(g=1),this.x=(l-o)/g,this.y=(r-u)/g,this.z=(a-s)/g,this.w=Math.acos((n+h+c-1)/2)),this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}},{key:"multiplyScalar",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this.w=t.w*e.w,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}},{key:"divideScalar",value:function(t){return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this}},{key:"applyMatrix4",value:function(t){var e=this.x,i=this.y,n=this.z,s=this.w,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12]*s,this.y=r[1]*e+r[5]*i+r[9]*n+r[13]*s,this.z=r[2]*e+r[6]*i+r[10]*n+r[14]*s,this.w=r[3]*e+r[7]*i+r[11]*n+r[15]*s,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}},{key:"lengthManhattan",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"distanceToManhattan",value:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)+Math.abs(this.w-t.w)}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z,s=this.w-t.w;return e*e+i*i+n*n+s*s}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"setLength",value:function(t){return this.normalize().multiplyScalar(t)}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"lerp",value:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}},{key:"lerpVectors",value:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}}])}(),new P),Q=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new P;x(this,t),this.min=e,this.max=i,this.children=null}return k(t,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P).addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P).subVectors(this.max,this.min)}},{key:"split",value:function(){var t=this.min,e=this.max,i=this.getCenter(I),n=this.children=[null,null,null,null,null,null,null,null],s=void 0,r=void 0;for(s=0;s<8;++s)r=W[s],n[s]=new this.constructor(new P(0===r[0]?t.x:i.x,0===r[1]?t.y:i.y,0===r[2]?t.z:i.z),new P(0===r[0]?i.x:e.x,0===r[1]?i.y:e.y,0===r[2]?i.z:e.z))}}]),t}(),W=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],G=new P,N=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;x(this,t),this.min=e,this.size=i,this.children=null}k(t,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P).copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new P).set(this.size,this.size,this.size)}},{key:"split",value:function(){var t=this.min,e=this.getCenter(G),i=.5*this.size,n=this.children=[null,null,null,null,null,null,null,null],s=void 0,r=void 0;for(s=0;s<8;++s)r=W[s],n[s]=new this.constructor(new P(0===r[0]?t.x:e.x,0===r[1]?t.y:e.y,0===r[2]?t.z:e.z),i)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}])}(),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];x(this,t),this.value=e,this.done=i}return k(t,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),t}()),K=new q,J=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;x(this,t),this.octree=e,this.region=i,this.cull=null!==i,this.result=new N,this.trace=null,this.indices=null,this.reset()}return k(t,[{key:"reset",value:function(){var t=this.octree.root;return this.trace=[],this.indices=[],null!==t&&(K.min=t.min,K.max=t.max,this.cull&&!this.region.intersectsBox(K)||(this.trace.push(t),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var t=this.cull,e=this.region,i=this.indices,n=this.trace,s=null,r=n.length-1,a=void 0,h=void 0,o=void 0;null===s&&r>=0;)if(a=i[r],h=n[r].children,++i[r],a<8)if(null!==h){if(o=h[a],t&&(K.min=o.min,K.max=o.max,!e.intersectsBox(K)))continue;n.push(o),i.push(0),++r}else s=n.pop(),i.pop();else n.pop(),i.pop(),--r;return this.result.value=s,this.result.done=null===s,this.result}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),$=new Uint8Array([0,1,2,3,4,5,6,7,0]),tt=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],et=new P,it=new P,nt=new P,st=new P,rt=new P,at=new P,ht=new P,ot=function(){function t(){x(this,t)}return k(t,null,[{key:"intersectOctree",value:function(t,e,i){var n=void 0,s=void 0,r=void 0,h=void 0,o=void 0,u=void 0,l=void 0,c=void 0,y=void 0;t.getDimensions(et),it.copy(et).multiplyScalar(.5),st.copy(t.min).sub(t.min),rt.copy(t.max).sub(t.min),at.copy(e.ray.direction),ht.copy(e.ray.origin),ht.sub(t.getCenter(nt)).add(it),$[8]=$[0],at.x<0&&(ht.x=et.x-ht.x,at.x=-at.x,$[8]|=$[4]),at.y<0&&(ht.y=et.y-ht.y,at.y=-at.y,$[8]|=$[2]),at.z<0&&(ht.z=et.z-ht.z,at.z=-at.z,$[8]|=$[1]),n=1/at.x,s=1/at.y,r=1/at.z,h=(st.x-ht.x)*n,o=(rt.x-ht.x)*n,u=(st.y-ht.y)*s,l=(rt.y-ht.y)*s,c=(st.z-ht.z)*r,y=(rt.z-ht.z)*r,Math.max(Math.max(h,u),c)<Math.min(Math.min(o,l),y)&&a(t.root,h,u,c,o,l,y,e,i)}}]),t}(),ut=new q,lt=function(){function t(e,i){x(this,t),this.root=void 0!==e&&void 0!==i?new Q(e,i):null}return k(t,[{key:"getCenter",value:function(t){return this.root.getCenter(t)}},{key:"getDimensions",value:function(t){return this.root.getDimensions(t)}},{key:"getDepth",value:function(){return h(this.root)}},{key:"cull",value:function(t){var e=[];return o(this.root,t,e),e}},{key:"findOctantsByLevel",value:function(t){var e=[];return u(this.root,t,0,e),e}},{key:"raycast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return ot.intersectOctree(this,t,e),e}},{key:"leaves",value:function(t){return new J(this,t)}},{key:Symbol.iterator,value:function(){return new J(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),t}(),ct=new P,yt=function(t){function e(t,i){x(this,e);var n=z(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return n.points=null,n.data=null,n}return w(e,Q),k(e,[{key:"distanceToSquared",value:function(t){return ct.copy(t).clamp(this.min,this.max).sub(t).lengthSquared()}},{key:"distanceToCenterSquared",value:function(t){var e=this.getCenter(ct),i=t.x-e.x,n=t.y-e.x,s=t.z-e.z;return i*i+n*n+s*s}},{key:"contains",value:function(t,e){var i=this.min,n=this.max;return t.x>=i.x-e&&t.y>=i.y-e&&t.z>=i.z-e&&t.x<=n.x+e&&t.y<=n.y+e&&t.z<=n.z+e}},{key:"redistribute",value:function(t){var e=this.children,i=this.points,n=this.data,s=void 0,r=void 0,a=void 0,h=void 0,o=void 0,u=void 0,l=void 0;if(null!==e)for(s=0,a=i.length;s<a;++s)for(u=i[s],l=n[s],r=0,h=e.length;r<h;++r)if((o=e[r]).contains(u,t)){null===o.points&&(o.points=[],o.data=[]),o.points.push(u),o.data.push(l);break}this.points=null,this.data=null}},{key:"merge",value:function(){var t=this.children,e=void 0,i=void 0,n=void 0;if(null!==t){for(this.points=[],this.data=[],e=0,i=t.length;e<i;++e)if(null!==(n=t[e]).points){var s,r;(s=this.points).push.apply(s,g(n.points)),(r=this.data).push.apply(r,g(n.data))}this.children=null}}}]),e}(),vt=function t(e,i,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;x(this,t),this.distance=e,this.distanceToRay=i,this.point=n,this.object=s},dt=1e-6,mt=function(t){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;x(this,e);var a=z(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a.root=new yt(t,i),a.bias=Math.max(0,n),a.maxPoints=Math.max(1,Math.round(s)),a.maxDepth=Math.max(0,Math.round(r)),a.pointCount=0,a}return w(e,lt),k(e,[{key:"countPoints",value:function(t){return l(t)}},{key:"put",value:function(t,e){return c(t,e,this,this.root,0)}},{key:"remove",value:function(t){return y(t,this,this.root,null)}},{key:"fetch",value:function(t){return v(t,this,this.root)}},{key:"move",value:function(t,e){return d(t,e,this,this.root,null,0)}},{key:"findNearestPoint",value:function(t){return m(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root)}},{key:"findPoints",value:function(t,e){var i=[];return f(t,e,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root,i),i}},{key:"raycast",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=p(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"raycast",this).call(this,t);return n.length>0&&this.testPoints(n,t,i),i}},{key:"testPoints",value:function(t,e,i){var n=e.params.Points.threshold,s=n*n,r=void 0,a=void 0,h=void 0,o=void 0,u=void 0,l=void 0,c=void 0,y=void 0,v=void 0,d=void 0,m=void 0;for(u=0,c=t.length;u<c;++u)if(v=t[u],null!==(d=v.points))for(l=0,y=d.length;l<y;++l)m=d[l],(o=e.ray.distanceSqToPoint(m))<s&&(r=e.ray.closestPointToPoint(m),(a=e.ray.origin.distanceTo(r))>=e.near&&a<=e.far&&(h=Math.sqrt(o),i.push(new vt(a,h,r,v.data[l]))))}}]),e}(),ft=(function(){function t(){x(this,t)}k(t,null,[{key:"recycleOctants",value:function(t,e){var i=new P,n=new P,s=new P,r=t.min,a=t.getCenter(),h=t.getDimensions().multiplyScalar(.5),o=t.children,u=e.length,l=void 0,c=void 0,y=void 0,v=void 0;for(l=0;l<8;++l)for(y=W[l],n.addVectors(r,i.fromArray(y).multiply(h)),s.addVectors(a,i.fromArray(y).multiply(h)),c=0;c<u;++c)if(null!==(v=e[c])&&n.equals(v.min)&&s.equals(v.max)){o[l]=v,e[c]=null;break}}}])}(),function(){function e(i){x(this,e),this.renderer=i,this.loadingManager=new t.LoadingManager,this.assets=null,this.scene=new t.Scene,this.scene.fog=new t.FogExp2(855309,.0025),this.camera=new t.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.1,2e3),this.controls=null}return k(e,[{key:"load",value:function(t){t()}},{key:"initialise",value:function(){}},{key:"render",value:function(t){}},{key:"configure",value:function(t){}},{key:"reset",value:function(){var e=this.scene.fog;return this.scene=new t.Scene,this.scene.fog=e,null!==this.controls&&(this.controls.dispose(),this.controls=null),this}}]),e}()),xt=new t.Vector2,kt=function(e){function i(e,n,s){x(this,i);var r=z(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return r.params.Points.threshold=.1,r.octree=e,r.camera=n,r.object=s,r.enabled=!0,r.delta="",r.selectedObject=null,r.selectedPoint=new t.Mesh(new t.SphereBufferGeometry(.2,16,16),new t.MeshBasicMaterial({transparent:!0,color:52479,opacity:.75})),r.selectedPoint.visible=!1,r}return w(i,e),k(i,[{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.raycast(t)}}},{key:"raycast",value:function(t){var e=void 0,i=void 0,n=void 0,s=void 0;xt.x=t.clientX/window.innerWidth*2-1,xt.y=-t.clientY/window.innerHeight*2+1,this.setFromCamera(xt,this.camera),this.enabled?(i=performance.now(),e=this.octree.raycast(this),n=performance.now()):(i=performance.now(),e=this.intersectObjects(this.object.children),n=performance.now()),this.delta=(n-i).toFixed(2)+" ms",null!==this.selectedObject&&(this.selectedObject.material.color.setHex(12582912),this.selectedObject=null,this.selectedPoint.visible=!1),e.length>0&&(void 0!==(s=e[0]).object?(this.selectedObject=s.object,this.selectedObject.material.color.setHex(13434624),this.selectedPoint.visible=s.object.parent.visible,this.selectedPoint.position.copy(s.point)):console.warn(e))}},{key:"configure",value:function(t){var e=t.addFolder("Raycasting");e.add(this,"enabled"),e.add(this,"delta").listen(),e.open()}}]),i}(t.Raycaster),pt=new t.Matrix4,wt=new t.Frustum,zt=function(){function e(i,n){x(this,e),this.octree=i,this.scene=n,this.enabled=!1,this.cullCamera=new t.PerspectiveCamera(20,1.77,.5,5),this.cullCamera.matrixAutoUpdate=!1,this.s=new t.Spherical(5,Math.PI/3,1.75*Math.PI),this.delta="",this.culledOctants=new t.Points(new t.BufferGeometry,new t.PointsMaterial({color:13434624,sizeAttenuation:!1,size:2})),this.culledOctants.visible=!1,this.cameraHelper=new t.CameraHelper(this.cullCamera),this.cameraHelper.visible=!1}return k(e,[{key:"updateCamera",value:function(){var t=this.cullCamera;t.position.setFromSpherical(this.s),t.lookAt(this.scene.position),t.updateMatrix(),t.updateMatrixWorld(),wt.setFromMatrix(pt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse))}},{key:"cull",value:function(){var e=this.culledOctants,i=void 0,n=void 0,s=void 0,r=void 0,a=void 0,h=void 0,o=void 0;if(this.enabled){if(this.updateCamera(),i=performance.now(),h=this.octree.cull(wt),this.delta=(performance.now()-i).toFixed(2)+" ms",h.length>0){for(o=new Float32Array(3*h.length*2),n=0,s=0,r=h.length;n<r;++n)a=h[n],o[s++]=a.min.x,o[s++]=a.min.y,o[s++]=a.min.z,o[s++]=a.max.x,o[s++]=a.max.y,o[s++]=a.max.z;e.geometry.removeAttribute("position"),e.geometry.addAttribute("position",new t.BufferAttribute(o,3)),this.scene.remove(e),this.scene.add(e)}else this.scene.remove(e);this.cameraHelper.update()}}},{key:"configure",value:function(t){var e=this,i=t.addFolder("Frustum Culling");i.add(this,"enabled").onChange(function(){e.cameraHelper.visible=e.culledOctants.visible=e.enabled,e.cull()}),i.add(this,"delta").listen(),i.open();var n=i.addFolder("Camera Adjustment");n.add(this.s,"radius").min(.1).max(10).step(.1).onChange(function(){e.cull()}),n.add(this.s,"phi").min(1e-6).max(Math.PI-1e-6).onChange(function(){e.cull()}),n.add(this.s,"theta").min(0).max(2*Math.PI).onChange(function(){e.cull()})}}]),e}(),gt=function(e){function i(t){x(this,i);var e=z(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.points=null,e.octreeHelper=null,e.octreeRaycaster=null,e.frustumCuller=null,e}return w(i,ft),k(i,[{key:"initialise",value:function(){var e=this.scene,i=this.camera,n=this.renderer;e.fog=new t.FogExp2(855309,.025),this.controls=new t.OrbitControls(i,n.domElement),this.controls.maxDistance=60,i.near=.1,i.far=200,i.position.set(10,6,10),i.lookAt(this.controls.target);var s=function(){var e=new t.Object3D,i=8,n=6/(i-1),s=-3,r=void 0,a=new t.PointsMaterial({color:12582912,sizeAttenuation:!1,size:1});for(console.log("Generating",65536*i,"points...");i-- >0;)r=new t.Points(function(e,i,n,s){var r=new t.BufferGeometry,a=new Float32Array(3*e),h=i/2,o=void 0,u=void 0,l=void 0,c=void 0,y=void 0;for(c=0,y=a.length;c<y;c+=3)o=Math.random()*i-h,u=Math.random()*i-h,l=n+(Math.random()*s*2-s),a[c]=o,a[c+1]=u,a[c+2]=l;return r.addAttribute("position",new t.BufferAttribute(a,3)),r}(65536,6,s,.25),a),a=a.clone(),s+=n,e.add(r);return e}();this.points=s,e.add(s);var r=function(i){var n=new t.Vector3,s=new t.Box3;s.setFromObject(e);var r=performance.now(),a=void 0,h=void 0,o=void 0,u=void 0,l=void 0,c=new mt(s.min,s.max,0,8,5);for(a=i.children.length-1;a>=0;--a)for(o=0,u=(l=(h=i.children[a]).geometry.getAttribute("position").array).length;o<u;o+=3)c.put(n.fromArray(l,o),h);return console.log("Octree:",c,"created in",(performance.now()-r).toFixed(2)+" ms"),c}(s),a=function(t){var e=performance.now(),i=new M(t);return i.visible=!1,console.log("OctreeHelper:",i,"created in",(performance.now()-e).toFixed(2)+" ms"),i}(r);this.octreeHelper=a,e.add(a),this.raycaster=new kt(r,i,s),n.domElement.parentNode.addEventListener("mousemove",this.raycaster),e.add(this.raycaster.selectedPoint),this.frustumCuller=new zt(r,e),e.add(this.frustumCuller.cameraHelper)}},{key:"render",value:function(t){this.renderer.render(this.scene,this.camera)}},{key:"configure",value:function(t){var e=this.points,i=this.octreeHelper;this.raycaster.configure(t),this.frustumCuller.configure(t);var n={"level mask":i.children.length},s=t.addFolder("Points");s.add(e,"visible"),s.open(),(s=t.addFolder("Octree Helper")).add(i,"visible"),s.add(n,"level mask").min(0).max(i.children.length).step(1).onChange(function(){var t=void 0,e=void 0;for(t=0,e=i.children.length;t<e;++t)i.children[t].visible=n["level mask"]===i.children.length||t===n["level mask"]}),s.open()}}]),i}(),Mt=function(){function n(){x(this,n),this.clock=new t.Clock,this.renderer=new t.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(0),this.renderer.setPixelRatio(window.devicePixelRatio),this.stats=function(){var t=new i;return t.showPanel(0),t.dom.id="stats",t}(),this.demos=function(t){var e=new Map;return e.set("point-octree",new gt(t)),e}(this.renderer),this.key=function(t){var e=window.location.hash.slice(1);return 0!==e.length&&t.has(e)||(e=t.keys().next().value),e}(this.demos)}return k(n,[{key:"initialise",value:function(t,i,n){function s(){c.initialise(),c.camera.aspect=window.innerWidth/window.innerHeight,c.camera.updateProjectionMatrix(),(y=new e.GUI({autoPlace:!1})).add(a,"key",Array.from(l.keys())).onChange(r),c.configure(y),i.appendChild(y.domElement),n.style.display="none",h.domElement.style.visibility="visible"}function r(){var t=h.getSize();n.style.display="block",h.domElement.style.visibility="hidden",null!==y&&(y.destroy(),i.removeChild(y.domElement)),null!==c&&(c.reset(),h.setSize(t.width,t.height)),(c=l.get(a.key)).load(s),window.location.hash=a.key}var a=this,h=this.renderer,o=this.clock,u=this.stats,l=this.demos,c=null,y=null;t.appendChild(h.domElement),i.appendChild(u.dom),r(),document.addEventListener("keydown",function(t){t.altKey&&(t.preventDefault(),i.style.visibility="hidden"===i.style.visibility?"visible":"hidden")}),window.addEventListener("resize",function(){function t(t){var i=t.target.innerWidth,n=t.target.innerHeight;h.setSize(i,n),c.camera.aspect=i/n,c.camera.updateProjectionMatrix(),e=0}var e=0;return function(i){0===e&&(e=setTimeout(t,66,i))}}()),function t(e){var i=o.getDelta();requestAnimationFrame(t),u.begin(),c.render(i),u.end()}()}}]),n}();window.addEventListener("load",function t(e){var i=document.getElementById("viewport"),n=i.children[0],s=document.getElementById("aside"),r=new Mt;window.removeEventListener("load",t),s.style.visibility="visible",r.initialise(i,s,n)})}(THREE,dat,Stats);