!function(t,e,i){"use strict";function n(t,e,i,n,r,o){var s=0;return t>e&&t>i?(r<t&&(s|=2),o<t&&(s|=1)):e>i?(n<e&&(s|=4),o<e&&(s|=1)):(n<i&&(s|=4),r<i&&(s|=2)),s}function r(t,e,i,n){var r=void 0,o=0;return e<i?(r=e,o=0):(r=i,o=1),n<r&&(o=2),T[t][o]}function o(t,e,i,s,a,l,u,h,c){var d=t.children,y=void 0,v=void 0,f=void 0,m=void 0;if(a>=0&&l>=0&&u>=0)if(null===d)c.push(t);else{y=n(e,i,s,v=.5*(e+a),f=.5*(i+l),m=.5*(s+u));do{switch(y){case 0:o(d[_[8]],e,i,s,v,f,m,h,c),y=r(y,v,f,m);break;case 1:o(d[_[8]^_[1]],e,i,m,v,f,u,h,c),y=r(y,v,f,u);break;case 2:o(d[_[8]^_[2]],e,f,s,v,l,m,h,c),y=r(y,v,l,m);break;case 3:o(d[_[8]^_[3]],e,f,m,v,l,u,h,c),y=r(y,v,l,u);break;case 4:o(d[_[8]^_[4]],v,i,s,a,f,m,h,c),y=r(y,a,f,m);break;case 5:o(d[_[8]^_[5]],v,i,m,a,f,u,h,c),y=r(y,a,f,u);break;case 6:o(d[_[8]^_[6]],v,f,s,a,l,m,h,c),y=r(y,a,l,m);break;case 7:o(d[_[8]^_[7]],v,f,m,a,l,u,h,c),y=8}}while(y<8)}}function s(t){var e=t.children,i=0,n=void 0,r=void 0,o=void 0;if(null!==e)for(n=0,r=e.length;n<r;++n)(o=1+s(e[n]))>i&&(i=o);return i}function a(t,e,i){var n=t.children,r=void 0,o=void 0;if(W.min=t.min,W.max=t.max,e.intersectsBox(W))if(null!==n)for(r=0,o=n.length;r<o;++r)a(n[r],e,i);else i.push(t)}function l(t,e,i,n){var r=t.children,o=void 0,s=void 0;if(i===e)n.push(t);else if(null!==r)for(++i,o=0,s=r.length;o<s;++o)l(r[o],e,i,n)}function u(t){var e=t.children,i=0,n=void 0,r=void 0;if(null!==e)for(n=0,r=e.length;n<r;++n)i+=u(e[n]);else null!==t.points&&(i=t.points.length);return i}function h(t,e,i,n,r){var o=n.children,s=!1,a=!1,l=void 0,u=void 0;if(n.contains(t,i.bias)){if(null===o){if(null===n.points)n.points=[],n.data=[];else for(l=0,u=n.points.length;!s&&l<u;++l)s=n.points[l].equals(t);s?(n.data[l-1]=e,a=!0):n.points.length<i.maxPoints||r===i.maxDepth?(n.points.push(t.clone()),n.data.push(e),++i.pointCount,a=!0):(n.split(),n.redistribute(i.bias),o=n.children)}if(null!==o)for(++r,l=0,u=o.length;!a&&l<u;++l)a=h(t,e,i,o[l],r)}return a}function c(t,e,i,n){var r=i.children,o=null,s=void 0,a=void 0,l=void 0,h=void 0,d=void 0;if(i.contains(t,e.bias))if(null!==r)for(s=0,a=r.length;null===o&&s<a;++s)o=c(t,e,r[s],i);else if(null!==i.points)for(l=i.points,h=i.data,s=0,a=l.length;s<a;++s)if(l[s].equals(t)){d=a-1,o=h[s],s<d&&(l[s]=l[d],h[s]=h[d]),l.pop(),h.pop(),--e.pointCount,null!==n&&u(n)<=e.maxPoints&&n.merge();break}return o}function d(t,e,i){var n=i.children,r=null,o=void 0,s=void 0,a=void 0;if(i.contains(t,e.bias))if(null!==n)for(o=0,s=n.length;null===r&&o<s;++o)r=d(t,e,n[o]);else for(o=0,s=(a=i.points).length;null===r&&o<s;++o)t.distanceToSquared(a[o])<=Y&&(r=i.data[o]);return r}function y(t,e,i,n,r,o){var s=n.children,a=null,l=void 0,u=void 0,d=void 0;if(n.contains(t,i.bias))if(n.contains(e,i.bias)){if(null!==s)for(++o,l=0,u=s.length;null===a&&l<u;++l)a=y(t,e,i,s[l],n,o);else for(l=0,u=(d=n.points).length;l<u;++l)if(t.distanceToSquared(d[l])<=Y){d[l].copy(e),a=n.data[l];break}}else h(e,a=c(t,i,n,r),i,r,o-1);return a}function v(t,e,i,n){var r=n.points,o=n.children,s=null,a=e,l=void 0,u=void 0,h=void 0,c=void 0,d=void 0,y=void 0,f=void 0;if(null!==o)for(l=0,u=(d=o.map(function(e){return{octant:e,distance:e.distanceToCenterSquared(t)}}).sort(function(t,e){return t.distance-e.distance})).length;l<u;++l)(y=d[l].octant).contains(t,a)&&null!==(f=v(t,a,i,y))&&(c=f.point.distanceToSquared(t),(!i||c>0)&&c<a&&(a=c,s=f));else if(null!==r)for(l=0,u=r.length;l<u;++l)h=r[l],c=t.distanceToSquared(h),(!i||c>0)&&c<a&&(a=c,s={point:h.clone(),data:n.data[l]});return s}function f(t,e,i,n,r){var o=n.points,s=n.children,a=e*e,l=void 0,u=void 0,h=void 0,c=void 0,d=void 0;if(null!==s)for(l=0,u=s.length;l<u;++l)(d=s[l]).contains(t,e)&&f(t,e,i,d,r);else if(null!==o)for(l=0,u=o.length;l<u;++l)h=o[l],c=t.distanceToSquared(h),(!i||c>0)&&c<=a&&r.push({point:h.clone(),data:n.data[l]})}e=e&&e.hasOwnProperty("default")?e.default:e,i=i&&i.hasOwnProperty("default")?i.default:i;var m=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},p=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),x=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in r)return r.value;var s=r.get;if(void 0!==s)return s.call(n)},w=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},g=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},k=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)},b=function(e){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;m(this,i);var e=g(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.name="OctreeHelper",e.octree=t,e.update(),e}return w(i,e),p(i,[{key:"createLineSegments",value:function(e){var i=Math.pow(2,16)/8-1,n=new t.Object3D,r=new t.LineBasicMaterial({color:16777215*Math.random()}),o=e.length,s=void 0,a=void 0,l=void 0,u=void 0,h=void 0,c=void 0,d=void 0,y=void 0,v=void 0,f=void 0,m=void 0,p=void 0,x=void 0,w=void 0,g=void 0;for(v=0,a=0,x=Math.ceil(o/i);x>0;--x){for(a+=o<i?o:i,o-=i,s=8*a,l=new Uint16Array(3*s),u=new Float32Array(3*s),m=0,p=0;v<a;++v){for(c=(h=e[v]).min,d=h.max,f=0;f<12;++f)g=A[f],l[p++]=m+g[0],l[p++]=m+g[1];for(f=0;f<8;++f,++m)w=z[f],u[3*m]=0===w[0]?c.x:d.x,u[3*m+1]=0===w[1]?c.y:d.y,u[3*m+2]=0===w[2]?c.z:d.z}(y=new t.BufferGeometry).setIndex(new t.BufferAttribute(l,1)),y.addAttribute("position",new t.BufferAttribute(u,3)),n.add(new t.LineSegments(y,r))}this.add(n)}},{key:"update",value:function(){var t=null!==this.octree?this.octree.getDepth():-1,e=0;for(this.dispose();e<=t;)this.createLineSegments(this.octree.findOctantsByLevel(e)),++e}},{key:"dispose",value:function(){var t=this.children,e=void 0,i=void 0,n=void 0,r=void 0,o=void 0,s=void 0;for(n=0,o=t.length;n<o;++n){for(r=0,s=(i=(e=t[n]).children).length;r<s;++r)i[r].geometry.dispose(),i[r].material.dispose();for(;i.length>0;)e.remove(i[0])}for(;t.length>0;)this.remove(t[0])}}]),i}(t.Object3D),z=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],A=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],M=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;m(this,t),this.x=e,this.y=i}p(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return isFinite(t)?(this.x*=t,this.y*=t):(this.x=0,this.y=0),this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"divideVectors",value:function(t,e){return this.x=t.x/e.x,this.y=t.y/e.y,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}}])}(),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;m(this,t),this.x=e,this.y=i,this.z=n}return p(t,[{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"divideVectors",value:function(t,e){return this.x=t.x/e.x,this.y=t.y/e.y,this.z=t.z/e.z,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}},{key:"applyMatrix3",value:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}},{key:"applyMatrix4",value:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12],this.y=r[1]*e+r[5]*i+r[9]*n+r[13],this.z=r[2]*e+r[6]*i+r[10]*n+r[14],this}}]),t}()),S=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M(1/0,1/0,1/0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new M(-1/0,-1/0,-1/0);m(this,t),this.min=e,this.max=i}return p(t,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"setFromPoints",value:function(t){var e=void 0,i=void 0;for(e=0,i=t.length;e<i;++e)this.expandByPoint(t[e]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var i=e.clone().multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}},{key:"intersectsBox",value:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}}]),t}(),P=(function(){function t(){m(this,t),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}p(t,[{key:"set",value:function(t,e,i,n,r,o,s,a,l){var u=this.elements;return u[0]=t,u[3]=e,u[6]=i,u[1]=n,u[4]=r,u[7]=o,u[2]=s,u[5]=a,u[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(t){var e=t.elements;return this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])}(),function(){function t(){m(this,t),this.elements=new Float32Array([1,0,0,1,0,1])}p(t,[{key:"set",value:function(t,e,i,n,r,o){var s=this.elements;return s[0]=t,s[1]=e,s[3]=n,s[2]=i,s[4]=r,s[5]=o,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(t){var e=t.elements;return this.set(e[0],e[1],e[2],e[3],e[4],e[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(t){var e=t.elements;t.set(e[0],e[1],e[2],e[1],e[3],e[4],e[2],e[4],e[5])}},{key:"add",value:function(t){var e=this.elements,i=t.elements;return e[0]+=i[0],e[1]+=i[1],e[3]+=i[3],e[2]+=i[2],e[4]+=i[4],e[5]+=i[5],this}},{key:"norm",value:function(){var t=this.elements,e=t[1]*t[1],i=t[2]*t[2],n=t[4]*t[4];return Math.sqrt(t[0]*t[0]+e+i+e+t[3]*t[3]+n+i+n+t[5]*t[5])}},{key:"off",value:function(){var t=this.elements;return Math.sqrt(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:"applyToVector3",value:function(t){var e=t.x,i=t.y,n=t.z,r=this.elements;return t.x=r[0]*e+r[1]*i+r[2]*n,t.y=r[1]*e+r[3]*i+r[4]*n,t.z=r[2]*e+r[4]*i+r[5]*n,t}}],[{key:"calculateIndex",value:function(t,e){return 3-(3-t)*(2-t)/2+e}}])}(),new M),O=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new M;m(this,t),this.min=e,this.max=i,this.children=null}return p(t,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M).copy(this.min).add(this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M).copy(this.max).sub(this.min)}},{key:"split",value:function(){var t=this.min,e=this.max,i=this.getCenter(P),n=this.children=[null,null,null,null,null,null,null,null],r=void 0,o=void 0;for(r=0;r<8;++r)o=C[r],n[r]=new this.constructor(new M(0===o[0]?t.x:i.x,0===o[1]?t.y:i.y,0===o[2]?t.z:i.z),new M(0===o[0]?i.x:e.x,0===o[1]?i.y:e.y,0===o[2]?i.z:e.z))}}]),t}(),C=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],U=new M,j=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;m(this,t),this.min=e,this.size=i,this.children=null}p(t,[{key:"getCenter",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M).copy(this.min).addScalar(.5*this.size)}},{key:"getDimensions",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M).set(this.size,this.size,this.size)}},{key:"split",value:function(){var t=this.min,e=this.getCenter(U),i=.5*this.size,n=this.children=[null,null,null,null,null,null,null,null],r=void 0,o=void 0;for(r=0;r<8;++r)o=C[r],n[r]=new this.constructor(new M(0===o[0]?t.x:e.x,0===o[1]?t.y:e.y,0===o[2]?t.z:e.z),i)}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}])}(),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];m(this,t),this.value=e,this.done=i}return p(t,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),t}()),q=new S,F=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;m(this,t),this.octree=e,this.region=i,this.cull=null!==i,this.result=new j,this.trace=null,this.indices=null,this.reset()}return p(t,[{key:"reset",value:function(){var t=this.octree.root;return this.trace=[],this.indices=[],null!==t&&(q.min=t.min,q.max=t.max,this.cull&&!this.region.intersectsBox(q)||(this.trace.push(t),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var t=this.cull,e=this.region,i=this.indices,n=this.trace,r=null,o=n.length-1,s=void 0,a=void 0,l=void 0;null===r&&o>=0;)if(s=i[o],a=n[o].children,++i[o],s<8)if(null!==a){if(l=a[s],t&&(q.min=l.min,q.max=l.max,!e.intersectsBox(q)))continue;n.push(l),i.push(0),++o}else r=n.pop(),i.pop();else n.pop(),i.pop(),--o;return this.result.value=r,this.result.done=null===r,this.result}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),_=new Uint8Array([0,1,2,3,4,5,6,7,0]),T=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],B=new M,E=new M,H=new M,D=new M,V=new M,L=new M,I=new M,R=function(){function t(){m(this,t)}return p(t,null,[{key:"intersectOctree",value:function(t,e,i){var n=void 0,r=void 0,s=void 0,a=void 0,l=void 0,u=void 0,h=void 0,c=void 0,d=void 0;t.getDimensions(B),E.copy(B).multiplyScalar(.5),D.copy(t.min).sub(t.min),V.copy(t.max).sub(t.min),L.copy(e.ray.direction),I.copy(e.ray.origin),I.sub(t.getCenter(H)).add(E),_[8]=_[0],L.x<0&&(I.x=B.x-I.x,L.x=-L.x,_[8]|=_[4]),L.y<0&&(I.y=B.y-I.y,L.y=-L.y,_[8]|=_[2]),L.z<0&&(I.z=B.z-I.z,L.z=-L.z,_[8]|=_[1]),n=1/L.x,r=1/L.y,s=1/L.z,a=(D.x-I.x)*n,l=(V.x-I.x)*n,u=(D.y-I.y)*r,h=(V.y-I.y)*r,c=(D.z-I.z)*s,d=(V.z-I.z)*s,Math.max(Math.max(a,u),c)<Math.min(Math.min(l,h),d)&&o(t.root,a,u,c,l,h,d,e,i)}}]),t}(),W=new S,G=function(){function t(e,i){m(this,t),this.root=void 0!==e&&void 0!==i?new O(e,i):null}return p(t,[{key:"getCenter",value:function(t){return this.root.getCenter(t)}},{key:"getDimensions",value:function(t){return this.root.getDimensions(t)}},{key:"getDepth",value:function(){return s(this.root)}},{key:"cull",value:function(t){var e=[];return a(this.root,t,e),e}},{key:"findOctantsByLevel",value:function(t){var e=[];return l(this.root,t,0,e),e}},{key:"raycast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return R.intersectOctree(this,t,e),e}},{key:"leaves",value:function(t){return new F(this,t)}},{key:Symbol.iterator,value:function(){return new F(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),t}(),N=new M,K=function(t){function e(t,i){m(this,e);var n=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return n.points=null,n.data=null,n}return w(e,O),p(e,[{key:"distanceToSquared",value:function(t){return N.copy(t).clamp(this.min,this.max).sub(N).lengthSq()}},{key:"distanceToCenterSquared",value:function(t){var e=this.getCenter(N),i=t.x-e.x,n=t.y-e.x,r=t.z-e.z;return i*i+n*n+r*r}},{key:"contains",value:function(t,e){var i=this.min,n=this.max;return t.x>=i.x-e&&t.y>=i.y-e&&t.z>=i.z-e&&t.x<=n.x+e&&t.y<=n.y+e&&t.z<=n.z+e}},{key:"redistribute",value:function(t){var e=this.children,i=this.points,n=this.data,r=void 0,o=void 0,s=void 0,a=void 0,l=void 0,u=void 0,h=void 0;if(null!==e)for(r=0,s=i.length;r<s;++r)for(u=i[r],h=n[r],o=0,a=e.length;o<a;++o)if((l=e[o]).contains(u,t)){null===l.points&&(l.points=[],l.data=[]),l.points.push(u),l.data.push(h);break}this.points=null,this.data=null}},{key:"merge",value:function(){var t=this.children,e=void 0,i=void 0,n=void 0;if(null!==t){for(this.points=[],this.data=[],e=0,i=t.length;e<i;++e)if(null!==(n=t[e]).points){var r,o;(r=this.points).push.apply(r,k(n.points)),(o=this.data).push.apply(o,k(n.data))}this.children=null}}}]),e}(),X=function t(e,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;m(this,t),this.distance=e,this.distanceToRay=i,this.point=n,this.object=r},Y=1e-6,J=function(t){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;m(this,e);var s=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s.root=new K(t,i),s.bias=Math.max(0,n),s.maxPoints=Math.max(1,Math.round(r)),s.maxDepth=Math.max(0,Math.round(o)),s.pointCount=0,s}return w(e,G),p(e,[{key:"countPoints",value:function(t){return u(t)}},{key:"put",value:function(t,e){return h(t,e,this,this.root,0)}},{key:"remove",value:function(t){return c(t,this,this.root,null)}},{key:"fetch",value:function(t){return d(t,this,this.root)}},{key:"move",value:function(t,e){return y(t,e,this,this.root,null,0)}},{key:"findNearestPoint",value:function(t){return v(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root)}},{key:"findPoints",value:function(t,e){var i=[];return f(t,e,arguments.length>2&&void 0!==arguments[2]&&arguments[2],this.root,i),i}},{key:"raycast",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=x(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"raycast",this).call(this,t);return n.length>0&&this.testPoints(n,t,i),i}},{key:"testPoints",value:function(t,e,i){var n=e.params.Points.threshold,r=n*n,o=void 0,s=void 0,a=void 0,l=void 0,u=void 0,h=void 0,c=void 0,d=void 0,y=void 0,v=void 0,f=void 0;for(u=0,c=t.length;u<c;++u)if(y=t[u],null!==(v=y.points))for(h=0,d=v.length;h<d;++h)f=v[h],(l=e.ray.distanceSqToPoint(f))<r&&(o=e.ray.closestPointToPoint(f),(s=e.ray.origin.distanceTo(o))>=e.near&&s<=e.far&&(a=Math.sqrt(l),i.push(new X(s,a,o,y.data[h]))))}}]),e}(),Q=(function(){function t(){m(this,t)}p(t,null,[{key:"recycleOctants",value:function(t,e){var i=new M,n=new M,r=new M,o=t.min,s=t.getCenter(),a=t.getDimensions().multiplyScalar(.5),l=t.children,u=e.length,h=void 0,c=void 0,d=void 0,y=void 0;for(h=0;h<8;++h)for(d=C[h],n.addVectors(o,i.fromArray(d).multiply(a)),r.addVectors(s,i.fromArray(d).multiply(a)),c=0;c<u;++c)if(null!==(y=e[c])&&n.equals(y.min)&&r.equals(y.max)){l[h]=y,e[c]=null;break}}}])}(),function(){function e(i){m(this,e),this.renderer=i,this.loadingManager=new t.LoadingManager,this.assets=null,this.scene=new t.Scene,this.scene.fog=new t.FogExp2(855309,.0025),this.camera=new t.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.1,2e3),this.controls=null}return p(e,[{key:"load",value:function(t){t()}},{key:"initialise",value:function(){}},{key:"render",value:function(t){}},{key:"configure",value:function(t){}},{key:"reset",value:function(){var e=this.scene.fog;return this.scene=new t.Scene,this.scene.fog=e,null!==this.controls&&(this.controls.dispose(),this.controls=null),this}}]),e}()),Z=new t.Vector2,$=function(e){function i(e,n,r){m(this,i);var o=g(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return o.params.Points.threshold=.1,o.octree=e,o.camera=n,o.object=r,o.enabled=!0,o.delta="",o.selectedObject=null,o.selectedPoint=new t.Mesh(new t.SphereBufferGeometry(.2,16,16),new t.MeshBasicMaterial({transparent:!0,color:52479,opacity:.75})),o.selectedPoint.visible=!1,o}return w(i,e),p(i,[{key:"handleEvent",value:function(t){switch(t.type){case"mousemove":this.raycast(t)}}},{key:"raycast",value:function(t){var e=void 0,i=void 0,n=void 0,r=void 0;Z.x=t.clientX/window.innerWidth*2-1,Z.y=-t.clientY/window.innerHeight*2+1,this.setFromCamera(Z,this.camera),this.enabled?(i=performance.now(),e=this.octree.raycast(this),n=performance.now()):(i=performance.now(),e=this.intersectObjects(this.object.children),n=performance.now()),this.delta=(n-i).toFixed(2)+" ms",null!==this.selectedObject&&(this.selectedObject.material.color.setHex(12582912),this.selectedObject=null,this.selectedPoint.visible=!1),e.length>0&&(void 0!==(r=e[0]).object?(this.selectedObject=r.object,this.selectedObject.material.color.setHex(13434624),this.selectedPoint.visible=!0,this.selectedPoint.position.copy(r.point)):console.warn(e))}},{key:"configure",value:function(t){var e=t.addFolder("Raycasting");e.add(this,"enabled"),e.add(this,"delta").listen(),e.open()}}]),i}(t.Raycaster),tt=new t.Matrix4,et=new t.Frustum,it=function(){function e(i,n){m(this,e),this.octree=i,this.scene=n,this.enabled=!1,this.cullCamera=new t.PerspectiveCamera(20,1.77,.5,5),this.cullCamera.matrixAutoUpdate=!1,this.s=new t.Spherical(5,Math.PI/3,1.75*Math.PI),this.delta="",this.culledOctants=new t.Points(new t.BufferGeometry,new t.PointsMaterial({color:13434624,sizeAttenuation:!1,size:2})),this.culledOctants.visible=!1,this.cameraHelper=new t.CameraHelper(this.cullCamera),this.cameraHelper.visible=!1}return p(e,[{key:"updateCamera",value:function(){var t=this.cullCamera;t.position.setFromSpherical(this.s),t.lookAt(this.scene.position),t.updateMatrix(),t.updateMatrixWorld(),et.setFromMatrix(tt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse))}},{key:"cull",value:function(){var e=this.culledOctants,i=void 0,n=void 0,r=void 0,o=void 0,s=void 0,a=void 0,l=void 0;if(this.enabled){if(this.updateCamera(),i=performance.now(),a=this.octree.cull(et),this.delta=(performance.now()-i).toFixed(2)+" ms",a.length>0){for(l=new Float32Array(3*a.length*2),n=0,r=0,o=a.length;n<o;++n)s=a[n],l[r++]=s.min.x,l[r++]=s.min.y,l[r++]=s.min.z,l[r++]=s.max.x,l[r++]=s.max.y,l[r++]=s.max.z;e.geometry.removeAttribute("position"),e.geometry.addAttribute("position",new t.BufferAttribute(l,3)),this.scene.remove(e),this.scene.add(e)}else this.scene.remove(e);this.cameraHelper.update()}}},{key:"configure",value:function(t){var e=this,i=t.addFolder("Frustum Culling");i.add(this,"enabled").onChange(function(){e.cameraHelper.visible=e.culledOctants.visible=e.enabled,e.cull()}),i.add(this,"delta").listen(),i.open();var n=i.addFolder("Camera Adjustment");n.add(this.s,"radius").min(.1).max(10).step(.1).onChange(function(){e.cull()}),n.add(this.s,"phi").min(1e-6).max(Math.PI-1e-6).onChange(function(){e.cull()}),n.add(this.s,"theta").min(0).max(2*Math.PI).onChange(function(){e.cull()})}}]),e}(),nt=function(e){function i(t){m(this,i);var e=g(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.points=null,e.octreeHelper=null,e.octreeRaycaster=null,e.frustumCuller=null,e}return w(i,Q),p(i,[{key:"initialise",value:function(){var e=this.scene,i=this.camera,n=this.renderer;e.fog=new t.FogExp2(855309,.025),this.controls=new t.OrbitControls(i,n.domElement),this.controls.maxDistance=60,i.near=.1,i.far=200,i.position.set(10,6,10),i.lookAt(this.controls.target);var r=function(){var e=new t.Object3D,i=8,n=6/(i-1),r=-3,o=void 0,s=new t.PointsMaterial({color:12582912,sizeAttenuation:!1,size:1});for(console.log("Generating",65536*i,"points...");i-- >0;)o=new t.Points(function(e,i,n,r){var o=new t.BufferGeometry,s=new Float32Array(3*e),a=i/2,l=void 0,u=void 0,h=void 0,c=void 0,d=void 0;for(c=0,d=s.length;c<d;c+=3)l=Math.random()*i-a,u=Math.random()*i-a,h=n+(Math.random()*r*2-r),s[c]=l,s[c+1]=u,s[c+2]=h;return o.addAttribute("position",new t.BufferAttribute(s,3)),o}(65536,6,r,.25),s),s=s.clone(),r+=n,e.add(o);return e}();this.points=r,e.add(r);var o=function(i){var n=new t.Vector3,r=new t.Box3;r.setFromObject(e);var o=performance.now(),s=void 0,a=void 0,l=void 0,u=void 0,h=void 0,c=new J(r.min,r.max,0,8,5);for(s=i.children.length-1;s>=0;--s)for(l=0,u=(h=(a=i.children[s]).geometry.getAttribute("position").array).length;l<u;l+=3)c.put(n.fromArray(h,l),a);return console.log("Octree:",c,"created in",(performance.now()-o).toFixed(2)+" ms"),c}(r),s=function(t){var e=performance.now(),i=new b(t);return i.visible=!1,console.log("OctreeHelper:",i,"created in",(performance.now()-e).toFixed(2)+" ms"),i}(o);this.octreeHelper=s,e.add(s),this.raycaster=new $(o,i,r),n.domElement.parentNode.addEventListener("mousemove",this.raycaster),e.add(this.raycaster.selectedPoint),this.frustumCuller=new it(o,e),e.add(this.frustumCuller.cameraHelper)}},{key:"render",value:function(t){this.renderer.render(this.scene,this.camera)}},{key:"configure",value:function(t){var e=this.points,i=this.octreeHelper;this.raycaster.configure(t),this.frustumCuller.configure(t);var n={"level mask":i.children.length},r=t.addFolder("Points");r.add(e,"visible"),r.open(),(r=t.addFolder("Octree Helper")).add(i,"visible"),r.add(n,"level mask").min(0).max(i.children.length).step(1).onChange(function(){var t=void 0,e=void 0;for(t=0,e=i.children.length;t<e;++t)i.children[t].visible=n["level mask"]===i.children.length||t===n["level mask"]}),r.open()}}]),i}(),rt=function(){function n(){m(this,n),this.clock=new t.Clock,this.renderer=new t.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(0),this.renderer.setPixelRatio(window.devicePixelRatio),this.stats=function(){var t=new i;return t.showPanel(0),t.dom.id="stats",t}(),this.demos=function(t){var e=new Map;return e.set("point-octree",new nt(t)),e}(this.renderer),this.key=function(t){var e=window.location.hash.slice(1);return 0!==e.length&&t.has(e)||(e=t.keys().next().value),e}(this.demos)}return p(n,[{key:"initialise",value:function(t,i,n){function r(){c.initialise(),c.camera.aspect=window.innerWidth/window.innerHeight,c.camera.updateProjectionMatrix(),(d=new e.GUI({autoPlace:!1})).add(s,"key",Array.from(h.keys())).onChange(o),c.configure(d),i.appendChild(d.domElement),n.style.display="none",a.domElement.style.visibility="visible"}function o(){var t=a.getSize();n.style.display="block",a.domElement.style.visibility="hidden",null!==d&&(d.destroy(),i.removeChild(d.domElement)),null!==c&&(c.reset(),a.setSize(t.width,t.height)),(c=h.get(s.key)).load(r)}var s=this,a=this.renderer,l=this.clock,u=this.stats,h=this.demos,c=null,d=null;t.appendChild(a.domElement),i.appendChild(u.dom),o(),document.addEventListener("keydown",function(t){t.altKey&&(t.preventDefault(),i.style.visibility="hidden"===i.style.visibility?"visible":"hidden")}),window.addEventListener("resize",function(){function t(t){var i=t.target.innerWidth,n=t.target.innerHeight;a.setSize(i,n),c.camera.aspect=i/n,c.camera.updateProjectionMatrix(),e=0}var e=0;return function(i){0===e&&(e=setTimeout(t,66,i))}}()),function t(e){var i=l.getDelta();requestAnimationFrame(t),u.begin(),c.render(i),u.end()}()}}]),n}();window.addEventListener("load",function t(e){var i=document.getElementById("viewport"),n=i.children[0],r=document.getElementById("aside"),o=new rt;window.removeEventListener("load",t),r.style.visibility="visible",o.initialise(i,r,n)})}(THREE,dat,Stats);