!function(t,e,i){"use strict";function n(t,e,i,n,r,o){var s=0;return t>e&&t>i?(r<t&&(s|=2),o<t&&(s|=1)):e>i?(n<e&&(s|=4),o<e&&(s|=1)):(n<i&&(s|=4),r<i&&(s|=2)),s}function r(t,e,i,n){var r=void 0,o=0;return e<i?(r=e,o=0):(r=i,o=1),n<r&&(o=2),F[t][o]}function o(t,e,i,s,a,u,l,h,c){var d=t.children,v=void 0,y=void 0,f=void 0,m=void 0;if(a>=0&&u>=0&&l>=0)if(null===d)c.push(t);else{v=n(e,i,s,y=.5*(e+a),f=.5*(i+u),m=.5*(s+l));do{switch(v){case 0:o(d[q[8]],e,i,s,y,f,m,h,c),v=r(v,y,f,m);break;case 1:o(d[q[8]^q[1]],e,i,m,y,f,l,h,c),v=r(v,y,f,l);break;case 2:o(d[q[8]^q[2]],e,f,s,y,u,m,h,c),v=r(v,y,u,m);break;case 3:o(d[q[8]^q[3]],e,f,m,y,u,l,h,c),v=r(v,y,u,l);break;case 4:o(d[q[8]^q[4]],y,i,s,a,f,m,h,c),v=r(v,a,f,m);break;case 5:o(d[q[8]^q[5]],y,i,m,a,f,l,h,c),v=r(v,a,f,l);break;case 6:o(d[q[8]^q[6]],y,f,s,a,u,m,h,c),v=r(v,a,u,m);break;case 7:o(d[q[8]^q[7]],y,f,m,a,u,l,h,c),v=8}}while(v<8)}}function s(t){var e=t.children,i=0,n=void 0,r=void 0,o=void 0;if(null!==e)for(n=0,r=e.length;n<r;++n)(o=1+s(e[n]))>i&&(i=o);return i}function a(t,e,i){var n=t.children,r=void 0,o=void 0;if(_.min=t.min,_.max=t.max,e.intersectsBox(_))if(null!==n)for(r=0,o=n.length;r<o;++r)a(n[r],e,i);else i.push(t)}function u(t,e,i,n){var r=t.children,o=void 0,s=void 0;if(i===e)n.push(t);else if(null!==r)for(++i,o=0,s=r.length;o<s;++o)u(r[o],e,i,n)}function l(t){var e=t.children,i=0,n=void 0,r=void 0;if(null!==e)for(n=0,r=e.length;n<r;++n)i+=l(e[n]);else null!==t.points&&(i=t.points.length);return i}function h(t,e,i,n,r,o,s){var a=t.children,u=!1,l=!1,c=void 0,d=void 0;if(t.contains(e,r)){if(null===a){if(null===t.points)t.points=[],t.data=[];else for(c=0,d=t.points.length;!u&&c<d;++c)u=t.points[c].equals(e);u?(t.data[c-1]=i,l=!0):t.points.length<o||n===s?(t.points.push(e.clone()),t.data.push(i),l=!0):(t.split(),t.redistribute(r),a=t.children)}if(null!==a)for(++n,c=0,d=a.length;!l&&c<d;++c)l=h(a[c],e,i,n,r,o,s)}return l}function c(t,e,i,n,r){var o=t.children,s=!1,a=void 0,u=void 0,h=void 0,d=void 0,v=void 0;if(t.contains(i,n))if(null!==o)for(a=0,u=o.length;!s&&a<u;++a)s=c(o[a],t,i,n,r);else if(null!==t.points)for(h=t.points,d=t.data,a=0,u=h.length;!s&&a<u;++a)h[a].equals(i)&&(a<(v=u-1)&&(h[a]=h[v],d[a]=d[v]),h.pop(),d.pop(),null!==e&&l(e)<=r&&e.merge(),s=!0);return s}function d(t,e,i,n){var r=t.children,o=null,s=void 0,a=void 0,u=void 0;if(t.contains(e,i))if(null!==r)for(s=0,a=r.length;null===o&&s<a;++s)o=d(r[s],e,i,n);else for(s=0,a=(u=t.points).length;null===o&&s<a;++s)e.distanceToSquared(u[s])<=n&&(o=t.data[s]);return o}function v(t,e,i,n){var r=t.points,o=t.children,s=null,a=i,u=void 0,l=void 0,h=void 0,c=void 0,d=void 0,y=void 0,f=void 0;if(null!==o)for(u=0,l=(d=o.map(function(t){return{octant:t,distance:t.distanceToCenterSquared(e)}}).sort(function(t,e){return t.distance-e.distance})).length;u<l;++u)(y=d[u].octant).contains(e,a)&&null!==(f=v(y,e,a,n))&&(c=f.point.distanceToSquared(e),(!n||c>0)&&c<a&&(a=c,s=f));else if(null!==r)for(u=0,l=r.length;u<l;++u)h=r[u],c=e.distanceToSquared(h),(!n||c>0)&&c<a&&(a=c,s={point:h.clone(),data:t.data[u]});return s}function y(t,e,i,n,r){var o=t.points,s=t.children,a=i*i,u=void 0,l=void 0,h=void 0,c=void 0,d=void 0;if(null!==s)for(u=0,l=s.length;u<l;++u)(d=s[u]).contains(e,i)&&y(d,e,i,n,r);else if(null!==o)for(u=0,l=o.length;u<l;++u)h=o[u],c=e.distanceToSquared(h),(!n||c>0)&&c<=a&&r.push({point:h.clone(),data:t.data[u]})}e="default"in e?e.default:e,i="default"in i?i.default:i;var f=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},m=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),x=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in r)return r.value;var s=r.get;if(void 0!==s)return s.call(n)},p=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},g=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},w=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)},k=function(e){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;f(this,i);var e=g(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.name="OctreeHelper",e.octree=t,e.update(),e}return p(i,e),m(i,[{key:"createLineSegments",value:function(e){var i=Math.pow(2,16)/8-1,n=new t.Object3D,r=new t.LineBasicMaterial({color:16777215*Math.random()}),o=e.length,s=void 0,a=void 0,u=void 0,l=void 0,h=void 0,c=void 0,d=void 0,v=void 0,y=void 0,f=void 0,m=void 0,x=void 0,p=void 0,g=void 0,w=void 0;for(y=0,a=0,p=Math.ceil(o/i);p>0;--p){for(a+=o<i?o:i,o-=i,s=8*a,u=new Uint16Array(3*s),l=new Float32Array(3*s),m=0,x=0;y<a;++y){for(c=(h=e[y]).min,d=h.max,f=0;f<12;++f)w=b[f],u[x++]=m+w[0],u[x++]=m+w[1];for(f=0;f<8;++f,++m)g=z[f],l[3*m]=0===g[0]?c.x:d.x,l[3*m+1]=0===g[1]?c.y:d.y,l[3*m+2]=0===g[2]?c.z:d.z}(v=new t.BufferGeometry).setIndex(new t.BufferAttribute(u,1)),v.addAttribute("position",new t.BufferAttribute(l,3)),n.add(new t.LineSegments(v,r))}this.add(n)}},{key:"update",value:function(){var t=null!==this.octree?this.octree.getDepth():-1,e=0;for(this.dispose();e<=t;)this.createLineSegments(this.octree.findOctantsByLevel(e)),++e}},{key:"dispose",value:function(){var t=this.children,e=void 0,i=void 0,n=void 0,r=void 0,o=void 0,s=void 0;for(n=0,o=t.length;n<o;++n){for(r=0,s=(i=(e=t[n]).children).length;r<s;++r)i[r].geometry.dispose(),i[r].material.dispose();for(;i.length>0;)e.remove(i[0])}for(;t.length>0;)this.remove(t[0])}}]),i}(t.Object3D),z=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],b=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],A=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,t),this.x=e,this.y=i}m(t,[{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return isFinite(t)?(this.x*=t,this.y*=t):(this.x=0,this.y=0),this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"divideVectors",value:function(t,e){return this.x=t.x/e.x,this.y=t.y/e.y,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}}])}(),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;f(this,t),this.x=e,this.y=i,this.z=n}return m(t,[{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"addScaledVector",value:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}},{key:"addScalar",value:function(t){return this.x+=t,this.y+=t,this.z+=t,this}},{key:"addVectors",value:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"subScalar",value:function(t){return this.x-=t,this.y-=t,this.z-=t,this}},{key:"subVectors",value:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}},{key:"multiplyScalar",value:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this}},{key:"multiplyVectors",value:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}},{key:"divide",value:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}},{key:"divideScalar",value:function(t){return this.multiplyScalar(1/t)}},{key:"divideVectors",value:function(t,e){return this.x=t.x/e.x,this.y=t.y/e.y,this.z=t.z/e.z,this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceToSquared(t))}},{key:"distanceToSquared",value:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}},{key:"clamp",value:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}},{key:"applyMatrix3",value:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}},{key:"applyMatrix4",value:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12],this.y=r[1]*e+r[5]*i+r[9]*n+r[13],this.z=r[2]*e+r[6]*i+r[10]*n+r[14],this}}]),t}()),M=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new A(1/0,1/0,1/0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A(-1/0,-1/0,-1/0);f(this,t),this.min=e,this.max=i}return m(t,[{key:"set",value:function(t,e){return this.min.copy(t),this.max.copy(e),this}},{key:"copy",value:function(t){return this.min.copy(t.min),this.max.copy(t.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"expandByPoint",value:function(t){return this.min.min(t),this.max.max(t),this}},{key:"union",value:function(t){return this.min.min(t.min),this.max.max(t.max),this}},{key:"setFromPoints",value:function(t){var e=void 0,i=void 0;for(e=0,i=t.length;e<i;++e)this.expandByPoint(t[e]);return this}},{key:"setFromCenterAndSize",value:function(t,e){var i=e.clone().multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}},{key:"intersectsBox",value:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}}]),t}(),S=(function(){function t(){f(this,t),this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}m(t,[{key:"set",value:function(t,e,i,n,r,o,s,a,u){var l=this.elements;return l[0]=t,l[3]=e,l[6]=i,l[1]=n,l[4]=r,l[7]=o,l[2]=s,l[5]=a,l[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(t){var e=t.elements;return this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}])}(),function(){function t(){f(this,t),this.elements=new Float32Array([1,0,0,1,0,1])}m(t,[{key:"set",value:function(t,e,i,n,r,o){var s=this.elements;return s[0]=t,s[1]=e,s[3]=n,s[2]=i,s[4]=r,s[5]=o,this}},{key:"identity",value:function(){return this.set(1,0,0,1,0,1),this}},{key:"copy",value:function(t){var e=t.elements;return this.set(e[0],e[1],e[2],e[3],e[4],e[5]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toMatrix3",value:function(t){var e=t.elements;t.set(e[0],e[1],e[2],e[1],e[3],e[4],e[2],e[4],e[5])}},{key:"add",value:function(t){var e=this.elements,i=t.elements;return e[0]+=i[0],e[1]+=i[1],e[3]+=i[3],e[2]+=i[2],e[4]+=i[4],e[5]+=i[5],this}},{key:"norm",value:function(){var t=this.elements,e=t[1]*t[1],i=t[2]*t[2],n=t[4]*t[4];return Math.sqrt(t[0]*t[0]+e+i+e+t[3]*t[3]+n+i+n+t[5]*t[5])}},{key:"off",value:function(){var t=this.elements;return Math.sqrt(2*(t[1]*t[1]+t[2]*t[2]+t[4]*t[4]))}},{key:"applyToVector3",value:function(t){var e=t.x,i=t.y,n=t.z,r=this.elements;return t.x=r[0]*e+r[1]*i+r[2]*n,t.y=r[1]*e+r[3]*i+r[4]*n,t.z=r[2]*e+r[4]*i+r[5]*n,t}}],[{key:"calculateIndex",value:function(t,e){return 3-(3-t)*(2-t)/2+e}}])}(),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new A,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new A;f(this,t),this.min=e,this.max=i,this.children=null}return m(t,[{key:"getCenter",value:function(){return this.min.clone().add(this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return this.max.clone().sub(this.min)}},{key:"split",value:function(t){var e=this.min,i=this.max,n=this.getCenter(),r=void 0,o=void 0,s=0,a=void 0,u=void 0,l=void 0,h=void 0,c=void 0;for(Array.isArray(t)&&(u=this.getDimensions().multiplyScalar(.5),l=[new A,new A,new A],s=t.length),this.children=[],r=0;r<8;++r){if(a=P[r],c=null,s>0)for(l[1].addVectors(e,l[0].fromArray(a).multiply(u)),l[2].addVectors(n,l[0].fromArray(a).multiply(u)),o=0;o<s;++o)if(null!==(h=t[o])&&l[1].equals(h.min)&&l[2].equals(h.max)){c=h,t[o]=null;break}this.children.push(null!==c?c:new this.constructor(new A(0===a[0]?e.x:n.x,0===a[1]?e.y:n.y,0===a[2]?e.z:n.z),new A(0===a[0]?n.x:i.x,0===a[1]?n.y:i.y,0===a[2]?n.z:i.z)))}}}]),t}()),P=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],U=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new A,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;f(this,t),this.min=e,this.size=i,this.children=null}m(t,[{key:"getCenter",value:function(){return this.min.clone().addScalar(.5*this.size)}},{key:"getDimensions",value:function(){return new A(this.size,this.size,this.size)}},{key:"split",value:function(t){var e=this.min,i=this.getCenter(),n=.5*this.size,r=void 0,o=void 0,s=0,a=void 0,u=void 0,l=void 0,h=void 0;for(Array.isArray(t)&&(u=new A,s=t.length),this.children=[],r=0;r<8;++r){if(a=P[r],h=null,s>0)for(u.fromArray(a).multiplyScalar(n).add(e),o=0;o<s;++o)if(null!==(l=t[o])&&l.size===n&&u.equals(l.min)){h=l,t[o]=null;break}this.children.push(null!==h?h:new this.constructor(new A(0===a[0]?e.x:i.x,0===a[1]?e.y:i.y,0===a[2]?e.z:i.z),n))}}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}])}(),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f(this,t),this.value=e,this.done=i}return m(t,[{key:"reset",value:function(){this.value=null,this.done=!1}}]),t}()),O=new M,C=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;f(this,t),this.octree=e,this.region=i,this.cull=null!==i,this.result=new U,this.trace=null,this.indices=null,this.reset()}return m(t,[{key:"reset",value:function(){var t=this.octree.root;return this.trace=[],this.indices=[],null!==t&&(O.min=t.min,O.max=t.max,this.cull&&!this.region.intersectsBox(O)||(this.trace.push(t),this.indices.push(0))),this.result.reset(),this}},{key:"next",value:function(){for(var t=this.cull,e=this.region,i=this.indices,n=this.trace,r=null,o=n.length-1,s=void 0,a=void 0,u=void 0;null===r&&o>=0;)if(s=i[o],a=n[o].children,++i[o],s<8)if(null!==a){if(u=a[s],t&&(O.min=u.min,O.max=u.max,!e.intersectsBox(O)))continue;n.push(u),i.push(0),++o}else r=n.pop(),i.pop();else n.pop(),i.pop(),--o;return this.result.value=r,this.result.done=null===r,this.result}},{key:"return",value:function(t){return this.result.value=t,this.result.done=!0,this.result}},{key:Symbol.iterator,value:function(){return this}}]),t}(),q=new Uint8Array([0,1,2,3,4,5,6,7,0]),F=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],j=function(){function t(){f(this,t)}return m(t,null,[{key:"intersectOctree",value:function(t,e,i){var n=t.getDimensions(),r=n.clone().multiplyScalar(.5),s=t.min.clone().sub(t.min),a=t.max.clone().sub(t.min),u=e.ray.direction.clone(),l=e.ray.origin.clone();l.sub(t.getCenter()).add(r);var h=void 0,c=void 0,d=void 0,v=void 0,y=void 0,f=void 0,m=void 0,x=void 0,p=void 0;q[8]=q[0],u.x<0&&(l.x=n.x-l.x,u.x=-u.x,q[8]|=q[4]),u.y<0&&(l.y=n.y-l.y,u.y=-u.y,q[8]|=q[2]),u.z<0&&(l.z=n.z-l.z,u.z=-u.z,q[8]|=q[1]),h=1/u.x,c=1/u.y,d=1/u.z,v=(s.x-l.x)*h,y=(a.x-l.x)*h,f=(s.y-l.y)*c,m=(a.y-l.y)*c,x=(s.z-l.z)*d,p=(a.z-l.z)*d,Math.max(Math.max(v,f),x)<Math.min(Math.min(y,m),p)&&o(t.root,v,f,x,y,m,p,e,i)}}]),t}(),_=new M,T=function(){function t(e,i){f(this,t),this.root=void 0!==e&&void 0!==i?new S(e,i):null}return m(t,[{key:"getCenter",value:function(){return this.root.getCenter()}},{key:"getDimensions",value:function(){return this.root.getDimensions()}},{key:"getDepth",value:function(){return s(this.root)}},{key:"cull",value:function(t){var e=[];return a(this.root,t,e),e}},{key:"findOctantsByLevel",value:function(t){var e=[];return u(this.root,t,0,e),e}},{key:"raycast",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return j.intersectOctree(this,t,e),e}},{key:"leaves",value:function(t){return new C(this,t)}},{key:Symbol.iterator,value:function(){return new C(this)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),t}(),B=function(t){function e(t,i){f(this,e);var n=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return n.points=null,n.data=null,n}return p(e,t),m(e,[{key:"distanceToSquared",value:function(t){return t.clone().clamp(this.min,this.max).sub(t).lengthSq()}},{key:"distanceToCenterSquared",value:function(t){var e=this.getCenter(),i=t.x-e.x,n=t.y-e.x,r=t.z-e.z;return i*i+n*n+r*r}},{key:"contains",value:function(t,e){var i=this.min,n=this.max;return t.x>=i.x-e&&t.y>=i.y-e&&t.z>=i.z-e&&t.x<=n.x+e&&t.y<=n.y+e&&t.z<=n.z+e}},{key:"redistribute",value:function(t){var e=this.children,i=this.points,n=this.data,r=void 0,o=void 0,s=void 0,a=void 0,u=void 0;if(null!==e)for(;i.length>0;)for(a=i.pop(),u=n.pop(),r=0,o=e.length;r<o;++r)if((s=e[r]).contains(a,t)){null===s.points&&(s.points=[],s.data=[]),s.points.push(a),s.data.push(u);break}this.points=null,this.data=null}},{key:"merge",value:function(){var t=this.children,e=void 0,i=void 0,n=void 0;if(null!==t){for(this.points=[],this.data=[],e=0,i=t.length;e<i;++e)if(null!==(n=t[e]).points){var r,o;(r=this.points).push.apply(r,w(n.points)),(o=this.data).push.apply(o,w(n.data))}this.children=null}}}]),e}(S),D=function(t){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;f(this,e);var s=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s.root=new B(t,i),s.bias=Math.max(0,n),s.biasSquared=s.bias*s.bias,s.maxPoints=Math.max(1,Math.round(r)),s.maxDepth=Math.max(0,Math.round(o)),s}return p(e,t),m(e,[{key:"countPoints",value:function(){return l(this.root)}},{key:"add",value:function(t,e){h(this.root,t,e,0,this.bias,this.maxPoints,this.maxDepth)}},{key:"remove",value:function(t){c(this.root,null,t,this.bias,this.maxPoints)}},{key:"fetch",value:function(t){return d(this.root,t,this.bias,this.biasSquared)}},{key:"findNearestPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return v(this.root,t,e,i)}},{key:"findPoints",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[];return y(this.root,t,e,i,n),n}},{key:"raycast",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=x(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"raycast",this).call(this,t);return n.length>0&&this.testPoints(n,t,i),i}},{key:"testPoints",value:function(t,e,i){var n=e.params.Points.threshold,r=n*n,o=void 0,s=void 0,a=void 0,u=void 0,l=void 0,h=void 0,c=void 0,d=void 0,v=void 0,y=void 0,f=void 0;for(l=0,c=t.length;l<c;++l)if(v=t[l],null!==(y=v.points))for(h=0,d=y.length;h<d;++h)f=y[h],(u=e.ray.distanceSqToPoint(f))<r&&(o=e.ray.closestPointToPoint(f),(s=e.ray.origin.distanceTo(o))>=e.near&&s<=e.far&&(a=Math.sqrt(u),i.push({distance:s,distanceToRay:a,point:o.clone(),object:v.data[h]})))}}]),e}(T),E=new t.Vector2,H=function(t){function e(t,i,n){f(this,e);var r=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.params.Points.threshold=.1,r.octree=t,r.camera=i,r.object=n,r.enabled=!0,r.delta="",r.selection=null,r}return p(e,t),m(e,[{key:"raycast",value:function(t){var e=void 0,i=void 0,n=void 0;E.x=t.clientX/window.innerWidth*2-1,E.y=-t.clientY/window.innerHeight*2+1,this.setFromCamera(E,this.camera),this.enabled?(i=performance.now(),e=this.octree.raycast(this),n=performance.now()):(i=performance.now(),e=this.intersectObjects(this.object.children),n=performance.now()),this.delta=(n-i).toFixed(2)+" ms",null!==this.selection&&(this.selection.material.color.setHex(12582912),this.selection=null),e.length>0&&(void 0!==e[0].object?(this.selection=e[0].object,this.selection.material.color.setHex(13434624)):console.warn(e))}},{key:"configure",value:function(t){var e=t.addFolder("Raycasting");e.add(this,"enabled"),e.add(this,"delta").listen(),e.open()}}]),e}(t.Raycaster),V=new t.Matrix4,L=new t.Frustum,I=function(){function e(i,n){f(this,e),this.octree=i,this.scene=n,this.enabled=!1,this.cullCamera=new t.PerspectiveCamera(20,1.77,.5,5),this.cullCamera.matrixAutoUpdate=!1,this.s=new t.Spherical(5,Math.PI/3,1.75*Math.PI),this.delta="",this.culledOctants=new t.Points(new t.BufferGeometry,new t.PointsMaterial({color:13434624,sizeAttenuation:!1,size:2})),this.culledOctants.visible=!1,this.cameraHelper=new t.CameraHelper(this.cullCamera),this.cameraHelper.visible=!1}return m(e,[{key:"updateCamera",value:function(){var t=this.cullCamera;t.position.setFromSpherical(this.s),t.lookAt(this.scene.position),t.updateMatrix(),t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),L.setFromMatrix(V.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse))}},{key:"cull",value:function(){var e=this.culledOctants,i=void 0,n=void 0,r=void 0,o=void 0,s=void 0,a=void 0,u=void 0;if(this.enabled)if(this.updateCamera(),i=performance.now(),a=this.octree.cull(L),this.delta=(performance.now()-i).toFixed(2)+" ms",a.length>0){for(u=new Float32Array(3*a.length*2),n=0,r=0,o=a.length;n<o;++n)s=a[n],u[r++]=s.min.x,u[r++]=s.min.y,u[r++]=s.min.z,u[r++]=s.max.x,u[r++]=s.max.y,u[r++]=s.max.z;e.geometry.removeAttribute("position"),e.geometry.addAttribute("position",new t.BufferAttribute(u,3)),this.scene.remove(e),this.scene.add(e)}else this.scene.remove(e)}},{key:"configure",value:function(t){var e=this,i=t.addFolder("Frustum Culling");i.add(this,"enabled").onChange(function(){e.cameraHelper.visible=e.culledOctants.visible=e.enabled,e.cull()}),i.add(this,"delta").listen(),i.open();var n=i.addFolder("Camera Adjustment");n.add(this.s,"radius").min(.1).max(10).step(.1).onChange(function(){e.cull()}),n.add(this.s,"phi").min(1e-6).max(Math.PI-1e-6).onChange(function(){e.cull()}),n.add(this.s,"theta").min(0).max(2*Math.PI).onChange(function(){e.cull()})}}]),e}(),R=function(){function n(){f(this,n)}return m(n,null,[{key:"initialise",value:function(n,r,o){var s=window.innerWidth,a=window.innerHeight,u=s/a,l=new t.Scene;l.fog=new t.FogExp2(855309,.025);var h=new t.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!0});h.setSize(s,a),h.setClearColor(l.fog.color),h.setPixelRatio(window.devicePixelRatio),n.appendChild(h.domElement);var c=new t.PerspectiveCamera(50,u,.1,200),d=new t.OrbitControls(c,h.domElement);d.target.set(0,0,0),d.maxDistance=60,c.position.set(10,6,10),c.lookAt(d.target),l.add(c);var v=new i;v.showPanel(0),v.dom.id="stats",r.appendChild(v.dom);var y=new e.GUI;r.appendChild(y.domElement.parentNode);var f=function(){for(var e=new t.Object3D,i=8,n=6/(i-1),r=-3,o=void 0,s=new t.PointsMaterial({color:12582912,sizeAttenuation:!1,size:1});i-- >0;)o=new t.Points(function(e,i,n){var r=new t.BufferGeometry,o=new Float32Array(3*e),s=i/2,a=void 0,u=void 0,l=void 0,h=void 0;for(l=0,h=o.length;l<h;l+=3)a=Math.random()*i-s,u=Math.random()*i-s,o[l]=a,o[l+1]=u,o[l+2]=n;return r.addAttribute("position",new t.BufferAttribute(o,3)),r}(16384,6,r),s),s=s.clone(),r+=n,e.add(o);return e}();l.add(f);var m=function(e){var i=new t.Vector3,n=new t.Box3;n.setFromObject(l);var r=performance.now(),o=void 0,s=void 0,a=void 0,u=void 0,h=void 0,c=new D(n.min,n.max,0,8,5);for(o=e.children.length-1;o>=0;--o)for(a=0,u=(h=(s=e.children[o]).geometry.getAttribute("position").array).length;a<u;a+=3)c.add(i.fromArray(h,a),s);return console.log("Octree:",c,"created in",(performance.now()-r).toFixed(2)+" ms"),c}(f),x=function(t){var e=performance.now(),i=new k(t);return i.visible=!1,console.log("OctreeHelper:",i,"created in",(performance.now()-e).toFixed(2)+" ms"),i}(m);l.add(x);var p=new H(m,c,f);p.configure(y),n.addEventListener("mousemove",function(t){p.raycast(t)});var g=new I(m,l);g.configure(y),l.add(g.cullCamera),l.add(g.cameraHelper),function(){var t={"level mask":x.children.length},e=y.addFolder("Points");e.add(f,"visible"),e.open(),(e=y.addFolder("Octree Helper")).add(x,"visible"),e.add(t,"level mask").min(0).max(x.children.length).step(1).onChange(function(){var e=void 0,i=void 0;for(e=0,i=x.children.length;e<i;++e)x.children[e].visible=t["level mask"]===x.children.length||e===t["level mask"]}),e.open()}(),document.addEventListener("keydown",function(t){t.altKey&&(t.preventDefault(),r.style.visibility="hidden"===r.style.visibility?"visible":"hidden")}),window.addEventListener("resize",function(t){var e=t.target.innerWidth,i=t.target.innerHeight;h.setSize(e,i),c.aspect=e/i,c.updateProjectionMatrix()}),function t(e){requestAnimationFrame(t),v.begin(),g.cameraHelper.update(),h.render(l,c),v.end()}()}}]),n}();window.addEventListener("load",function e(i){window.removeEventListener("load",e);var n=new Map,r=new t.LoadingManager;r.onProgress=function(t,e,i){e===i&&R.initialise(document.getElementById("viewport"),document.getElementById("aside"),n)},r.onProgress()})}(THREE,dat,Stats);